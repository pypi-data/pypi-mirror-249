[build-system]
requires = ["setuptools", "wheel", "cython"]
build-backend = "setuptools.build_meta"

[project]
name = "pubpypack-harmony-mitch-chapman"
version = "0.0.2"

requires-python = ">=3.9"

authors = [
    { "name" = "Mitch Chapman" },
    { "email" = "mchapman87501@users.noreply.github.com" },
]

description = "An ephemeral by-product of the exercises in 'Publishing Python Packages', by Dane Hillard"
readme = "README.md"

dependencies = ["termcolor>=1.1.0,<2"]

[project.license]
file = "LICENSE.txt"

[project.optional-dependencies]
test = ["coverage[toml]", "pytest", "pytest-cov", "ruff"]

[project.scripts]
harmony = "imppkg.harmony:main"

[tool.pytest.ini_options]
minversion = "6.0"
testpaths = ["tests"]
xfail_strict = true
# NOTE: without --cov, the [tool.coverage.*] tables will be ignored.
addopts = "--cov --strict-markers"

[tool.coverage.run]
branch = true
source_pkgs = ["imppkg"]

[tool.coverage.report]
show_missing = true
skip_covered = true

[tool.coverage.paths]
source = ["src/imppkg", "*/site-packages/imppkg"]

[tool.tox]
legacy_tox_ini = """
    [tox]
    envlist =
        py39
        py310
        py311
        py312

    [testenv]
    commands = pytest
    deps =
        pytest
        pytest-cov
        pytest-randomly

    [testenv:get_my_ip]
    deps =
        requests
    commands =
        python -c "import sys, requests; print(sys.version); print(requests.get('https://canhazip.com').text)"

    [testenv:typecheck]
    deps =
        pytest
        mypy
        types-termcolor
    commands =
        mypy --ignore-missing-imports {posargs:src tests}

    [testenv:format]
    deps = black
    skip_install = true
    commands = black {posargs:--check --diff src tests}

    [testenv:lint]
    deps =
        flake8
        flake8-bugbear
    commands = flake8 {posargs:src tests}

    [testenv:rufflint]
    deps = ruff
    commands = ruff {posargs:src tests}
"""

[tool.mypy]
python_version = "3.9"
warn_unused_configs = true
show_error_context = true
pretty = true
check_untyped_defs = true
namespace_packages = true

[tool.black]
line-length = 79
target-version = ["py39", "py310", "py311", "py312"]

[tool.flake8]
max-line-length = 79

[tool.ruff]
line-length = 79
