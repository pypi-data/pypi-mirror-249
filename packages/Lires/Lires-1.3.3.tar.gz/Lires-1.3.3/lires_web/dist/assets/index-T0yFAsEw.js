var wt=Object.defineProperty;var _t=(r,t,e)=>t in r?wt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var le=(r,t,e)=>(_t(r,typeof t!="symbol"?t+"":t,e),e);import{d as q,f as T,B as _,C as me,D as Y,E as y,G as n,c as C,H as P,a as w,w as ne,F as H,I as X,z as x,J as V,K as F,L as B,M as Qe,N as A,O as bt,P as kt,Q as ee,R as te,S as qe,T as Ye,U as fe,V as W,W as St,X as Q,Y as Ee,Z as Ae,o as be,_ as $e,$ as $t,n as Dt,a0 as Ct,a1 as xt,a2 as Tt}from"./@vue-NNSWgvKg.js";import{d as Oe,c as Pt}from"./pinia-o0QJ1zBb.js";import{u as ke,a as Xe,c as It,b as Lt}from"./vue-router-ZDhEVaBF.js";import{f as et}from"./fast-xml-parser-AryUhA7v.js";import{P as Re}from"./plotly.js-dist-s6nuoKOE.js";import{y as Ut,N as At}from"./md-editor-v3-bbAh5hx0.js";import"./@lezer-zO5nUykE.js";import"./markdown-it-Hr5Sq5Da.js";import"./strnum-nO6OuMXP.js";import"./copy-to-clipboard-ebbzfRrE.js";import"./toggle-selection-fekekO1r.js";import"./@vavt-nbmepBNB.js";import"./codemirror-thLcTxEQ.js";import"./@codemirror-1Oy-9S_E.js";import"./style-mod-z-g5kJ9M.js";import"./w3c-keyname-KjuS0gPF.js";import"./medium-zoom-UI1A0slP.js";import"./markdown-it-image-figures-56d0Cn7e.js";import"./markdown-it-task-lists-ssNXB4M9.js";import"./entities-cg2bgkkV.js";import"./uc.micro-05tmOiB-.js";import"./mdurl-VWZ1KHdU.js";import"./linkify-it-Rn4CjAEN.js";import"./punycode-HZlgMKS9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const Rt=q({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(r){const t=r,e=T(()=>t.styleType==="alert"||t.styleType==="error"?{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="warning"?{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="info"?{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="success"?{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}),a=T(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(s,i)=>(y(),_("div",{id:"popup",style:Y({...e.value,...a.value})},[me(s.$slots,"default",{},void 0,!0)],4))}}),O=(r,t)=>{const e=r.__vccOpts||r;for(const[a,s]of t)e[a]=s;return e},We=O(Rt,[["__scopeId","data-v-e0ba6b84"]]);let Bt=window.location.protocol,tt;tt=`${Bt}//${window.location.hostname}:${window.location.port}`;const at=`${tt}/docs/userManual_zh/index.html`;console.log("production mode");function J(){const r=Z().backendPort;return`${Z().backendHost}:${r}`}const qt={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Pe=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"];var ce=function r(t){function e(ue,N){return ue>>>N|ue<<32-N}for(var a=Math.pow,s=a(2,32),i="length",o,p,l="",d=[],g=t[i]*8,u=r.h=r.h||[],h=r.k=r.k||[],v=h[i],f={},c=2;v<64;c++)if(!f[c]){for(o=0;o<313;o+=c)f[o]=c;u[v]=a(c,.5)*s|0,h[v++]=a(c,1/3)*s|0}for(t+="Â€";t[i]%64-56;)t+="\0";for(o=0;o<t[i];o++){if(p=t.charCodeAt(o),p>>8)throw new Error("ASCII check failed");d[o>>2]|=p<<(3-o)%4*8}for(d[d[i]]=g/s|0,d[d[i]]=g,p=0;p<d[i];){var m=d.slice(p,p+=16),k=u;for(u=u.slice(0,8),o=0;o<64;o++){var b=m[o-15],S=m[o-2],$=u[0],D=u[4],L=u[7]+(e(D,6)^e(D,11)^e(D,25))+(D&u[5]^~D&u[6])+h[o]+(m[o]=o<16?m[o]:m[o-16]+(e(b,7)^e(b,18)^b>>>3)+m[o-7]+(e(S,17)^e(S,19)^S>>>10)|0),U=(e($,2)^e($,13)^e($,22))+($&u[1]^$&u[2]^u[1]&u[2]);u=[L+U|0].concat(u),u[4]=u[4]+L|0}for(o=0;o<8;o++)u[o]=u[o]+k[o]|0}for(o=0;o<8;o++)for(p=3;p+1;p--){var j=u[o]>>p*8&255;l+=(j<16?0:"")+j.toString(16)}return l};class R{constructor(){}get settings(){return Z()}apiURL(){return J()+"/api"}async authUsr(t){const e=new URLSearchParams;e.set("key",t);const a=await fetch(`${this.apiURL()}/auth`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()});if(a.ok&&a.status===200)return JSON.parse(await a.text());throw new Error(`Got response: ${a.status}`)}async status(){const t=new FormData;t.append("key",this.settings.encKey);const e=await fetch(`${this.apiURL()}/status`,{method:"POST",body:t});if(console.log(e),e.ok)return JSON.parse(await e.text());throw new Error(`Got response: ${e.status}`)}async reqFileList(t){const e=t.join("&&"),a=new URL(`${this.apiURL()}/filelist`);a.searchParams.append("tags",e),a.searchParams.append("key",this.settings.encKey);const s=await fetch(a.toString());if(s.ok)return await s.json();throw new Error(`Got response: ${s.status}`)}async reqFileListStream(t=[],e=()=>{}){const a=t.join("&&"),s=new URL(`${this.apiURL()}/filelist-stream`);s.searchParams.append("tags",a),s.searchParams.append("key",this.settings.encKey);const i=await fetch(s.toString());if(!i.ok)throw new Error(`Got response: ${i.status}`);const o=i.headers.get("totalDataCount"),p=o?parseInt(o):-1;let l=0;const d=i.body.getReader();let g="";const u=({value:h,done:v})=>{const c=(g+new TextDecoder().decode(h)).split("\\N");for(let m=0;m<c.length-1;m++){const k=c[m];try{const b=JSON.parse(k);l+=1,e(b,l,p)}catch(b){console.error(b)}}if(c.length>0&&(g=c[c.length-1]),v){if(g)try{const m=JSON.parse(g);l+=1,e(m,l,p)}catch(m){console.error(m)}return}return d.read().then(u)};return d.read().then(u)}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,a=10){const s=new URL(`${this.apiURL()}/datafeat/tsne/${t}`);s.searchParams.append("key",this.settings.encKey),s.searchParams.append("n_component",e.toString()),s.searchParams.append("perplexity",a.toString());const i=await fetch(s.toString());if(i.ok)return await i.json();throw new Error(`Got response: ${i.status}`)}async reqDatapointSummary(t){const e=new URL(`${this.apiURL()}/fileinfo/${t}`);e.searchParams.append("key",this.settings.encKey);const a=await fetch(e.toString());if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async reqReloadDB(){const t=new FormData;t.append("key",this.settings.encKey);const e=await fetch(`${this.apiURL()}/reload-db`,{method:"POST",body:t});if(e.ok)return!0;throw new Error(`Got response: ${e.status}`)}async reqDatapointAbstract(t){new URLSearchParams().set("key",this.settings.encKey);const a=await fetch(`${this.apiURL()}/fileinfo-supp/abstract/${t}`);if(a.ok&&a.status===200)return await a.text();throw new Error(`Got response: ${a.status}`)}async reqDatapointAbstractUpdate(t,e){const a=new FormData;a.append("key",this.settings.encKey),a.append("content",e);const s=await fetch(`${this.apiURL()}/fileinfo-supp/abstract-update/${t}`,{method:"POST",body:a});if(s.ok)return!0;throw new Error(`Got response: ${s.status}`)}async reqDatapointNote(t){const e=new URL(`${this.apiURL()}/fileinfo-supp/note/${t}`);e.searchParams.append("key",this.settings.encKey);const a=await fetch(e.toString());if(a.ok)return await a.text();throw new Error(`Got response: ${a.status}`)}async reqDatapointNoteUpdate(t,e){const a=new URL(`${this.apiURL()}/fileinfo-supp/note-update/${t}`);a.searchParams.append("key",this.settings.encKey),a.searchParams.append("content",e);const s=await fetch(a.toString(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(s.ok)return!0;throw new Error(`Got response: ${s.status}`)}async search(t,e){const a=new URLSearchParams;a.set("key",this.settings.encKey),a.set("method",t),a.set("kwargs",JSON.stringify(e));const s=await fetch(`${this.apiURL()}/search`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});if(s.ok&&s.status===200)return JSON.parse(await s.text());throw new Error(`Got response: ${s.status}`)}async featurize(t,e=!1){const a=new URLSearchParams;a.set("key",this.settings.encKey),a.set("text",t),a.set("require_cache",e.toString());const s=await fetch(`${this.apiURL()}/iserver/textFeature?${a.toString()}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(s.ok&&s.status===200){const i=await s.text();return JSON.parse(i)}else throw new Error(`Got response: ${s.status}`)}reqAISummary(t,e,a=()=>{},s=!0,i="DEFAULT"){const o=new FormData;o.append("key",this.settings.encKey),o.append("force",s.toString()),o.append("uuid",t),o.append("model",i),fetch(`${this.apiURL()}/summary`,{method:"POST",body:o}).then(l=>{if(!l.ok)throw e("(Error: "+l.status+")"),new Error("HTTP error "+l.status);const d=l.body.getReader(),g=({value:u,done:h})=>{if(h){a();return}let v=new TextDecoder().decode(u);return e(v),d.read().then(g)};return d.read().then(g)}).catch(l=>{console.error(l)})}async deleteData(t){const e=new URL(`${this.apiURL()}/dataman/delete`);e.searchParams.append("key",this.settings.encKey),e.searchParams.append("uuid",t);const a=await fetch(e.toString(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(a.ok&&a.status===200)return!0;throw new Error(`Got response: ${a.status}`)}async editData(t,e=null,a=null,s=null){if(!t&&(e===null||a===null||s===null))throw new Error("uid is null, other fields should be complete");const i=new URLSearchParams;t||(t=null),i.set("key",this.settings.encKey),i.set("uuid",JSON.stringify(t)),e!==null&&i.set("bibtex",e),a!==null&&i.set("tags",JSON.stringify(a)),s!==null&&i.set("url",s);const o=await fetch(`${this.apiURL()}/dataman/update`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()});if(o.ok&&o.status===200)return JSON.parse(await o.text());throw new Error(`Got response: ${o.status}`)}async uploadImages(t,e){return(await Promise.all(e.map(s=>new Promise((i,o)=>{const p=new FormData;p.append("file",s),p.append("key",this.settings.encKey),fetch(`${J()}/img/${t}`,{method:"PUT",body:p}).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>i(l)).catch(l=>o(l))})))).map(s=>s.file_name)}async uploadDocument(t,e){const a=new FormData;a.append("file",e),a.append("key",this.settings.encKey);const s=await fetch(`${J()}/doc/${t}`,{method:"PUT",body:a});if(s.ok)return await s.json();throw new Error(`Got response: ${s.status}`)}async freeDocument(t){const e=new FormData;e.append("key",this.settings.encKey);const a=await fetch(`${J()}/doc/${t}`,{method:"DELETE",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async renameTag(t,e){const a=new FormData;a.append("key",this.settings.encKey),a.append("oldTag",t),a.append("newTag",e);const s=await fetch(`${this.apiURL()}/dataman/tag-rename`,{method:"POST",body:a});if(s.ok)return!0;throw new Error(`Got response: ${s.status}`)}async deleteTag(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("tag",t);const a=await fetch(`${this.apiURL()}/dataman/tag-delete`,{method:"POST",body:e});if(a.ok)return!0;throw new Error(`Got response: ${a.status}`)}async reqUserInfo(t){const e=new FormData;e.append("key",this.settings.encKey);const a=await fetch(`${this.apiURL()}/user/info/${t}`,{method:"POST",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async updateUserNickname(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("name",t);const a=await fetch(`${this.apiURL()}/user/info-update`,{method:"POST",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async updateUserPassword(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("password",ce(t));const a=await fetch(`${this.apiURL()}/user/info-update`,{method:"POST",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async reqUserList(){const t=new FormData;t.append("key",this.settings.encKey);const e=await fetch(`${this.apiURL()}/user/list`,{method:"POST",body:t});if(e.ok)return await e.json();throw new Error(`Got response: ${e.status}`)}async uploadUserAvatar(t){const e=new FormData;e.append("file",t),e.append("key",this.settings.encKey);const a=await fetch(`${J()}/user-avatar`,{method:"PUT",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async setUserAccess(t,e,a){const s=new FormData;s.append("key",this.settings.encKey),s.append("username",t),e!==null&&s.append("is_admin",e.toString()),a!==null&&s.append("mandatory_tags",JSON.stringify(a));const i=await fetch(`${this.apiURL()}/userman/modify`,{method:"POST",body:s});if(i.ok)return await i.json();throw new Error(`Got response: ${i.status}`)}async createUser(t,e,a,s,i){const o=new FormData;o.append("key",this.settings.encKey),o.append("username",t),o.append("name",e),o.append("password",ce(a)),o.append("is_admin",s.toString()),o.append("mandatory_tags",JSON.stringify(i));const p=await fetch(`${this.apiURL()}/userman/create`,{method:"POST",body:o});if(p.ok)return await p.json();throw new Error(`Got response: ${p.status}`)}async deleteUser(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("username",t);const a=await fetch(`${this.apiURL()}/userman/delete`,{method:"POST",body:e});if(a.ok)return!0;throw new Error(`Got response: ${a.status}`)}async changelog(){const t=new URL(`${this.apiURL()}/info/changelog`);t.searchParams.append("key",this.settings.encKey);const e=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(e.ok&&e.status===200)return JSON.parse(await e.text());throw new Error(`Got response: ${e.status}`)}}const se="->";function Ze(){return`${J()}/api`}class z extends Set{static removeSpaces(t){const e=t.split(se);for(let a=0;a<e.length;a++)e[a]=e[a].trim();return t=e.join(se),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(a=>z.removeSpaces(a)),super(e)}add(t){return super.add(z.removeSpaces(t))}has(t){return super.has(z.removeSpaces(t))}union(t){const e=new z(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new z(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}issubset(t){return ye.isSubset(this,t)}withParents(){const t=new z(this);return this.forEach(e=>t.union_(ye.allParentsOf(e))),t}withChildsFrom(t){const e=new z(this);return this.forEach(a=>e.union_(ye.allChildsOf(a,t))),e}allParents(){const t=new z;return this.forEach(e=>t.union_(ye.allParentsOf(e))),t}toArray(){return Array.from(this)}}class ye{static allParentsOf(t){const e=t.split(se);if(e.length===1)return new z([]);const a=[],s=[];for(let i=0;i<e.length-1;i++)a.push(e[i]),s.push(a.join(se));return new z(s)}static allChildsOf(t,e){const a=new z;for(const s of e)s.startsWith(t)&&s.length>t.length+se.length&&s.substring(t.length,t.length+se.length)===`${se}`&&a.add(s);return a}static tagHierarchy(t){const e=se;function a(o,p){const l=o.split(p);return l.length===1?[o]:[l[0],l.slice(1).join(p)]}function s(o,p=e){const l={},d=o.map(u=>a(u,p));for(const u of d)u[0]in l||(l[u[0]]=[]),u.length===2&&l[u[0]].push(u[1]);const g={};for(const u in l)g[u]=s(l[u],p);return g}function i(o,p=e){for(const l in o){const d=o[l];for(const g in d){const u=[l,g].join(e);d[u]=d[g],delete d[g]}i(d,p)}return o}return i(s(Array.from(t)))}static isSubset(t,e){let a=!0;for(const s of t)if(!e.has(s)){a=!1;break}return a}}class Ve{constructor(t){le(this,"summary");le(this,"supp");this.summary=t,this.supp={note:null,abstract:null}}get tags(){return new z(this.summary.tags)}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{new R().reqDatapointAbstract(this.summary.uuid).then(a=>{this.supp.abstract=a,t(a)}).catch(a=>{e(a)})})}uploadAbstract(t){return new Promise((e,a)=>{if(t===this.supp.abstract||t===null){e(!0);return}new R().reqDatapointAbstractUpdate(this.summary.uuid,t).then(s=>{this.supp.abstract=t,e(s)}).catch(s=>{a(s)})})}fetchNote(){return new Promise((t,e)=>{new R().reqDatapointNote(this.summary.uuid).then(a=>{a=a.replace(/\.\/misc\//g,`${J()}/img/${this.summary.uuid}?fname=`),this.supp.note=a,t(a)}).catch(a=>{e(a)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):(t=t.replace(new RegExp(`${J()}/img/${this.summary.uuid}\\?fname=`,"g"),"./misc/"),new Promise((e,a)=>{new R().reqDatapointNoteUpdate(this.summary.uuid,t).then(s=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(i=>i.trim()==""?0:1).reduce((i,o)=>i+o,0),e(s)}).catch(s=>{a(s)})}))}uploadImages(t){return new Promise((e,a)=>{new R().uploadImages(this.summary.uuid,t).then(s=>{e(s.map(i=>`${J()}/img/${this.summary.uuid}?fname=${i}`))},s=>{a(s)})})}uploadDocument(t){return new R().uploadDocument(this.summary.uuid,t)}freeDocument(){return new R().freeDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=new R().reqDatapointSummary(this.summary.uuid);return e.then(a=>{this.summary=a}),e}destory(){this.summary=Be}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Be.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file&&this.summary.file_type==".pdf"?`${J()}/doc/${t}`:!this.summary.has_file&&this.summary.url?this.summary.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={}}={}){const e=this.summary.uuid,a=`${J()}/pdfjs/web/viewer.html`;function s(o,p=a){const l=new URLSearchParams;p===a&&l.append("key",Z().encKey),l.append("file",`${o}`);for(const d in t)l.append(d,t[d]);return`${p}?${l.toString()}`}let i="about:blank";if(this.isDummy()&&(i="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const o=`${J()}/doc/${e}`;i=s(o)}if(!this.summary.has_file&&this.summary.url){let o=this.summary.url;o.endsWith(".pdf")||o.includes("arxiv.org/pdf/")?i=o:i=this.summary.url}return console.log("Open doc url: ",i),i}getOpenNoteURL(){const t=this.summary.uuid;return`${Ze()}/comment/${t}/`}getOpenSummaryURL(){const t=this.summary.uuid;return`${Ze()}/summary?uuid=${t}&key=${Z().encKey}`}docType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Be={has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class Et{constructor(){le(this,"data");le(this,"_initliazed");this.data={},this._initliazed=!1}get initialized(){return this._initliazed}*[Symbol.iterator](){for(let t in this.data)yield this.data[t]}async requestData(){const e=await new R().reqFileList([]);console.log("Get infolist of size: ",(JSON.stringify(e).length*2/1024/1024).toPrecision(2),"MB"),this.clear();for(let a of e)this.add(a);this._initliazed=!0}async requestDataStream(t=()=>{}){const e=new R;this.clear(),await e.reqFileListStream([],(a,s,i)=>{this.add(a),t(s,i)}),console.log("Get datapoints of size: ",(JSON.stringify(this.data).length*2/1024/1024).toPrecision(2),"MB"),this._initliazed=!0}add(t){return this.data[t.uuid]=new Ve(t),this.data[t.uuid]}clear(){this.data={},this._initliazed=!1}delete(t){delete this.data[t]}get(t){return t in this.data?this.data[t]:new Ve(Be)}getMany(t){const e=[];for(const a of t)e.push(this.get(a));return e}getAllTags(){let t,e=new Set;for(const a of this){t=a.summary.tags;for(const s of t)e.add(s)}return new z(e)}getDataByTags(t){t=new z(t);const e=[];for(const a in this.data){const s=this.data[a],i=new z(s.summary.tags);t.issubset(i.withParents())&&e.push(s)}return e}async renameTag(t,e){if(t=z.removeSpaces(t),e=z.removeSpaces(e),await new R().renameTag(t,e)){const i=this.getDataByTags([t]);return(await Promise.all(i.map(p=>p.update()))).every(p=>p)}else return!1}async deleteTag(t){if(t=z.removeSpaces(t),await new R().deleteTag(t)){const s=this.getDataByTags([t]);return(await Promise.all(s.map(o=>o.update()))).every(o=>o)}else return!1}}class Me{static async filter(t,e){const a=e.content.toLowerCase();if(!a)return{datapoints:this.sortDefault(t,!1),scores:null};const s=new Set;for(const o of t)s.add(o.summary.uuid);const i=new Array;if(e.searchBy.toLowerCase()==="feature"){const p=await new R().search("searchFeature",{pattern:e.content,n_return:999}),l=new Array;for(const g of t)if(p[g.summary.uuid]){i.push(g);const u=p[g.summary.uuid].score;l.push(u)}const d=this.sortByScore(i,l,!1);return{datapoints:d[0],scores:d[1]}}else if(e.searchBy.toLowerCase()==="note"){const p=await new R().search("searchNote",{pattern:e.content,ignore_case:!0}),l=Object.keys(p);for(const d of t)l.includes(d.summary.uuid)&&i.push(d);return{datapoints:this.sortDefault(i,!1),scores:null}}else if(e.searchBy.toLowerCase()==="title")for(const o of t)o.summary.title.toLowerCase().search(a)!==-1&&i.push(o);else if(e.searchBy.toLowerCase()==="uuid")for(const o of t)o.summary.uuid.toLowerCase().search(a)!==-1&&i.push(o);else if(e.searchBy.toLowerCase()==="author"){const o=K().authorPublicationMap,p=_e(e.content);if(p in o)for(const l of o[p])s.has(l.summary.uuid)&&i.push(l);else for(const l in o)if(l.search(p)!==-1)for(const d of o[l])s.has(d.summary.uuid)&&i.push(d)}else if(e.searchBy.toLowerCase()==="publication")for(const o of t)o.summary.publication&&o.summary.publication.toLowerCase().search(a)!==-1&&i.push(o);else if(e.searchBy.toLowerCase()==="general")for(const o of t)`${o.summary.title}|${o.summary.authors.join(", ")}|${o.summary.year}`.toLowerCase().search(a)!==-1&&i.push(o);else throw new Error("Unknown searchBy option");return{datapoints:this.sortDefault(i,!1),scores:null}}static sortDefault(t,e=!1){return e?t.sort((a,s)=>a.summary.time_added-s.summary.time_added):t.sort((a,s)=>s.summary.time_added-a.summary.time_added)}static sortByScore(t,e,a=!1){if(t.length!==e.length)throw new Error("arr.length !== scores.length");const s=new Array;for(let l=0;l<t.length;l++)s.push([t[l],e[l]]);let i;a?i=s.sort((l,d)=>l[1]-d[1]):i=s.sort((l,d)=>d[1]-l[1]);const o=new Array,p=new Array;for(const l of i)o.push(l[0]),p.push(l[1]);return[o,p]}}function _e(r){r=r.trim().toLowerCase().replace(/-/g,"");let t=r.trim();if(t.includes(",")){const[e,a]=t.split(",",2);t=`${e.trim()}, ${a.trim()}`}else{if(t.indexOf(" ")===-1)return t;const e=t.lastIndexOf(" "),a=t.slice(e+1),s=t.slice(0,e);t=`${a.trim()}, ${s.trim()}`}return t}async function Ot(r){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(r),!0;{const t=document.createElement("textarea");t.value=r,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(a){console.log(a),e=!0}finally{t.remove()}return!e}}function Ie(r){window.open(r,"_blank")}function nt(r,t){let e=null;return function(...a){e&&window.clearTimeout(e),e=window.setTimeout(()=>{r(...a),e=null},t)}}const E=Oe("uiStatus",{state:()=>({tagStatus:{checked:new z,all:new z,unfolded:new z},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1}}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal}},actions:{updateShownData(){const r=K();this.tagStatus.all=r.allTags;const t=r.database.getDataByTags(this.tagStatus.checked);Me.filter(t,this.searchState).then(e=>{this.shownDataUIDs=e.datapoints.map(a=>a.summary.uuid),this.shownDataScores=e.scores})},addRecentlyReadDataUID(r){K().database.get(r).isDummy()||(this.recentlyReadDataUIDs.includes(r)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(r),1),this.recentlyReadDataUIDs.unshift(r),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop())},showPopup(r,t="info",e=3e3){const a=Math.random().toString();this.popupValues[a]={content:r,styleType:t},setTimeout(()=>{delete this.popupValues[a]},e)},reloadDatabase(r=!1){K().reload(r,()=>{this.databaseLoadingStatus.nCurrent=0,K().database.clear(),this.updateShownData()},()=>{this.updateShownData(),E().databaseLoadingStatus.nTotal=-1},()=>{this.showPopup(`Failed to load database from: ${new R().apiURL()}`,"alert"),E().databaseLoadingStatus.nTotal=-1},(t,e)=>{this.databaseLoadingStatus.nCurrent=t,this.databaseLoadingStatus.nTotal=e})}}}),K=Oe("data",{state:()=>({database:new Et,user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}}),getters:{authorPublicationMap(){const r={};console.log("Generating authorPublicationMap...");for(const t of this.database)for(let e of t.summary.authors)e=_e(e),e in r||(r[e]=[]),r[e].push(t);return r},allTags(){return this.database.getAllTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}},reload(r=!1,t=()=>{this.database.clear()},e=()=>{},a=()=>{},s=()=>{}){t();function i(o){o.database.requestDataStream(s).then(p=>{e()},p=>{a(p)})}r?new R().reqReloadDB().then(o=>{console.log("Reload: ",o),o?i(this):a(new Error("Failed to reload database from backend"))},o=>{a(o)}):i(this)}}}),Z=Oe("settings",{state:()=>({__encKey:localStorage.getItem("encKey")||sessionStorage.getItem("encKey")||"",__showTagPanel:(localStorage.getItem("showTagPanel")||"true")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__backendHost:sessionStorage.getItem("backendUrl")||Mt(),__backendPort:sessionStorage.getItem("backendPort")||zt(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)}},actions:{setEncKey(r,t){this.__encKey=r,t===!0?localStorage.setItem("encKey",r):(localStorage.getItem("encKey")&&localStorage.removeItem("encKey"),sessionStorage.setItem("encKey",r))},setBackendHost(r){this.__backendHost=r,sessionStorage.setItem("backendUrl",r)},setBackendPort(r){this.__backendPort=r,sessionStorage.setItem("backendPort",r)},setShowTagPanel(r){this.__showTagPanel=r,localStorage.setItem("showTagPanel",r.toString())},setShow3DScatterPlot(r){this.__show3DScatterPlot=r,localStorage.setItem("show3DScatterPlot",r.toString())},setReaderLayoutType(r){this.__readerLayoutType=r.toString(),localStorage.setItem("readerLayoutType",r.toString())}}});function Mt(){let r=window.location.protocol,t=window.location.hostname;return`${r}//${t}`}function zt(){return window.location.port}function ze(r,t,e){Z().setEncKey(r,e),t!==null?K().user=t:K().clearUserInfo(),t?Z().loggedIn=!0:Z().loggedIn=!1}function Ft(){ze("",null,!0)}async function Nt(){const r=new R,t=Z().encKey;try{const e=await r.authUsr(t);return ze(t,e,null),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function Ht(r,t){return ce(r+ce(t))}const we={};window.g_eventHooks=we;function ae(r,t){if(Array.isArray(r)){for(const e of r)ae(e,t);return}we[r]===void 0&&(we[r]=[]),we[r].push(t)}function Le(){return window.g_wsConn===void 0&&(window.g_wsConn=new Kt),window.g_wsConn}class Kt{constructor(){le(this,"resetRemainingRetries",()=>{this.__remainingRetries=100});le(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});le(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);le(this,"willTryReconnect",()=>this.__remainingRetries>0);this.resetRemainingRetries(),this.sessionID=ce(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:t=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}get settings(){return Z()}init({onopenCallback:t=()=>{},onmessageCallback:e=i=>{},oncloseCallback:a=()=>{},onfailedToConnectCallback:s=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s};const i=new URLSearchParams(window.location.search);i.append("key",this.settings.encKey),i.append("session_id",this.sessionID);const o=J().replace("https://","wss://").replace("http://","ws://")+"/ws?"+i.toString();return console.log("connecting to server websocket at: ",o),this.ws=new WebSocket(o),this.ws.onmessage=p=>{console.log(p);const l=JSON.parse(p.data);if(l.type==="event"){const d=l.content;if(console.log(d),Object.keys(we).includes(d.type))for(const g of we[d.type])g(d)}e(p)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 3 second"),a(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(p=>setTimeout(p,3e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.init({onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s})})):s()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}reset(){this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.init(this.__eventCallback_records)}close(){this.ws.readyState===WebSocket.OPEN?this.ws.close():console.log("server websocket not ready, cannot close")}}const Wt={class:"loading-widget"},Zt=q({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(r){const t=r,e=T(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(a,s)=>(y(),_("div",Wt,[n("div",{class:"loading-widget__spinner",style:Y(e.value)},null,4)]))}}),Ue=O(Zt,[["__scopeId","data-v-1d6933bb"]]),Vt={class:"loading-popout"},jt=q({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(r){const t=r;return(e,a)=>(y(),_("div",Vt,[C(Ue,{size:"25px"}),n("label",null,P(t.text),1)]))}}),Gt=O(jt,[["__scopeId","data-v-95a13423"]]),Jt=r=>(ee("data-v-9c66ae46"),r=r(),te(),r),Qt={id:"popups"},Yt=Jt(()=>n("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[n("div",null,[n("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),n("div",{style:{color:"gray"}},"Maximum retry exceeded")]),n("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[A(" Please check if the server is running, make sure your network is working properly, and try to "),n("b",{style:{"text-decoration":"underline"}},"reload the page"),A(". ")])],-1)),Xt={id:"app"},ea=q({__name:"App",setup(r){const t=ke(),e=E(),a=Z();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&Z().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&Z().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&Z().setEncKey(t.currentRoute.value.query.credential,null),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const u=()=>{a.loggedIn?a.loggedIn=!1:g()};Nt().then(h=>{h||u()},()=>{u()})}});const s=w(!1),i=w(!1),o=w(window.location.hash.split("?")[0]==="#/login");t.afterEach((u,h)=>{o.value=u.path==="/login"});const p=T(()=>!s.value&&!o.value&&!i.value),l=T(()=>i.value&&!o.value);function d(){console.log("Logged in."),Le().init({onopenCallback:()=>{s.value=!0,i.value=!1},oncloseCallback:()=>s.value=!1,onfailedToConnectCallback:()=>i.value=!0}),e.reloadDatabase()}function g(){console.log("Logged out from: ",t.currentRoute.value.fullPath),Le().isOpen()&&Le().close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}return ne(()=>a.loggedIn,(u,h)=>{u?d():g()}),ae("add_entry",u=>{const h=K(),v=u.datapoint_summary;h.database.add(v),e.updateShownData()}),ae("update_entry",u=>{var f;const h=K(),v=u.datapoint_summary;(f=h.database.get(v.uuid))==null||f.update(v),e.updateShownData()}),ae("delete_entry",u=>{const h=K(),v=u.uuid;h.database.delete(v),e.updateShownData()}),ae(["delete_tag","update_tag"],u=>{const h=new z([u.src_tag]),f=K().database.getDataByTags(h);Promise.all(f.map(c=>c.update())).then(()=>{e.updateShownData()},()=>{e.showPopup("Tag rename succeded at server side, but faild to fetch update, please reload the page","error")})}),ae("update_user",u=>{if(u.username===K().user.username){if(u.user_info===null)throw new Error("assertion failed: User info is null");for(const h of Object.keys(K().user))h!=="enc_key"&&(K().user[h]=u.user_info[h])}}),(u,h)=>{const v=Qe("router-view");return y(),_(H,null,[n("div",Qt,[(y(!0),_(H,null,X(Object.keys(x(e).popupValues),(f,c)=>(y(),V(We,{key:c,styleType:x(e).popupValues[f].styleType,style:Y({transform:`translate(-50%, ${-50+110*c}%) scale(0.9)`})},{default:B(()=>[A(P(x(e).popupValues[f].content),1)]),_:2},1032,["styleType","style"]))),128))]),p.value?(y(),V(Gt,{key:0,text:"connecting..."})):F("",!0),l.value?(y(),V(We,{key:1,styleType:"info",position:"center"},{default:B(()=>[Yt]),_:1})):F("",!0),n("div",Xt,[C(v,null,{default:B(({Component:f})=>[(y(),V(kt,{exclude:"Reader"},[(y(),V(bt(f)))],1024))]),_:1})])],64)}}}),ta=O(ea,[["__scopeId","data-v-9c66ae46"]]),aa={for:"chk"},na={id:"checkCircle"},sa={key:0,id:"checkStatus"},oa=q({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(r,{emit:t}){const e=t,a=r;function s(i){e("onCheck",a.identifier)}return(i,o)=>(y(),_("div",{class:"toggle",onClick:s},[n("label",aa,[me(i.$slots,"default",{},void 0,!0)]),n("div",na,[i.checked?(y(),_("div",sa)):F("",!0)])]))}}),pe=O(oa,[["__scopeId","data-v-582ee950"]]),ra={class:"toggleText"},ia={class:"children slideInDown"},la=q({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.tagStatus,set:f=>a("update:tagStatus",f)}),i=T(()=>{let f="collapseButton";return Object.keys(e.children).length!==0&&(f+=" collapsible"),f}),o=w(null),p=T(()=>!e.tagStatus.unfolded.has(e.identifier)),l=T(()=>p.value?"triangle-right":"triangle-down rotate90in");function d(f){let c=s.value.unfolded;c.has(e.identifier)?c.delete(e.identifier):c.add(e.identifier)}const g=T(()=>e.tagStatus.checked.has(e.identifier));function u(f){if(f===void 0)return;let c=s.value.checked;c.has(f)?c.delete(f):c.add(f)}const h=w(null),v=f=>{f.button===2&&(d(),f.preventDefault())};return qe(()=>{var f;(f=h.value)==null||f.addEventListener("contextmenu",v)}),Ye(()=>{var f;(f=h.value)==null||f.removeEventListener("contextmenu",v)}),(f,c)=>(y(),_(H,null,[n("div",{class:"row",ref_key:"rowDiv",ref:h},[n("div",{id:"button",class:fe(i.value),ref_key:"button",ref:o,onClick:d},[Object.keys(e.children).length!==0?(y(),_("div",{key:0,class:fe(l.value)},null,2)):F("",!0)],2),n("div",ra,[C(pe,{checked:g.value,identifier:e.identifier,onOnCheck:u},{default:B(()=>[me(f.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),W(n("div",ia,[(y(!0),_(H,null,X(f.children,(m,k)=>(y(),V(st,{identifier:String(k),children:m,"tag-status":s.value,"onUpdate:tagStatus":c[0]||(c[0]=b=>s.value=b)},{default:B(()=>[A(P(String(k).split(x(se)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[St,!p.value]])],64))}}),st=O(la,[["__scopeId","data-v-6b911d48"]]),ua={id:"tagSelector-main",class:"scrollable"},da=q({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(r,{emit:t}){const e=r,a=t,s=T(()=>ye.tagHierarchy(e.tagStatus.all)),i=T(()=>Object.keys(s.value).sort()),o=T({get:()=>e.tagStatus,set:p=>a("update:tagStatus",p)});return(p,l)=>(y(),_("div",ua,[(y(!0),_(H,null,X(i.value,d=>(y(),V(st,{identifier:String(d),children:s.value[d],tagStatus:o.value,"onUpdate:tagStatus":l[0]||(l[0]=g=>o.value=g)},{default:B(()=>[A(P(String(d).split(x(se)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),ot=O(da,[["__scopeId","data-v-bd49347d"]]),ca={key:0,class:"prefix"},pa=q({__name:"TagBubble",props:{tag:{},highlight:{type:Boolean,default:!1}},setup(r){const t=r,e=T(()=>{const a=t.tag.split(se);return a.length==1?["",a[0]]:[a.slice(0,a.length-1).join("Â·"),a[a.length-1]]});return(a,s)=>(y(),_("div",{class:fe(`bubble${a.highlight?" highlight":""}`)},[e.value[0]?(y(),_("div",ca,P(e.value[0]),1)):F("",!0),A(" "+P(e.value[1]),1)],2))}}),ha=O(pa,[["__scopeId","data-v-3c9e7ea3"]]),ma=q({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},setup(r){const t=r;return(e,a)=>(y(),_("div",{id:"bubbleContainer",class:"scrollable",style:Y({maxWidth:`${(t.maxWidth?t.maxWidth:999)-10}px`,justifyContent:t.middleAlign?"center":"flex-start"})},[(y(!0),_(H,null,X(t.tags,s=>(y(),V(ha,{tag:s,highlight:t.highlightTags?t.highlightTags.has(s):!1},null,8,["tag","highlight"]))),256))],4))}}),rt=O(ma,[["__scopeId","data-v-dc18fd18"]]),it=r=>(ee("data-v-bfef1e70"),r=r(),te(),r),fa=it(()=>n("h3",{class:"green"},"Tags",-1)),va=it(()=>n("hr",null,null,-1)),ga=q({__name:"FileTags",emits:["onCheck"],setup(r,{emit:t}){const e=t,a=E(),s=K(),i=w(null),o=T(()=>E().unfoldedDataUIDs.length==0?null:a.shownDataUIDs.includes(a.unfoldedDataUIDs[0])?K().database.get(E().unfoldedDataUIDs[0]):null),p=T(()=>o.value==null?null:a.tagStatus.checked.withChildsFrom(o.value.tags));function l(){a.tagStatus.checked=new z,a.updateShownData()}ne(a.tagStatus,()=>e("onCheck",a.tagStatus),{deep:!0});function d(){const u=prompt("Old tag");if(u&&s.database.getAllTags().has(u)){const h=prompt("New tag");h&&new R().renameTag(u,h).then(()=>{a.showPopup("Tag renamed","success")},()=>{a.showPopup("Failed to rename tag","error")})}else a.showPopup("Invalid tag","warning")}function g(){const u=prompt("Tag to delete");if(u&&s.database.getAllTags().has(u)){if(!confirm(`Are you sure to delete tag "${u}"?`))return;new R().deleteTag(u).then(()=>{a.showPopup("Tag deleted","success")},()=>{a.showPopup("Failed to delete tag","error")})}else a.showPopup("Invalid tag","warning")}return(u,h)=>(y(),_("div",{id:"file-tags-main",ref_key:"ftPanel",ref:i},[n("div",{class:"title"},[n("div",{id:"title-title"},[fa,n("div",{id:"title-buttons"},[n("div",{class:"button",onClick:d},"rename"),n("div",{class:"button",onClick:g},"delete")])]),va]),C(ot,{onOnCheck:h[0]||(h[0]=v=>e("onCheck",v)),tagStatus:x(a).tagStatus,"onUpdate:tagStatus":h[1]||(h[1]=v=>x(a).tagStatus=v)},null,8,["tagStatus"]),o.value?(y(),V(rt,{key:0,tags:o.value.tags,highlightTags:p.value,maxWidth:i.value?i.value.clientWidth:null},null,8,["tags","highlightTags","maxWidth"])):F("",!0),n("div",{class:"buttons"},[n("button",{id:"btnClear",class:"green",onClick:l},"CLEAR SELECTION")])],512))}}),ya=O(ga,[["__scopeId","data-v-bfef1e70"]]),wa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",Fe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",_a="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",ba="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",ka="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",Sa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",$a=r=>(ee("data-v-97dd0391"),r=r(),te(),r),Da={key:0,id:"window"},Ca={class:"header"},xa=$a(()=>n("span",{class:"close-icon"},"âœ•",-1)),Ta=[xa],Pa=q({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:o=>{a("update:show",o)}});function i(){s.value=!1,a("onClose"),a("close")}return window.addEventListener("keydown",o=>{o.key===e.closeKey&&(i(),o.preventDefault())}),(o,p)=>s.value?(y(),_("div",Da,[n("div",{id:"blocker",onClick:i,style:Y({"z-index":o.zIndex-1})},null,4),n("div",{class:"floating-window",style:Y({"z-index":o.zIndex})},[n("div",Ca,[n("label",null,P(e.title),1),n("button",{class:"close-button",onClick:i},Ta)]),n("div",{class:"window-content scrollable",style:Y({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[me(o.$slots,"default",{},void 0,!0)],4)],4)])):F("",!0)}}),De=O(Pa,[["__scopeId","data-v-97dd0391"]]),Ia={id:"query-dialog-main"},La={class:"content"},Ua={id:"buttons"},Aa=q({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:i=>{a("update:show",i)}});return(i,o)=>(y(),V(De,{show:s.value,"onUpdate:show":o[2]||(o[2]=p=>s.value=p),title:i.title,compact:!0,"z-index":i.zIndex,onOnClose:o[3]||(o[3]=()=>a("onClose"))},{default:B(()=>[n("div",Ia,[n("div",La,[me(i.$slots,"default",{},void 0,!0)]),n("div",Ua,[n("div",{class:"button ok-button",onClick:o[0]||(o[0]=()=>a("onAccept"))},"OK"),i.showCancel?(y(),_("div",{key:0,class:"button cancel-button last-button",onClick:o[1]||(o[1]=()=>a("onCancel"))},"Cancel")):F("",!0)])])]),_:3},8,["show","title","z-index"]))}}),he=O(Aa,[["__scopeId","data-v-81948a9f"]]),Ra=r=>(ee("data-v-1d8f6d0c"),r=r(),te(),r),Ba={id:"tag-selector-with-entry-main"},qa={style:{textAlign:"left"}},Ea=Ra(()=>n("label",{for:"tagSelector"},"Tags",-1)),Oa={id:"tagSelector",class:"scrollable"},Ma={class:"entry"},za=q({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.tagStatus,set:l=>a("update:tagStatus",l)}),i=w(e.tagInputValue);ne(()=>e.tagInputValue,l=>{i.value=l});const o=T({get:()=>i.value,set:l=>{a("update:tagInputValue",l),i.value=l}}),p=()=>{const l=o.value.trim();l!==""&&(s.value.all.add(l),s.value.checked.add(l),s.value.unfolded.union_(ye.allParentsOf(l)),o.value="")};return(l,d)=>(y(),_("div",Ba,[n("div",qa,[Ea,n("div",Oa,[C(ot,{tagStatus:s.value,"onUpdate:tagStatus":d[0]||(d[0]=g=>s.value=g)},null,8,["tagStatus"])])]),n("div",Ma,[W(n("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":d[1]||(d[1]=g=>o.value=g),onKeyup:Ee(p,["enter"])},null,544),[[Q,o.value]]),n("button",{class:fe(`green${o.value?" to-be-confirmed":""}`),onClick:p},"ADD",2)])]))}}),lt=O(za,[["__scopeId","data-v-1d8f6d0c"]]);async function Fa(r=10,t="cat:cs.AI OR cat:cs.CV",e="submittedDate",a="descending"){const i=`https://export.arxiv.org/api/query?${`search_query=${encodeURIComponent(t)}&sortBy=${e}&sortOrder=${a}&max_results=${r}`}`,p=await(await fetch(i,{method:"GET"})).text();let g=new et.XMLParser().parse(p).feed.entry;Array.isArray(g)||(g=[g]);function u(h){return Array.isArray(h.author)?h.author.map(v=>v.name):h.author?[h.author.name]:[]}if(g&&Array.isArray(g))return g.map(v=>{const f=v.id.split("/").pop().split("v")[0],c=v.id,m=v.title,k=v.summary,b=u(v),S=v.updated,$=v.published;return{id:f,link:c,title:m,abstract:k,authors:b,updatedTime:S,publishedTime:$}});throw new Error("Invalid feed data")}async function Na(r){const t=`https://export.arxiv.org/api/query?id_list=${r}`,a=await(await fetch(t,{method:"GET"})).text();let o=new et.XMLParser().parse(a).feed.entry;function p(l){return Array.isArray(l.author)?l.author.map(d=>d.name):l.author?[l.author.name]:[]}if(o){const l=o.id.split("/").pop().split("v")[0],d=o.id,g=o.title,u=o.summary,h=p(o),v=o.updated,f=o.published;return{id:l,link:d,title:g,abstract:u,authors:h,updatedTime:v,publishedTime:f}}else throw new Error("Failed to fetch paper from arxiv")}function ut(r){return`@article{${r.id},
  author = {${r.authors.join(" and ")}},
  title = {${r.title}},
  journal = {arXiv preprint arXiv:${r.id}},
  year = {${r.publishedTime.split("-")[0]}},
  abstract = {${r.abstract}}
  }`.replace(/  /g,"")}const Ha=r=>{const t=Math.random().toString(36).substring(7);return r=="article"?`@article{${t},
        author = {},
        title = {},
        journal = {},
        year = {${new Date().getFullYear()}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):r=="inproceedings"?`@inproceedings{${t},
        author = {},
        title = {},
        booktitle = {},
        year = {${new Date().getFullYear()}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):r=="webpage"?`@misc{${t},
        title = "{}",
        author = "{}",
        year = {${new Date().getFullYear()}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):""};class Ka{async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const a=await Na(e);return{bibtex:ut(a),url:a.link}}async fromWebpage(t){var l;const a=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),o=(l=new DOMParser().parseFromString(a,"text/html").querySelector("title"))==null?void 0:l.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${o}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const ve=r=>(ee("data-v-721cd2bf"),r=r(),te(),r),Wa={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},Za={style:{margin:"10px"}},Va=ve(()=>n("legend",null,"Source",-1)),ja={class:"bibsource-container"},Ga=ve(()=>n("legend",{for:"bibsource-arxiv"},"arxiv",-1)),Ja={class:"bibsource-container"},Qa=ve(()=>n("legend",{for:"bibsource-doi"},"doi",-1)),Ya={class:"bibsource-container"},Xa=ve(()=>n("legend",{for:"bibsource-webpage"},"webpage",-1)),en=["placeholder"],tn={key:0},an={id:"inputDiv"},nn={id:"inputLeft"},sn={id:"bibtexArea"},on={class:"horizontal"},rn=ve(()=>n("label",{for:"bibtex"},"Bibtex",-1)),ln={id:"bibtexSource",class:"horizontal"},un={id:"urlArea"},dn=ve(()=>n("label",{for:"url"},"URL: ",-1)),cn={id:"inputRight"},pn={key:1},hn=ve(()=>n("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[n("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation"),n("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),mn=[hn],fn=q({__name:"DataEditor",props:{datapoint:{},show:{type:Boolean}},emits:["update:show"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:N=>a("update:show",N)}),i=E(),o=w(""),p=w(""),l=w({all:new z,checked:new z,unfolded:new z});function d(){let N=null;e.datapoint&&(N=e.datapoint.summary.uuid),s.value=!1,i.showPopup("Saving entry...","info"),new R().editData(N,o.value,Array.from(l.value.checked),p.value).then(I=>{i.showPopup("Saved","success")},()=>i.showPopup("Failed to save","error"))}const g=w("");ne(s,N=>{N&&(e.datapoint?o.value=e.datapoint.summary.bibtex:o.value="",e.datapoint?p.value=e.datapoint.summary.url:p.value="",l.value={all:new z(i.tagStatus.all),checked:e.datapoint?new z(e.datapoint.summary.tags):new z(i.tagStatus.checked),unfolded:e.datapoint?new z(e.datapoint.summary.tags).allParents():new z(i.tagStatus.unfolded)},g.value="")});const u=w(!1),h=w("article"),v=T(()=>Ha(h.value)),f=w(!1),c=w("arxiv"),m=new Ka,k={arxiv:N=>m.fromArxiv(N),doi:N=>m.fromDoi(N),webpage:N=>m.fromWebpage(N)},b={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},S=w("");function $(N){i.showPopup("Fetching from BibTeX source...","info"),f.value=!1,S.value="",k[c.value](N).then(I=>{i.showPopup("Obtained bibtex from source","success"),o.value=I.bibtex,p.value=I.url},()=>{i.showPopup("Failed to fetch from source","error")})}const D=w(!1),L=w(null),U=N=>{N.preventDefault(),D.value=!0},j=N=>{N.preventDefault(),D.value=!1},ue=N=>{var M;N.preventDefault();const I=(M=N.dataTransfer)==null?void 0:M.files;if(I&&I.length>0){const de=I[0];if(de.size<64*1024){const He=new FileReader;He.onload=gt=>{var Ke;const yt=(Ke=gt.target)==null?void 0:Ke.result;o.value=yt},He.readAsText(de)}else i.showPopup("File too large","error")}};return ne(s,N=>{N?(window.addEventListener("dragover",U),window.addEventListener("drop",ue),window.addEventListener("dragleave",j)):(D.value=!1,window.removeEventListener("dragover",U),window.removeEventListener("drop",ue),window.removeEventListener("dragleave",j))}),(N,I)=>(y(),_(H,null,[C(he,{show:u.value,"onUpdate:show":I[3]||(I[3]=M=>u.value=M),onOnAccept:I[4]||(I[4]=()=>{o.value=v.value,u.value=!1}),onOnCancel:I[5]||(I[5]=M=>u.value=!1),"z-index":102,title:"Select template"},{default:B(()=>[n("div",Wa,[C(pe,{onOnCheck:I[0]||(I[0]=M=>h.value="article"),checked:h.value=="article"},{default:B(()=>[A("Article")]),_:1},8,["checked"]),C(pe,{onOnCheck:I[1]||(I[1]=M=>h.value="inproceedings"),checked:h.value=="inproceedings"},{default:B(()=>[A("Inproceedings")]),_:1},8,["checked"]),C(pe,{onOnCheck:I[2]||(I[2]=M=>h.value="webpage"),checked:h.value=="webpage"},{default:B(()=>[A("Webpage")]),_:1},8,["checked"])])]),_:1},8,["show"]),C(he,{show:f.value,"onUpdate:show":I[10]||(I[10]=M=>f.value=M),onOnCancel:I[11]||(I[11]=M=>f.value=!1),onOnAccept:I[12]||(I[12]=()=>{$(S.value)}),"z-index":102,title:"Source input"},{default:B(()=>[n("div",Za,[n("fieldset",{style:Y({display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"})},[Va,n("div",ja,[W(n("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":I[6]||(I[6]=M=>c.value=M)},null,512),[[Ae,c.value]]),Ga]),n("div",Ja,[W(n("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":I[7]||(I[7]=M=>c.value=M)},null,512),[[Ae,c.value]]),Qa]),n("div",Ya,[W(n("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":I[8]||(I[8]=M=>c.value=M)},null,512),[[Ae,c.value]]),Xa])],4),W(n("input",{type:"text","onUpdate:modelValue":I[9]||(I[9]=M=>S.value=M),placeholder:b[c.value],style:{width:"100%",marginTop:"10px"}},null,8,en),[[Q,S.value]])])]),_:1},8,["show"]),C(he,{show:s.value,"onUpdate:show":I[19]||(I[19]=M=>s.value=M),title:N.datapoint?N.datapoint.authorAbbr():"new","show-cancel":!1,onOnAccept:d,onOnCancel:I[20]||(I[20]=()=>s.value=!1)},{default:B(()=>[n("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:L},[D.value?(y(),_("div",pn,mn)):(y(),_("div",tn,[n("div",an,[n("div",nn,[n("div",sn,[n("div",on,[rn,n("div",ln,[n("div",{class:"button",onClick:I[13]||(I[13]=M=>u.value=!0)},"template"),n("div",{class:"button",onClick:I[14]||(I[14]=M=>f.value=!0)},"from-source")])]),W(n("textarea",{id:"bibtex","onUpdate:modelValue":I[15]||(I[15]=M=>o.value=M),placeholder:"bibtex / enw / nbib"},null,512),[[Q,o.value]])]),n("div",un,[dn,W(n("input",{id:"url","onUpdate:modelValue":I[16]||(I[16]=M=>p.value=M),placeholder:"url",type:"text"},null,512),[[Q,p.value]])])]),n("div",cn,[C(lt,{"tag-status":l.value,"onUpdate:tagStatus":I[17]||(I[17]=M=>l.value=M),"tag-input-value":g.value,"onUpdate:tagInputValue":I[18]||(I[18]=M=>g.value=M)},null,8,["tag-status","tag-input-value"])])])]))],512)]),_:1},8,["show","title"])],64))}}),dt=O(fn,[["__scopeId","data-v-721cd2bf"]]),vn={key:0,id:"arrow"},gn=["onKeydown","onClick"],yn=q({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:o=>{a("update:show",o)}});function i(){s.value=!1}return(o,p)=>(y(),_(H,null,[o.blocker?(y(),_("div",{key:0,id:"blocker",onClick:i,style:Y({zIndex:e.zIndex-1})},null,4)):F("",!0),n("div",{id:"floatingMenu",style:Y({left:e.position.x+"px",top:e.position.y+"px",visibility:s.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(y(),_("div",vn)):F("",!0),(y(!0),_(H,null,X(e.menuItems,(l,d)=>(y(),_("div",{class:fe(`non-selectable floatingMenuItem${d!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Ee(g=>{l.action(),i()},["enter"]),onClick:g=>{l.action(),i()}},P(l.name),43,gn))),256))],4)],64))}}),wn=O(yn,[["__scopeId","data-v-c6b659c7"]]),Ne=q({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0}},setup(r,t){const e=w(null),a=i=>{const o=i.target;if(o.files&&o.files.length>0){const p=o.files[0];r.action(p)}};function s(){e.value.click()}return t.expose({click:s}),()=>C("div",{class:"upload-button",style:"display:flex"},[C("input",{type:"file",id:"upload-file",onChange:a,ref:e,style:{display:"none"}},null),r.asLink?C("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click()},[r.text]):C("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click()},[r.text])])}}),ct=q({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(r,t){const e=w(null),a=u=>{e.value.innerText=u},s=u=>{e.value.contentEditable=u.toString()},i=u=>e.value.contains(u),o=function(){return document.activeElement===e.value},p=T({get(){return e.value.innerText},set(u){e.value.innerText=u}});t.expose({setText:a,setEditable:s,contains:i,innerText:p,hasFocus:o});const l=()=>{t.emit("change",e.value.innerText)},d=()=>{t.emit("finish",e.value.innerText)},g=u=>{if(u.key==="Enter")if(u.ctrlKey||u.metaKey){u.preventDefault();const h=window.getSelection(),v=h==null?void 0:h.getRangeAt(0);if(v){const f=document.createElement("br");v.insertNode(f),v.setStartAfter(f),v.setEndAfter(f),h==null||h.removeAllRanges(),h==null||h.addRange(v)}}else e.value.blur()};return()=>C("p",{class:"editable-paragraph",contenteditable:r.contentEditable,ref:e,onInput:l,onBlur:d,onKeydown:g,style:r.style},[t.slots.default&&t.slots.default()])}}),pt=q({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(r,t){const e=w(!1),a=w(null),s=w({x:0,y:0});return ne(e,i=>{if(i){const o=a.value.getBoundingClientRect();s.value={x:o.left+o.width/2,y:o.bottom+5}}else s.value={x:0,y:0}}),()=>C("div",null,[C("div",{ref:a,onClick:()=>e.value=!e.value,onKeydown:i=>{i.key==="Enter"&&(i.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),C(wn,{show:e.value,"onUpdate:show":i=>e.value=i,menuItems:r.menuItems,position:s.value,middleTop:!0,arrow:!0},null)])}}),_n=q({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(r,t){const e={width:`${r.size}`,height:`${r.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>C("img",{src:r.href,alt:r.alt,style:e,onClick:()=>t.emit("click")},null)}}),ge=r=>(ee("data-v-bacf3243"),r=r(),te(),r),bn={class:"layout"},kn={id:"info"},Sn=ge(()=>n("td",null,[n("b",null,"Authors")],-1)),$n={id:"authorTD"},Dn=["onClick"],Cn={key:0,id:"otherPubTR"},xn={colspan:"2"},Tn={id:"authorPapers"},Pn=ge(()=>n("td",null,[n("b",null,"Publication")],-1)),In=ge(()=>n("td",null,[n("b",null,"Year")],-1)),Ln=ge(()=>n("td",null,[n("b",null,"Tags")],-1)),Un=ge(()=>n("td",null,[n("b",null,"Type")],-1)),An={id:"shortSummary"},Rn={id:"shortSummaryTitle"},Bn=ge(()=>n("b",null,"AI Summary",-1)),qn=ge(()=>n("summary",null,[n("b",null,"Related Articles")],-1)),En=q({__name:"DataSummary",props:{datapoint:{}},setup(r){const t=r,e=K(),a=w([]),s=w([]),i=T(()=>Object.fromEntries(a.value.map((m,k)=>[m.summary.uuid,s.value[k].toPrecision(3)]))),o=new R,p=w(null),l=w("");function d(m=!1){l.value="Loading...";let k="";o.reqAISummary(t.datapoint.summary.uuid,b=>{b.replace(/\\n/g,"<br>"),k+=b,l.value=k},()=>{g(),console.log("finished")},m)}async function g(){let m=null;if(t.datapoint.supp.abstract?m=t.datapoint.supp.abstract:m=await t.datapoint.fetchAbstract(),!m)if(l.value&&!l.value.startsWith("Error")&&!l.value.startsWith("Loading"))m=l.value;else throw new Error("No content to search for related articles");if(m=="")return;const b=await new R().search("searchFeature",{pattern:m,n_return:9}),S=new Array,$=new Array;for(const D of e.database.getDataByTags([]))if(b[D.summary.uuid]){S.push(D);const L=b[D.summary.uuid].score;$.push(L)}[a.value,s.value]=Me.sortByScore(S,$,!1),a.value&&a.value[0].summary.uuid==t.datapoint.summary.uuid&&(a.value.shift(),s.value.shift())}const u=w(""),h=w([]);function v(m){m=_e(m),console.log("check publication of author: ",m),h.value=e.authorPublicationMap[m],h.value=h.value.filter(k=>k.summary.uuid!=t.datapoint.summary.uuid),u.value===m?u.value="":u.value=m}function f(m){const k=e.authorPublicationMap;return m=_e(m),!(m in k)||k[m].length==1?null:k[m].length-1}be(()=>{d(!1)});const c=T(()=>{const $=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,D=(Math.sin($)+1)*.5*1200,L=Math.round(D);return`${window.innerWidth-L}px`});return(m,k)=>(y(),_("div",{id:"main",style:Y({width:c.value})},[n("h2",null,P(m.datapoint.summary.title),1),n("div",bn,[n("div",kn,[n("table",null,[n("tr",null,[Sn,n("td",$n,[(y(!0),_(H,null,X(m.datapoint.summary.authors,b=>(y(),_("div",null,[n("span",null,P(b),1),f(b)!==null?(y(),_("a",{key:0,onClick:()=>v(b)}," ("+P(f(b))+") ",9,Dn)):F("",!0)]))),256))])]),C($e,{name:"slideDown"},{default:B(()=>[u.value?(y(),_("tr",Cn,[n("td",xn,[n("b",null,P(`Other publications from ${u.value.toUpperCase()}:`),1),n("div",Tn,[C(Ce,{datapoints:h.value},null,8,["datapoints"])])])])):F("",!0)]),_:1}),n("tr",null,[Pn,n("td",null,P(m.datapoint.summary.publication),1)]),n("tr",null,[In,n("td",null,P(m.datapoint.summary.year),1)]),n("tr",null,[Ln,n("td",null,P(m.datapoint.summary.tags.toString()),1)]),n("tr",null,[Un,n("td",null,P(m.datapoint.docType()+`${m.datapoint.summary.has_file?" ("+m.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),n("div",An,[n("div",Rn,[Bn,n("div",{class:"button",onClick:k[0]||(k[0]=b=>d(!0))},"â†»")]),n("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:p},P(l.value),513)]),n("details",null,[qn,C(Ce,{datapoints:a.value,scores:i.value},null,8,["datapoints","scores"])])])],4))}}),On=O(En,[["__scopeId","data-v-bacf3243"]]),Mn=r=>(ee("data-v-688f89ab"),r=r(),te(),r),zn={id:"citations",style:{textAlign:"left"}},Fn=["onClick"],Nn={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},Hn={key:0},Kn={key:0,id:"moreMain"},Wn={class:"row",id:"buttons"},Zn={key:0,class:"row",id:"actions"},Vn={id:"abstract"},jn=Mn(()=>n("summary",null,"Abstract",-1)),Gn=q({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(r,{expose:t}){const e=r,a=E(),s=w(null),i=async b=>{b.target instanceof HTMLDetailsElement&&!b.target.open||(s.value.setEditable(!1),s.value.innerText="Loading...",e.datapoint.fetchAbstract().then(S=>{s.value.innerText=S,s.value.setEditable(!0)},()=>{s.value.innerText="Failed to load abstract."}))},o=async b=>{b&&(await e.datapoint.uploadAbstract(b),await e.datapoint.update())},p=w(!1);function l(b,S){return[b,`${S.length>80?S.slice(0,80)+"...":S}`,S]}function d(b){Ot(b).then(S=>{S?a.showPopup("Copied to clipboard.","info"):a.showPopup("Failed to copy to clipboard.","error")})}const g=w(!1);function u(b){a.showPopup("uploading..."),e.datapoint.uploadDocument(b).then(S=>{e.datapoint.update(S),a.showPopup("Document uploaded","success")},()=>a.showPopup("Failed to upload document","error"))}function h(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(b=>{e.datapoint.update(b),a.showPopup("Document deleted","info")},()=>a.showPopup("Failed to free document","error"))}function v(){const b=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&new R().deleteData(b).then(S=>{a.showPopup("Deleted")})}const f=w(!1);function c(){f.value=!0}const m=T(()=>s.value===null?!f.value:!f.value&&!s.value.hasFocus());t({editThisDatapoint:c,shouldEnableEditDatapoint:m});const k=w(!1);return(b,S)=>{const $=Qe("router-link");return y(),_(H,null,[C(De,{show:k.value,"onUpdate:show":S[0]||(S[0]=D=>k.value=D),title:"Summary"},{default:B(()=>[C(On,{datapoint:b.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),C(De,{show:p.value,"onUpdate:show":S[1]||(S[1]=D=>p.value=D),title:"Citations"},{default:B(()=>[(y(!0),_(H,null,X([l("Title",`${b.datapoint.summary.title}`),l("Author-year",`${b.datapoint.authorAbbr()} (${b.datapoint.summary.year})`),l("APA",`${b.datapoint.authorAbbr()} (${b.datapoint.summary.year}). ${b.datapoint.summary.title}. ${b.datapoint.summary.publication}.`),l("Bibtex",b.datapoint.summary.bibtex),l("DocURL",b.datapoint.getRawDocURL()),l("Markdown",`[${b.datapoint.authorAbbr()} (${b.datapoint.summary.year})](${b.datapoint.getRawDocURL()})`)],(D,L)=>(y(),_("div",zn,[n("div",{onClick:()=>{d(D[2]),p.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[n("div",{class:"citation-type",style:Y({marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"})},P(D[0]),5),n("p",Nn,P(D[1]),1)],8,Fn),L!==5?(y(),_("hr",Hn)):F("",!0)]))),256))]),_:1},8,["show"]),C(dt,{show:f.value,"onUpdate:show":S[2]||(S[2]=D=>f.value=D),datapoint:b.datapoint},null,8,["show","datapoint"]),C($e,{name:"expand-transition"},{default:B(()=>[b.show?(y(),_("div",Kn,[n("div",Wn,[C($,{to:`/reader/${e.datapoint.summary.uuid}`},{default:B(()=>[A("Reader")]),_:1},8,["to"]),n("a",{rel:"noopener noreferrer",onClick:S[3]||(S[3]=()=>k.value=!k.value)},"Summary"),n("a",{rel:"noopener noreferrer",onClick:S[4]||(S[4]=()=>p.value=!p.value)},"Cite"),n("a",{rel:"noopener noreferrer",onClick:S[5]||(S[5]=()=>g.value=!g.value)},"Actions")]),C($e,{name:"actions"},{default:B(()=>[g.value?(y(),_("div",Zn,[n("a",{rel:"noopener noreferrer",class:"btn",onClick:c},"Edit"),b.datapoint.summary.has_file?(y(),_("a",{key:1,rel:"noopener noreferrer",onClick:h,class:"danger btn"},"Free document")):(y(),V(x(Ne),{key:0,action:D=>u(D),text:"Upload document","as-link":!0},null,8,["action"])),n("a",{rel:"noopener noreferrer",onClick:v,class:"danger btn"},"Delete")])):F("",!0)]),_:1}),n("div",Vn,[n("details",{onToggle:i},[jn,C(x(ct),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:s,style:{minHeight:"20px"},onFinish:S[6]||(S[6]=D=>o(D))},null,512)],32)])])):F("",!0)]),_:1})],64)}}}),Jn=O(Gn,[["__scopeId","data-v-688f89ab"]]),je=[];class G{static registerThemeChangeCallback(t){je.push(t)}static toggleDarkMode(){document.documentElement.classList.contains("light")?G.setDarkMode(!0):document.documentElement.classList.contains("dark")?G.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,G.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?G.setDarkMode(!0):t=="light"?G.setDarkMode(!1):G.isDefaultDarkMode()&&!G.isDarkMode()&&G.toggleDarkMode()}static setDarkMode(t){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));const e=t?"dark":"light";if(localStorage.getItem("themeMode")!==e){localStorage.setItem("themeMode",t?"dark":"light");for(let a of je)a(t)}}}function Ge(r,t){let e=r.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Se(r){if(r===null||typeof r!="object")return r;let t=Array.isArray(r)?[]:{};for(let e in r)t[e]=Se(r[e]);return t}const Qn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",Yn="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",Xn={class:"left row"},es={id:"marks"},ts=["src"],as=["src"],ns={id:"title",class:"text"},ss={class:"right row"},os={id:"statusDiv"},rs={class:"status"},is={key:0,src:wa,alt:"",class:"icon"},ls={key:1,src:Fe,alt:"",class:"icon placeholder"},us={class:"status"},ds={key:0,src:_a,alt:"",class:"icon"},cs={key:1,src:ba,alt:"",class:"icon"},ps={key:2,src:Fe,alt:"",class:"icon placeholder"},hs={class:"status"},ms={key:0,src:ka,alt:"",class:"icon"},fs={key:1,src:Sa,alt:"",class:"icon"},vs={key:2,src:Fe,alt:"",class:"icon placeholder"},gs=12,ys=1,ws=q({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0},compact:{type:Boolean,default:!1}},emits:["update:unfoldedIds","update:hoveredIds"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.unfoldedIds,set:L=>a("update:unfoldedIds",L)}),i=T({get:()=>e.hoveredIds,set:L=>a("update:hoveredIds",L)}),o=T(()=>s.value.includes(e.datapoint.summary.uuid)),p=w(!1),l=w(null),d=w(null),g=w(null),u=w(null),h=w(null);let v=!1;function f(L){if(Ge(L.target,l.value)){if(L.target.id=="authorYear"){const U=e.datapoint.getOpenDocURL();U!==""&&Ie(U),v=!0}if(!Ge(L.target,g.value)){if(v){v=!1;return}o.value?s.value=s.value.filter(U=>U!==e.datapoint.summary.uuid):s.value=[e.datapoint.summary.uuid]}}}function c(){p.value=!0}function m(){p.value=!1}const k=T(()=>{if(p.value){const U=e.datapoint.docType();return U===""?"_":U}else return e.datapoint.yearAuthor(" :: ")}),b=w(!1);ne(b,L=>{L?i.value.push(e.datapoint.summary.uuid):i.value=i.value.filter(U=>U!==e.datapoint.summary.uuid)});const S=T(()=>b.value?"var(--color-background-theme-highlight)":s.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":!e.compact||e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)");function $(L){const U=e.datapoint.summary.tags.slice();L?U.push("* Bookmark"):U.splice(U.indexOf("* Bookmark"),1);const j=e.datapoint.summary.uuid;new R().editData(j,null,U).then(ue=>{e.datapoint.update(ue),E().updateShownData()},()=>E().showPopup("Failed to save","error")),v=!0}function D(L){var U,j;L.code==="Space"&&s.value.includes(e.datapoint.summary.uuid)&&b.value&&document.activeElement===document.body&&(U=u.value)!=null&&U.shouldEnableEditDatapoint&&((j=u.value)==null||j.editThisDatapoint(),L.preventDefault())}return ne(()=>s.value,L=>{L.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",D):window.removeEventListener("keydown",D)}),(L,U)=>(y(),_("div",{id:"fileRow",class:fe(`${e.compact&&!o.value?" compact":""}${o.value?" unfolded":""}`),onClick:f,onMouseover:U[2]||(U[2]=j=>b.value=!0),onMouseleave:U[3]||(U[3]=j=>b.value=!1),ref_key:"dataCard",ref:l,style:Y({backgroundColor:S.value})},[n("div",{id:"init",class:"row",ref_key:"initDiv",ref:d},[n("div",Xn,[n("div",{id:"leadingStatus",class:"row",ref_key:"leadingStatus",ref:h},[n("div",{id:"authorYear",class:"row text",onMouseover:c,onMouseleave:m},P(k.value),33),n("div",es,[L.datapoint.summary.tags.includes("* Bookmark")?(y(),_("img",{key:0,src:x(Yn),alt:"",class:"icon redIcon",onClick:U[0]||(U[0]=()=>$(!1))},null,8,ts)):(y(),_("img",{key:1,src:x(Qn),alt:"",class:"icon",onClick:U[1]||(U[1]=()=>$(!0))},null,8,as))])],512),n("div",ns,P(L.datapoint.summary.title),1),me(L.$slots,"default",{},void 0,!0)]),n("div",ss,[n("div",os,[n("div",rs,[L.datapoint.summary.has_abstract?(y(),_("img",is)):(y(),_("img",ls))]),n("div",us,[L.datapoint.summary.file_type==".pdf"?(y(),_("img",ds)):L.datapoint.summary.url?(y(),_("img",cs)):(y(),_("img",ps))]),n("div",hs,[L.datapoint.summary.note_linecount>gs?(y(),_("img",ms)):L.datapoint.summary.note_linecount>ys?(y(),_("img",fs)):(y(),_("img",vs))])])])],512),n("div",{id:"more",ref_key:"moreDiv",ref:g},[C(Jn,{datapoint:L.datapoint,show:o.value,ref_key:"moreComponent",ref:u},null,8,["datapoint","show"])],512)],38))}}),_s=O(ws,[["__scopeId","data-v-4d7047f6"]]),bs={key:0,class:"relatedArticleScore"},ks=q({__name:"FileRowContainer",props:{datapoints:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(r,{emit:t}){const e=r,a=t,s=w([]),i=T({get:()=>e.unfoldedIds==null?s.value:e.unfoldedIds,set:d=>{e.unfoldedIds==null?s.value=d:a("update:unfoldedIds",d)}}),o=w([]),p=T({get:()=>e.hoveredIds==null?o.value:e.hoveredIds,set:d=>{e.hoveredIds==null?o.value=d:a("update:hoveredIds",d)}}),l=T({get:()=>e.datapoints,set:d=>a("update:datapoints",d)});return(d,g)=>(y(),_("div",{id:"dataCardContainer",style:Y({gap:d.compact?"0px":"5px"})},[(y(!0),_(H,null,X(l.value,(u,h)=>(y(),V(_s,{datapoint:u,"unfolded-ids":i.value,"onUpdate:unfoldedIds":g[0]||(g[0]=v=>i.value=v),"hovered-ids":p.value,"onUpdate:hoveredIds":g[1]||(g[1]=v=>p.value=v),line_number:h,compact:d.compact},{default:B(()=>[e.scores!=null&&e.scores[u.summary.uuid]!=null?(y(),_("label",bs,P(e.scores[u.summary.uuid]),1)):F("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],4))}}),Ce=O(ks,[["__scopeId","data-v-ccaa3b07"]]),Ss=["title"],$s=["src","alt"],Ds={for:"icon",class:"iconLabel non-selectable"},Cs=q({__name:"BannerIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(r,{expose:t,emit:e}){const a=r,s=T(()=>a.title+(a.shortcut===null?"":` (${a.shortcut})`)),i=e,o=w(null);t({getBoundingClientRect:()=>{var u;return(u=o.value)==null?void 0:u.getBoundingClientRect()}});function l(){i("onClick"),i("click")}function d(u){if(u===null)return null;const h=u.toLowerCase().split("+");return v=>{h.includes("ctrl")&&!v.ctrlKey||h.includes("alt")&&!v.altKey||h.includes("shift")&&!v.shiftKey||h.includes("meta")&&!v.metaKey||h.includes(v.key.toLowerCase())&&(console.log("shortcut triggered: "+u+" | "+a.labelText),l(),v.preventDefault())}}const g=d(a.shortcut);return qe(()=>{g!==null&&window.addEventListener("keydown",g)}),Ye(()=>{g!==null&&window.removeEventListener("keydown",g)}),(u,h)=>(y(),_("span",{class:"hoverMaxout105 button non-selecable",onClick:l,onKeydown:Ee(l,["enter"]),tabindex:0,title:`${s.value}`,ref_key:"button",ref:o},[n("img",{id:"icon",class:"icon",src:u.iconSrc,alt:u.labelText.toUpperCase()+"_ICON"},null,8,$s),n("label",Ds,P(u.labelText),1)],40,Ss))}}),oe=O(Cs,[["__scopeId","data-v-fc643a9e"]]),xs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",Ts="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",Ps="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='m887%20489-23-50-50-23%2050-23%2023-50%2023%2050%2050%2023-50%2023-23%2050ZM760%20314l-35-74-74-35%2074-35%2035-74%2035%2074%2074%2035-74%2035-35%2074ZM360%20976q-34%200-57.5-23.5T279%20895h162q0%2034-23.5%2057.5T360%20976ZM198%20833v-60h324v60H198Zm5-121q-66-43-104.5-107.5T60%20459q0-122%2089-211t211-89q122%200%20211%2089t89%20211q0%2081-38%20145.5T517%20712H203Zm22-60h271q48-32%2076-83t28-110q0-99-70.5-169.5T360%20219q-99%200-169.5%2070.5T120%20459q0%2059%2028%20110t77%2083Zm135%200Z'/%3e%3c/svg%3e",Is="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",Ls={class:"button"},Us=q({__name:"Banner",props:{returnHome:{type:Boolean,default:!0}},setup(r){const t=r,e=ke();function a(){Ft()}G.setDefaultDarkMode();const s=w(G.isDarkMode()),i=T(function(){return s.value?"LightMode":"DarkMode"});function o(){G.toggleDarkMode(),s.value=!s.value}const p=w(null);let l=0;return window.addEventListener("scroll",function(){const d=window.scrollY||document.documentElement.scrollTop;d<=l||l<10?p.value&&p.value.classList.contains("hidden")&&p.value.classList.remove("hidden"):p.value&&!p.value.classList.contains("hidden")&&p.value.classList.add("hidden"),l=d}),(d,g)=>(y(),_("div",{class:"main-banner shadow",ref_key:"mainDiv",ref:p},[n("div",Ls,[t.returnHome?(y(),V(oe,{key:0,iconSrc:x(Is),labelText:"Home",shortcut:"ctrl+h",onOnClick:g[0]||(g[0]=()=>{x(e).push("/")}),title:"home"},null,8,["iconSrc"])):(y(),V(oe,{key:1,iconSrc:x(xs),labelText:"Logout",shortcut:"ctrl+q",onOnClick:a,title:"logout"},null,8,["iconSrc"])),C(x(pt),{menuItems:[{name:"Home",action:()=>{x(e).push("/")}},{name:"Dashboard",action:()=>{x(e).push(`/dashboard/${x(K)().user.username}`)}},{name:"Arxiv daily",action:()=>{x(e).push("/feed")}},{name:"About",action:()=>{x(e).push("/about")}}]},{default:B(()=>[C(oe,{iconSrc:x(Ts),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]),C(oe,{iconSrc:x(Ps),labelText:i.value,shortcut:"ctrl+t",onOnClick:g[1]||(g[1]=()=>o()),title:"change theme"},null,8,["iconSrc","labelText"])]),me(d.$slots,"default",{},void 0,!0)],512))}}),xe=O(Us,[["__scopeId","data-v-18159abb"]]),As="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",Rs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M559-97q-18%2018-43.5%2018T472-97L97-472q-10-10-13.5-21T80-516v-304q0-26%2017-43t43-17h304q12%200%2024%203.5t22%2013.5l373%20373q19%2019%2019%2044.5T863-401L559-97Zm-41-41%20304-304-378-378H140v304l378%20378ZM245-664q21%200%2036.5-15.5T297-716q0-21-15.5-36.5T245-768q-21%200-36.5%2015.5T193-716q0%2021%2015.5%2036.5T245-664ZM140-820Z'/%3e%3c/svg%3e",ht="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",Bs={class:"loading-popout"},qs={class:"bar",id:"bar"},Es=q({__name:"LoadingProgressPopout",props:{text:{default:"Progress: "},perc:{}},setup(r){const t=r,e=T(()=>({width:t.perc*120+"px"}));return(a,s)=>(y(),_("div",Bs,[n("label",null,P(t.text),1),n("div",qs,[n("div",{class:"bar",id:"barCurrent",style:Y(e.value)},null,4)])]))}}),Os=O(Es,[["__scopeId","data-v-30a64108"]]),Ms=q({__name:"Plot3d",props:{data:{}},setup(r,{expose:t}){const e=w(null),a=r,s=T(()=>a.data.map(f=>({x:f.x,y:f.y,z:f.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:f.text,marker:{size:3.5,opacity:f.opacity,color:f.color}}))),i={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},o={...i,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},p=w(G.isDarkMode()?"dark":"light");G.registerThemeChangeCallback(()=>{p.value=G.isDarkMode()?"dark":"light",u()});const l=T(()=>p.value==="dark"?o:i),d={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let g=null;function u(){if(!e.value)return;Re.react(e.value,s.value,l.value,d),e.value.layout.scene&&g&&Re.relayout(e.value,"scene.camera",g)}return t({update:u}),be(()=>{Re.newPlot(e.value,s.value,l.value,d).then(()=>{e.value.on("plotly_relayout",h=>{if(console.log("plotly_relayout",h),!h["scene.camera"])return;const v=h["scene.camera"];g=Se(v)})}),e.value.on("plotly_click",function(h){h.points||console.log("Not clicking on any data.");const v=h.points[0].x,f=h.points[0].y,c=h.points[0].z,m=h.points[0].pointNumber;console.log(`You clicked on ${v}, ${f}, ${c} (point ${m})}`)}),ne(s,()=>{u()})}),(h,v)=>(y(),_("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),zs=O(Ms,[["__scopeId","data-v-e21cc654"]]),Fs=r=>(ee("data-v-58a0ba98"),r=r(),te(),r),Ns={id:"main-filtervis"},Hs=["open"],Ks=Fs(()=>n("summary",null,"Visualization",-1)),Ws={id:"plot3dDiv"},Zs={key:0,id:"loadingDiv",class:"full"},Vs={key:1,class:"status"},js=q({__name:"FilterVis",setup(r){const t=K(),e=w(null),a=E(),s=Z(),i=w(null),o=T(()=>{if(i.value===null)return{};const h=Object.keys(t.database.data),v={};for(const f of h)i.value[f]&&(v[f]=i.value[f]);return v});function p(h,v="rgb(100, 100, 200)"){const f=o.value;if(!f)h=[];else for(let D=h.length-1;D>=0;D--)f[h[D]]===void 0&&h.splice(D,1);const c=h.length,m=new Float32Array(c),k=new Float32Array(c),b=new Float32Array(c),S=new Array(c);for(const[D,L]of h.entries()){let U=f[L];if(U==null)throw new Error("uid not found in feats: "+L);m[D]=U[0],k[D]=U[1],b[D]=U[2];const j=t.database.get(L);S[D]=`${j.authorYear()}<br>${j.summary.title}`}let $;if(typeof v=="string")$=v;else if(v instanceof Array)if(typeof v[0]=="string")$=v;else{const D=v,L=Math.max(...D),U=Math.min(...D),j={0:G.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};$=D.map(N=>{const I=(N-U)/(L-U),M=Array(3);for(let de=0;de<3;de++)M[de]=Math.round(j[0][de]*(1-I)+j[1][de]*I);return`rgb(${M[0]}, ${M[1]}, ${M[2]})`})}else throw new Error("Invalid color type");return{x:m,y:k,z:b,opacity:.75,color:$,text:S}}const l=T(()=>{const h=a.shownDataScores;let v;h?v=p(Se(a.shownDataUIDs),h):v=p(Se(a.shownDataUIDs));const c=Object.keys(t.database.data).filter(b=>a.shownDataUIDs.indexOf(b)==-1),m=p(c,G.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),k=p(Se(a.unfoldedDataUIDs),"rgb(255, 0, 0)");return[v,m,k]}),d=T(()=>Object.keys(o.value).length>0);async function g(){i.value=null;const h=(await new R().status()).n_data;let v;h<50?v=-1:h<100?v=5:h<300?v=8:h<500?v=12:v=15,console.log("dataset size: ",h,"perp: ",v),new R().reqDatabaseFeatureTSNE("doc_feature",3,v).then(f=>{i.value=f})}function u(h){h.target instanceof HTMLDetailsElement&&(h.target.open?(s.setShow3DScatterPlot(!0),g()):s.setShow3DScatterPlot(!1))}return(h,v)=>(y(),_("div",Ns,[n("details",{onToggle:u,open:x(s).show3DScatterPlot},[Ks,n("div",Ws,[C(zs,{data:l.value,ref_key:"plot3DRef",ref:e},null,8,["data"]),d.value?F("",!0):(y(),_("div",Zs,[i.value===null?(y(),V(Ue,{key:0})):(y(),_("p",Vs,"Data not ready"))]))])],40,Hs)]))}}),Gs=O(js,[["__scopeId","data-v-58a0ba98"]]),Js={id:"bannerAddons"},Qs={class:"searchbar"},Ys=["value"],Xs={id:"main-home",class:"gradIn"},eo={class:"horizontal fullHeight"},to={key:0,id:"left-panel"},ao={id:"right-panel",class:"panel1"},no={class:"fullWidth"},so={class:"scrollable",id:"fileSelector"},oo={key:1,id:"blankPlaceholder"},ro={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},io={style:{"font-size":"medium"}},lo=["href"],uo={name:"Home",inheritAttrs:!1,customOptions:{}},co=q({...uo,setup(r){const t=E(),e=K(),a=Z();window.innerWidth<768&&a.setShowTagPanel(!1);const i=ke().currentRoute.value.query.tags;i!=null&&(t.tagStatus.checked=new z(i.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const o=["general","title","author","note","publication","feature","uuid"],p=w(""),l=w(null);function d(){const v={searchBy:l.value.value,content:p.value};t.searchState=v,console.log(v),t.updateShownData()}const g=nt(d,200),u=w(!1);function h(){t.reloadDatabase(),Le().reset()}return(v,f)=>(y(),_(H,null,[C(dt,{datapoint:null,show:u.value,"onUpdate:show":f[0]||(f[0]=c=>u.value=c)},null,8,["show"]),C(xe,{"return-home":!1},{default:B(()=>[n("div",Js,[C(oe,{iconSrc:x(As),labelText:"New",title:"Add new data to database",onClick:f[1]||(f[1]=c=>u.value=!0),shortcut:"ctrl+n"},null,8,["iconSrc"]),C(oe,{"icon-src":x(Rs),"label-text":"Tags",title:"Tag utilities",onClick:f[2]||(f[2]=()=>x(a).setShowTagPanel(!x(a).showTagPanel))},null,8,["icon-src"]),C(oe,{iconSrc:x(ht),labelText:"Reload",title:"Reload database",onClick:h},null,8,["iconSrc"]),A(" | "),n("div",Qs,[n("select",{ref_key:"searchSelector",ref:l,name:"search_type",id:"searchType",onChange:d},[(y(),_(H,null,X(o,c=>n("option",{value:c},P(c),9,Ys)),64))],544),W(n("input",{id:"searchbar",type:"text","onUpdate:modelValue":f[3]||(f[3]=c=>p.value=c),onInput:f[4]||(f[4]=(...c)=>x(g)&&x(g)(...c)),placeholder:"search"},null,544),[[Q,p.value]])])])]),_:1}),n("div",Xs,[n("div",eo,[C($e,{name:"left-in"},{default:B(()=>[x(a).showTagPanel?(y(),_("div",to,[C(ya,{onOnCheck:f[5]||(f[5]=()=>x(t).updateShownData())})])):F("",!0)]),_:1}),n("div",ao,[n("div",no,[C(Gs)]),n("div",so,[x(t).shownDataUIDs.length>0?(y(),V(Ce,{key:0,datapoints:x(e).database.getMany(x(t).shownDataUIDs),unfoldedIds:x(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":f[6]||(f[6]=c=>x(t).unfoldedDataUIDs=c)},null,8,["datapoints","unfoldedIds"])):(y(),_("div",oo,[x(e).database.initialized?(y(),_("p",ro,[A(" Nothing to show "),n("p",io,[A(" Add your first file following the "),n("a",{href:x(at)},"documentation",8,lo),A(". ")])])):(y(),V(Ue,{key:1}))])),C($e,{name:"fade"},{default:B(()=>[x(e).database.initialized?F("",!0):(y(),V(Os,{key:0,perc:x(t).databaseLoadingProgress,text:x(t).databaseLoadingStatus.nTotal>=0?`${x(t).databaseLoadingStatus.nCurrent} / ${x(t).databaseLoadingStatus.nTotal}`:"_"},null,8,["perc","text"]))]),_:1})])])])])],64))}}),po=O(co,[["__scopeId","data-v-ee3a8f9c"]]),mt=r=>(ee("data-v-7cd91163"),r=r(),te(),r),ho={id:"authorPapers"},mo={id:"tag-selector"},fo={id:"feed-main",class:"slideInFast"},vo={class:"articleBlock"},go={class:"titleBlock"},yo={class:"titleId"},wo={class:"authors"},_o=mt(()=>n("label",null,"[Authors] ",-1)),bo={class:"authorSpan"},ko=["onClick"],So=["onClick"],$o={key:1},Do={class:"actions"},Co=mt(()=>n("summary",null,"Abstract",-1)),xo={id:"relatedArticles"},To=q({__name:"ArticleBlock",props:{article:{}},setup(r){const t=r,e=K(),a=w(!1),s=w(null),i=T({set:c=>{c&&(s.value={all:new z(E().tagStatus.all),checked:new z,unfolded:new z}),a.value=c},get:()=>a.value});function o(){var k;const c=ut(t.article),m=(k=s.value)==null?void 0:k.checked;new R().editData(null,c,Array.from(m||[]),t.article.link).then(()=>{E().showPopup(`collected ${t.article.id}`,"success")},()=>E().showPopup(`failed to collect ${t.article.id}, check log for details`,"warning"))}function p(c){const m=e.authorPublicationMap;return c=_e(c),c in m?m[c].length:null}const l=w(!1),d=w([]);function g(c){c=_e(c),console.log("check publication of author: ",c),d.value=e.authorPublicationMap[c],l.value=!0}const u=w([]),h=w([]),v=T(()=>{const c={};for(let m=0;m<u.value.length;m++)c[u.value[m].summary.uuid]=h.value[m].toPrecision(4);return c});function f(){u.value.length>0||new R().search("searchFeature",{pattern:t.article.abstract,n_return:8}).then(c=>{var S;const m=new Array,k=new Array;for(const $ of Object.keys(c))m.push((S=c[$])==null?void 0:S.score),k.push($);const b=Me.sortByScore(k,m);u.value=b[0].map($=>e.database.get($)),h.value=b[1]})}return(c,m)=>(y(),_(H,null,[C(De,{show:l.value,"onUpdate:show":m[0]||(m[0]=k=>l.value=k),title:"Publications in the database",onOnClose:m[1]||(m[1]=k=>d.value=[])},{default:B(()=>[n("div",ho,[C(Ce,{datapoints:d.value},null,8,["datapoints"])])]),_:1},8,["show"]),C(he,{show:i.value,"onUpdate:show":m[3]||(m[3]=k=>i.value=k),title:`Adding ${t.article.id}`,onOnAccept:m[4]||(m[4]=()=>{o(),i.value=!1}),onOnCancel:m[5]||(m[5]=()=>i.value=!1)},{default:B(()=>[n("div",mo,[C(lt,{tagStatus:s.value,"onUpdate:tagStatus":m[2]||(m[2]=k=>s.value=k)},null,8,["tagStatus"])])]),_:1},8,["show","title"]),n("div",fo,[n("div",vo,[n("div",go,[n("h2",null,P(t.article.title),1),n("label",yo,P(t.article.id),1)]),n("div",wo,[_o,(y(!0),_(H,null,X(t.article.authors,(k,b)=>(y(),_("span",bo,[n("a",{onClick:()=>x(Ie)(`https://arxiv.org/search/?query=${k}&searchtype=author`)},P(k),9,ko),p(k)?(y(),_("a",{key:0,class:"pubCount",onClick:()=>g(k)},P(` (${p(k)})`),9,So)):F("",!0),b<t.article.authors.length-1?(y(),_("span",$o,", ")):F("",!0)]))),256))]),n("div",Do,[n("a",{onClick:m[6]||(m[6]=()=>x(Ie)(`https://arxiv.org/abs/${c.article.id}`))},"Arxiv"),A(" | "),n("a",{onClick:m[7]||(m[7]=()=>x(Ie)(`https://arxiv.org/pdf/${c.article.id}.pdf`))},"PDF"),A(" | "),n("a",{onClick:m[8]||(m[8]=()=>i.value=!0)},"Collect")]),n("p",null,"Published: "+P(t.article.publishedTime),1),n("details",null,[Co,n("p",null,P(t.article.abstract),1)]),n("details",null,[n("summary",{onClick:f},"Related articles"),n("div",xo,[C(Ce,{datapoints:u.value,scores:v.value},null,8,["datapoints","scores"])])])])])],64))}}),Po=O(To,[["__scopeId","data-v-7cd91163"]]),Te=r=>(ee("data-v-5c5b2886"),r=r(),te(),r),Io={id:"banner"},Lo={id:"main"},Uo=["src"],Ao={id:"settings"},Ro=Te(()=>n("option",{value:"cat:cs.CV OR cat:cs.AI OR stat.ML"},"ALL",-1)),Bo=Te(()=>n("option",{value:"cat:cs.CV"},"cs.CV",-1)),qo=Te(()=>n("option",{value:"cat:cs.AI"},"cs.AI",-1)),Eo=Te(()=>n("option",{value:"cat:stat.ML"},"stat.ML",-1)),Oo=[Ro,Bo,qo,Eo],Mo={key:0,id:"loadingPlaceholder"},zo=Te(()=>n("b",null,"Fetching...",-1)),Fo=q({__name:"Feed",setup(r){const t=new R,e=w("cat:cs.CV OR cat:cs.AI OR stat.ML"),a=w(""),s=w(null),i=w([]),o=T(function(){return[...i.value].sort((c,m)=>{if(s.value===null||!c.features||!m.features)return 0;{const k=c.features,b=m.features,S=s.value,$=k.reduce((L,U,j)=>L+(U-S[j])**2,0),D=b.reduce((L,U,j)=>L+(U-S[j])**2,0);return $-D}})});function p(){if(a.value.trim()===""){s.value=null;return}new R().featurize(a.value).then(f=>{s.value=new Float32Array(f)},()=>{console.log("failed to featurize")})}const l=nt(p,100),d=ke();let g=parseInt(d.currentRoute.value.query.maxResults)||100;g>200&&(window.alert("maxResults cannot be larger than 200"),g=200);let u=d.currentRoute.value.query.search||"";u!==""&&(a.value=u);const h=w(null);async function v(){i.value=[];const f=await Fa(g,e.value);console.log(`Got ${f.length} entries.`);for(const c of f){const m=c;m.features=w(null),i.value.push(m),t.featurize(c.abstract,!0).then(k=>{m.features.value=new Float32Array(k)},()=>{console.log("failed to featurize: ",c.id)})}p()}return be(()=>{v().then(()=>h.value.classList.remove("spin"),()=>{h.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(f,c)=>(y(),_(H,null,[n("div",Io,[C(xe,{ref:"banner"},null,512)]),n("div",Lo,[n("h1",null,[A(" Arxiv daily "),n("img",{ref_key:"refreshButton",ref:h,src:x(ht),alt:"",class:"icon spin",title:"refresh the page",onClick:c[0]||(c[0]=m=>{const k=m.target;k.classList.contains("spin")||(k.classList.add("spin"),v().then(()=>k.classList.remove("spin")))})},null,8,Uo)]),n("div",Ao,[W(n("select",{name:"category",id:"category-select","onUpdate:modelValue":c[1]||(c[1]=m=>e.value=m),onChange:v},Oo,544),[[$t,e.value]]),W(n("input",{type:"text",placeholder:"Search",onInput:c[2]||(c[2]=(...m)=>x(l)&&x(l)(...m)),"onUpdate:modelValue":c[3]||(c[3]=m=>a.value=m),autocomplete:"off"},null,544),[[Q,a.value]])]),o.value.length===0?(y(),_("div",Mo,[zo,C(Ue)])):F("",!0),(y(!0),_(H,null,X(o.value,m=>(y(),V(Po,{article:m},null,8,["article"]))),256))])],64))}}),No=O(Fo,[["__scopeId","data-v-5c5b2886"]]),ft=r=>(ee("data-v-8f0a3868"),r=r(),te(),r),Ho={class:"main"},Ko={id:"login",class:"slideIn"},Wo={class:"loginLine"},Zo={class:"loginLine"},Vo=["type"],jo=ft(()=>n("summary",null,"Settings",-1)),Go={id:"settings"},Jo=ft(()=>n("label",{for:"backendHostInput"},"Backend: ",-1)),Qo={class:"options"},Yo={key:0,class:"error"},Xo=q({__name:"LoginInput",setup(r){const t=w(""),e=w(""),a=w(""),s=w(!0),i=w(!1),o=T(()=>i.value?"text":"password"),p=w("Login"),l=ke(),d=w(""),g=w("");l.isReady().then(()=>{Dt(()=>{d.value=Z().backendHost,g.value=Z().backendPort})});function u(){Z().setBackendHost(d.value),Z().setBackendPort(g.value),p.value="Connecting...";const h=Ht(t.value,e.value);new R().authUsr(h).then(f=>{ze(h,f,s.value),a.value="";const c=l.currentRoute.value.query.from;c?(console.log("Redirecting to",c),l.push(c)):l.push("/"),p.value="Login"},f=>{a.value=f,p.value="Login"})}return(h,v)=>(y(),_("div",Ho,[n("div",Ko,[n("form",null,[n("div",Wo,[W(n("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":v[0]||(v[0]=f=>t.value=f),placeholder:"Username",autocomplete:"off"},null,512),[[Q,t.value]])]),n("div",Zo,[W(n("input",{class:"key-input",type:o.value,id:"password-input","onUpdate:modelValue":v[1]||(v[1]=f=>e.value=f),placeholder:"Password"},null,8,Vo),[[Ct,e.value]])]),n("details",null,[jo,n("div",Go,[Jo,W(n("input",{type:"text",id:"backendHostInput","onUpdate:modelValue":v[2]||(v[2]=f=>d.value=f)},null,512),[[Q,d.value]]),A(" : "),W(n("input",{type:"text",id:"port","onUpdate:modelValue":v[3]||(v[3]=f=>g.value=f)},null,512),[[Q,g.value]]),n("div",Qo,[C(pe,{checked:s.value,onOnCheck:v[4]||(v[4]=()=>{s.value=!s.value})},{default:B(()=>[A("Stay login")]),_:1},8,["checked"]),C(pe,{checked:i.value,onOnCheck:v[5]||(v[5]=()=>{i.value=!i.value})},{default:B(()=>[A("Show key")]),_:1},8,["checked"])])])]),n("button",{type:"submit",onClick:xt(u,["prevent"])},P(p.value),1)]),a.value?(y(),_("p",Yo,P(a.value),1)):F("",!0)])]))}}),er=O(Xo,[["__scopeId","data-v-8f0a3868"]]),tr={id:"main"},ar={id:"container"},nr={for:"login",id:"info"},sr=["href"],or=q({__name:"Login",setup(r){G.setDefaultDarkMode();function t(){alert(`Not implemented yet. 
Please contact the maintainer for registration.`)}return(e,a)=>(y(),_("div",tr,[n("div",ar,[C(er),n("label",nr,[A(" Need assistant? - "),n("a",{onClick:t},"Register"),A(" | "),n("a",{href:`mailto:${x(qt).email}`},"Contact me",8,sr)])])]))}}),rr=O(or,[["__scopeId","data-v-a2e2514f"]]),ir={id:"noteEditor"},lr=q({__name:"NoteEditor",props:{datapoint:{},theme:{default:"light"}},setup(r,{expose:t}){const e=r,a=w(""),s=w(null);function i(){e.datapoint.fetchNote().then(d=>{console.log("Note fetched"),a.value=d,d.trim().length>0&&(l.value=!0)},d=>{console.error(d)})}i(),ne(()=>e.datapoint,()=>{i(),console.log("datapoint changed, fetching note")});function o(){e.datapoint.uploadNote(a.value).then(()=>{console.log("Note saved"),E().showPopup("Note saved","success")},d=>{console.error(d),E().showPopup("Failed to save","warning")})}const p=async d=>{e.datapoint.uploadImages(d).then(g=>{console.log("Images uploaded"),g.map(u=>s.value.insert(()=>({targetValue:`![image](${u})`,select:!1,deviationStart:0,deviationEnd:0}))),o()},g=>{console.error(g)})},l=w(!1);return t({preview:l,fetchNote:i}),(d,g)=>(y(),_("div",ir,[n("div",{class:"editor",onDblclick:g[1]||(g[1]=u=>l.value=!1)},[l.value?(y(),V(x(At),{key:1,"model-value":a.value,theme:d.theme},null,8,["model-value","theme"])):(y(),V(x(Ut),{key:0,ref_key:"mdEditor",ref:s,modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=u=>a.value=u),preview:!1,language:"en-US",theme:d.theme,onOnSave:o,onOnUploadImg:p,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme"]))],32)]))}}),ur=O(lr,[["__scopeId","data-v-69871aff"]]),dr={id:"body"},cr=["src"],pr=q({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(r,{expose:t}){const e=r,a=w(null),s=w(null),i=w(null),o=w(!1),p=w(null);t({noteEditor:p});function l(c){i.value&&i.value.contains(c.target)&&(o.value=!0)}function d(){o.value=!1}const g=T({get:()=>E().preferredReaderLeftPanelWidthPerc,set:c=>{E().preferredReaderLeftPanelWidthPerc=c}});function u(c){if(o.value&&a.value&&s.value&&i.value){const k=("touches"in c?c.touches[0].clientX:c.clientX)-a.value.getBoundingClientRect().left;a.value.style.width=`${k}px`,s.value.style.width=`calc(100% - ${k}px)`,g.value=k/(k+s.value.getBoundingClientRect().width),g.value=Math.max(.1,Math.min(.9,g.value))}}window.addEventListener("mousedown",l),window.addEventListener("touchstart",l),window.addEventListener("mouseup",d),window.addEventListener("touchend",d),window.addEventListener("mousemove",u),window.addEventListener("touchmove",u);function h(c){c==0?(a.value.style.width="100%",s.value.style.width="0%"):c==1?(a.value.style.width="0%",s.value.style.width="100%"):c==2&&(a.value.style.width=`${g.value*100}%`,s.value.style.width=`${(1-g.value)*100}%`),Z().setReaderLayoutType(c)}ne(()=>e.layoutType,(c,m)=>{console.log("layoutType changed:",m,"->",c),h(c)});const v=w(G.isDarkMode()?"dark":"light");G.registerThemeChangeCallback(()=>v.value=G.isDarkMode()?"dark":"light");const f=T(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":v.value}})}`);return be(()=>{h(e.layoutType)}),(c,m)=>(y(),_("div",dr,[n("div",{class:"pane",id:"left-pane",ref_key:"leftPane",ref:a},[n("iframe",{src:f.value,title:"doc",frameborder:"0",style:Y({"pointer-events":o.value?"none":"auto"})},null,12,cr)],512),c.layoutType==2?(y(),_("div",{key:0,id:"splitter",ref_key:"splitter",ref:i,onMousedown:l,onTouchstart:l},null,544)):F("",!0),n("div",{class:"pane",id:"right-pane",ref_key:"rightPane",ref:s},[C(ur,{datapoint:c.datapoint,theme:v.value,ref_key:"noteEditor",ref:p},null,8,["datapoint","theme"])],512)]))}}),hr=O(pr,[["__scopeId","data-v-9ff3e65e"]]),mr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",fr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",vr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480.118-330Q551-330%20600.5-379.618q49.5-49.617%2049.5-120.5Q650-571%20600.382-620.5q-49.617-49.5-120.5-49.5Q409-670%20359.5-620.382q-49.5%2049.617-49.5%20120.5Q310-429%20359.618-379.5q49.617%2049.5%20120.5%2049.5Zm-.353-58Q433-388%20400.5-420.735q-32.5-32.736-32.5-79.5Q368-547%20400.735-579.5q32.736-32.5%2079.5-32.5Q527-612%20559.5-579.265q32.5%2032.736%2032.5%2079.5Q592-453%20559.265-420.5q-32.736%2032.5-79.5%2032.5ZM480-200q-146%200-264-83T40-500q58-134%20176-217t264-83q146%200%20264%2083t176%20217q-58%20134-176%20217t-264%2083Zm0-300Zm-.169%20240Q601-260%20702.5-325.5%20804-391%20857-500q-53-109-154.331-174.5-101.332-65.5-222.5-65.5Q359-740%20257.5-674.5%20156-609%20102-500q54%20109%20155.331%20174.5%20101.332%2065.5%20222.5%2065.5Z'/%3e%3c/svg%3e",gr={id:"bannerOps"},yr={id:"recently-read"},wr={id:"main-reader",class:"gradIn"},_r={name:"Reader",inheritAttrs:!1,customOptions:{}},br=q({..._r,setup(r){const t=K(),e=E(),a=Xe(),s=ke(),i=T(()=>a.params.id),o=w(t.database.get(i.value));ne(()=>a.params.id,()=>{o.value=t.database.get(a.params.id),p()});function p(){e.addRecentlyReadDataUID(i.value)}p();const l=T(()=>{const k=[];for(const b of e.recentlyReadDataUIDs){if(b===a.params.id)continue;const S=t.database.get(b);k.push({name:S.authorYear(),action:()=>{s.push("/reader/"+b)}})}return k}),d=w(Z().readerLayoutType);window.innerWidth<800&&(d.value=0);function g(){if(window.innerWidth<800)d.value=(d.value+1)%2;else switch(d.value){case 0:d.value=2;break;case 1:d.value=2;break;case 2:d.value=0;break}}const u=w(null);function h(k){function b(){o.value.uploadDocument(k).then(S=>{o.value.update(S),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}o.value.summary.has_file?o.value.freeDocument().then(S=>{o.value.update(S),b()},()=>e.showPopup("Failed to free document","error")):b()}const v=w(null),f=T(()=>{try{return v.value.noteEditor.preview}catch{return!1}}),c=T(()=>f.value?"edit":"preview");function m(){v.value.noteEditor.preview=!v.value.noteEditor.preview}return be(()=>{if(Object.keys(t.database.data).length===0){E().showPopup("Database not loaded or empty database.","alert");const k=setInterval(()=>{E().showPopup("Trying to update datapoint...","warning",2e3),Object.keys(t.database.data).length!==0&&(clearInterval(k),o.value=t.database.get(i.value),E().showPopup("Datapoint updated.","success",3e3))},750)}}),(k,b)=>(y(),_(H,null,[C(x(Ne),{action:h,ref_key:"fileSelectionBtn",ref:u,style:{display:"none"}},null,512),C(xe,null,{default:B(()=>[n("div",gr,[C(oe,{iconSrc:x(mr),labelText:"layout",shortcut:"ctrl+r",onOnClick:g,title:"change layout"},null,8,["iconSrc"]),C(oe,{iconSrc:x(fr),labelText:"upload",shortcut:"ctrl+u",onOnClick:b[0]||(b[0]=()=>u.value.click()),title:"upload a new document"},null,8,["iconSrc"]),C(oe,{iconSrc:x(vr),labelText:c.value,shortcut:"ctrl+p",onOnClick:m,title:"preview or edit markdown note"},null,8,["iconSrc","labelText"]),C(x(pt),{"menu-items":l.value},{default:B(()=>[n("div",yr,P(`${o.value.authorAbbr()} (${o.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),n("div",wr,[C(hr,{datapoint:o.value,layoutType:d.value,ref_key:"readerBody",ref:v},null,8,["datapoint","layoutType"])])],64))}}),kr=O(br,[["__scopeId","data-v-6e064c89"]]),re=r=>(ee("data-v-470d7ba6"),r=r(),te(),r),Sr={class:"banner"},$r={id:"about-main",class:"slideIn"},Dr=re(()=>n("h1",null,"About",-1)),Cr={id:"about-div",class:"content"},xr=re(()=>n("br",null,null,-1)),Tr=re(()=>n("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires",-1)),Pr=re(()=>n("br",null,null,-1)),Ir=["href"],Lr=re(()=>n("b",null,"Server status: ",-1)),Ur=re(()=>n("b",null,"Backend",-1)),Ar=re(()=>n("b",null,"Version",-1)),Rr=re(()=>n("b",null,"Uptime",-1)),Br=re(()=>n("b",null,"Number of documents",-1)),qr=re(()=>n("b",null,"Number of connections",-1)),Er={id:"versionHistory",class:"content"},Or={class:"block"},Mr={key:0},zr={key:1},Fr=q({__name:"About",setup(r){const t=w([]),e=w(!1),a=()=>{new R().changelog().then(d=>{t.value=d},d=>{console.error(d)})},s=w(-1),i=T(()=>{if(s.value===-1)return"N/A";const d=Math.floor(s.value/3600),g=Math.floor((s.value-d*3600)/60),u=Math.floor(s.value-d*3600-g*60);return`${d}h ${g}m ${u}s`}),o=w({backend:J(),version:"",uptime:i,_uptime:-1,numDocs:-1,numConnections:-1}),p=()=>{new R().status().then(d=>{s.value=d.uptime,o.value.version=d.version,o.value.numDocs=d.n_data,o.value.numConnections=d.n_connections},d=>{console.error(d)})},l=T(()=>t.value.slice().reverse());return a(),p(),window.setInterval(()=>s.value++,1e3),ae("login",()=>o.value.numConnections++),ae("logout",()=>o.value.numConnections--),(d,g)=>(y(),_(H,null,[n("div",Sr,[C(xe)]),n("div",$r,[Dr,n("div",Cr,[n("p",null,[A(" Lires is a self-hosted web application for research literature management. "),xr,A(" It is open source and available at "),Tr,A(". "),Pr,A(" The user manual is available at "),n("a",{href:x(at),target:"_blank"},"here",8,Ir),A(". ")]),n("p",null,[Lr,n("ul",null,[n("li",null,[Ur,A(": "+P(o.value.backend),1)]),n("li",null,[Ar,A(": "+P(o.value.version),1)]),n("li",null,[Rr,A(": "+P(o.value.uptime),1)]),n("li",null,[Br,A(": "+P(o.value.numDocs),1)]),n("li",null,[qr,A(": "+P(o.value.numConnections),1)])])]),n("a",{onClick:g[0]||(g[0]=u=>e.value=!0),style:{cursor:"pointer"}},"View change log")]),C(De,{show:e.value,"onUpdate:show":g[1]||(g[1]=u=>e.value=u),title:"Change log"},{default:B(()=>[n("div",Er,[(y(!0),_(H,null,X(l.value.length,u=>(y(),_("div",Or,[n("h2",null,P(l.value[u-1][0].toString()),1),n("ul",null,[(y(!0),_(H,null,X(l.value[u-1][1],h=>(y(),_("li",null,[typeof h=="string"?(y(),_("div",Mr,P(h),1)):typeof h=="object"?(y(),_("div",zr,[A(P(Object.keys(h)[0])+" ",1),n("ul",null,[(y(!0),_(H,null,X(h[Object.keys(h)[0]],v=>(y(),_("li",null,P(v),1))),256))])])):F("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),Nr=O(Fr,[["__scopeId","data-v-470d7ba6"]]),Hr={},Kr={id:"widget-container-main"};function Wr(r,t){return y(),_("div",Kr,[me(r.$slots,"default",{},void 0,!0)])}const Je=O(Hr,[["render",Wr],["__scopeId","data-v-257ac3c4"]]),Zr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",vt=r=>(ee("data-v-98574c42"),r=r(),te(),r),Vr={id:"usercard-main"},jr={id:"user-settings"},Gr=vt(()=>n("hr",null,null,-1)),Jr=vt(()=>n("summary",null,"Change password",-1)),Qr={id:"password-container"},Yr={id:"info"},Xr={id:"user-desc"},ei={id:"name-edit"},ti={id:"name"},ai=["src"],ni={key:0,class:"admin_hint"},si={id:"backendurl"},oi=q({__name:"UserCard",props:{userInfo:{}},emits:["update:userInfo"],setup(r,{emit:t}){const e=r,a=t,s=T(()=>K().user.id===e.userInfo.id),i=w(null),o=T(()=>(console.log("avatarURL updated"),`${J()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`));function p(f){if(!f.type.startsWith("image/")){E().showPopup("Please select an image file","error");return}E().showPopup("Uploading avatar..."),new R().uploadUserAvatar(f).then(c=>{a("update:userInfo",c)},c=>{E().showPopup(c,"error")})}const l=w(!1),d=w(""),g=w(""),u=w(""),h=w("");function v(){if(d.value===""||d.value===e.userInfo.name||d.value!==e.userInfo.name&&new R().updateUserNickname(d.value).then(f=>{a("update:userInfo",f),l.value=!1},f=>{E().showPopup(f,"error")}),u.value!==""||h.value!==""){if(u.value===""){E().showPopup("Please enter the new password","error");return}if(u.value!==h.value){E().showPopup("The new passwords do not match","error");return}if(Z().encKey!==ce(e.userInfo.username+ce(g.value))){E().showPopup("The old password is incorrect","error");return}new R().updateUserPassword(u.value).then(f=>{const c=ce(e.userInfo.username+u.value);Z().setEncKey(c,!0),g.value="",u.value="",h.value="",l.value=!1},f=>{E().showPopup(f,"error")})}}return(f,c)=>(y(),_("div",Vr,[C(he,{show:l.value,"onUpdate:show":c[4]||(c[4]=m=>l.value=m),title:"User settings",onOnCancel:c[5]||(c[5]=m=>l.value=!1),onOnAccept:v},{default:B(()=>[n("div",jr,[n("b",null,P(e.userInfo.username),1),W(n("input",{type:"text","onUpdate:modelValue":c[0]||(c[0]=m=>d.value=m),placeholder:"Nickname",class:"input"},null,512),[[Q,d.value]]),Gr,n("details",null,[Jr,n("div",Qr,[W(n("input",{type:"password","onUpdate:modelValue":c[1]||(c[1]=m=>g.value=m),placeholder:"Old password",class:"input"},null,512),[[Q,g.value]]),W(n("input",{type:"password","onUpdate:modelValue":c[2]||(c[2]=m=>u.value=m),placeholder:"New password",class:"input"},null,512),[[Q,u.value]]),W(n("input",{type:"password","onUpdate:modelValue":c[3]||(c[3]=m=>h.value=m),placeholder:"Confirm new password",class:"input"},null,512),[[Q,h.value]])])])])]),_:1},8,["show"]),n("div",Yr,[n("div",{id:"avatar",style:Y(s.value?{cursor:"pointer",borderRadius:"50%"}:{})},[C(x(_n),{href:o.value,size:"168px",onClick:c[6]||(c[6]=m=>{var k;return s.value?(k=i.value)==null?void 0:k.click():()=>{}})},null,8,["href"]),C(x(Ne),{text:"Change avatar",action:p,ref_key:"avatarUploadBtn",ref:i,style:{display:"none"}},null,512)],4),n("div",Xr,[n("div",ei,[n("h1",ti,P(e.userInfo.name),1),s.value?(y(),_("img",{key:0,src:x(Zr),alt:"",class:"icon",id:"edit-settings-icon",onClick:c[7]||(c[7]=m=>l.value=!0)},null,8,ai)):F("",!0)]),n("p",null,[A(P(e.userInfo.username)+" ",1),e.userInfo.is_admin?(y(),_("label",ni,"admin")):F("",!0)]),n("p",si,P(x(J)()),1)])])]))}}),ri=O(oi,[["__scopeId","data-v-98574c42"]]),ii="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",ie=r=>(ee("data-v-2a0c8094"),r=r(),te(),r),li={id:"users-widget-main"},ui={id:"user-editor-main"},di={class:"horizontal"},ci=["src"],pi={id:"user-editor"},hi={class:"horizontal"},mi={class:"horizonal"},fi={class:"full-width left-align"},vi=ie(()=>n("b",null,"Mandatory Tags:",-1)),gi={id:"delete-user-dialog-main"},yi={id:"create-user-table"},wi=ie(()=>n("td",null,"Username:",-1)),_i=ie(()=>n("td",null,"Name:",-1)),bi=ie(()=>n("td",null,"Password:",-1)),ki=ie(()=>n("td",null,"Mandatory Tags:",-1)),Si={colspan:"2"},$i={id:"user-widget-header"},Di=ie(()=>n("div",null,[n("b",null," Users ")],-1)),Ci={key:0},xi=ie(()=>n("th",null," Avatar ",-1)),Ti=ie(()=>n("th",null," Username ",-1)),Pi=ie(()=>n("th",null," Name ",-1)),Ii=ie(()=>n("th",null," Accessibility ",-1)),Li={class:"user-line"},Ui={key:0},Ai=["onClick"],Ri=["src"],Bi={class:"center full-width full-height"},qi=["src"],Ei={class:"username"},Oi={key:1,class:"admin_hint"},Mi={key:0,colspan:"5"},zi=q({__name:"UsersWidget",setup(r){const t=w([]),e=T(()=>K().user.is_admin),a=w(!1),s=w({});function i(S){if(!e.value)return;const $=JSON.parse(JSON.stringify(S));s.value=$,a.value=!0}function o(S){const $=S.split(";").map(D=>D.trim());$.length===1&&$[0]===""?s.value.mandatory_tags=[]:s.value.mandatory_tags=$}function p(){console.log(s.value),new R().setUserAccess(s.value.username,s.value.is_admin,s.value.mandatory_tags).then(S=>{a.value=!1},S=>{console.log(S),E().showPopup(S,"error")})}const l=w(!1),d=w("");function g(){if(d.value!==s.value.username){E().showPopup("Wrong input","error");return}new R().deleteUser(s.value.username).then(S=>{E().showPopup(`User ${s.value.username} deleted`,"info"),l.value=!1,a.value=!1},S=>{console.log(S),E().showPopup(S,"error")})}const u=w(!1),h=w(""),v=w(Pe[Math.floor(Math.random()*Pe.length)]),f=w(""),c=w(!1),m=w("");function k(){u.value=!1,h.value="",v.value=Pe[Math.floor(Math.random()*Pe.length)],f.value="",c.value=!1,m.value=""}function b(){if(h.value===""){E().showPopup("Please enter the username","error");return}const S=m.value.split(";").map($=>$.trim());S.length===1&&S[0]===""&&S.splice(0,1),new R().createUser(h.value,v.value,f.value,c.value,S).then($=>{E().showPopup(`User ${h.value} created`,"success"),k()},$=>{console.log($),E().showPopup($,"error")})}return be(()=>{new R().reqUserList().then(S=>{t.value=S},S=>{console.log(S)})}),ae("add_user",S=>{const $=S.user_info;t.value.push($)}),ae("update_user",S=>{const $=S.user_info;t.value.map((D,L)=>{D.id===$.id&&(t.value[L]=$)})}),ae("delete_user",S=>{const $=S.username;t.value=t.value.filter(D=>D.username!==$)}),(S,$)=>(y(),_("div",li,[C(he,{show:a.value,"onUpdate:show":$[3]||($[3]=D=>a.value=D),title:"editor",onOnAccept:p,onOnCancel:$[4]||($[4]=()=>a.value=!1)},{default:B(()=>[n("div",ui,[n("div",di,[n("img",{src:`${x(J)()}/user-avatar/${s.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,ci),n("div",pi,[n("div",hi,[n("h2",null,P(s.value.name),1),A(" ("+P(s.value.username)+") ",1)]),n("div",mi,[C(pe,{checked:s.value.is_admin,onOnCheck:$[0]||($[0]=()=>{s.value.is_admin=!s.value.is_admin})},{default:B(()=>[A(" Administrator")]),_:1},8,["checked"])]),n("div",fi,[vi,n("div",{id:"mandatory-tag-edit",class:fe(s.value.is_admin?"mute":"")},[C(x(ct),{style:{width:"100%"},"content-editable":!s.value.is_admin,onFinish:$[1]||($[1]=D=>o(D))},{default:B(()=>[A(P(s.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])],2)])])]),n("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:$[2]||($[2]=()=>{l.value=!0})})])]),_:1},8,["show"]),C(he,{show:l.value,"onUpdate:show":$[6]||($[6]=D=>l.value=D),title:"Delete user",onOnCancel:$[7]||($[7]=()=>l.value=!1),onOnAccept:g},{default:B(()=>[n("div",gi,[n("p",null,[A(" Are you sure to delete user "),n("b",null,P(s.value.name)+" ("+P(s.value.username)+")",1),A("? ")]),A(" Type "),n("b",null,P(s.value.username),1),A(" to confirm: "),W(n("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":$[5]||($[5]=D=>d.value=D),autocomplete:"off"},null,512),[[Q,d.value]])])]),_:1},8,["show"]),C(he,{show:u.value,"onUpdate:show":$[13]||($[13]=D=>u.value=D),onOnCancel:k,onOnAccept:b,onOnClose:k},{default:B(()=>[n("table",yi,[n("tr",null,[wi,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":$[8]||($[8]=D=>h.value=D),autocomplete:"off",class:"create-user-input"},null,512),[[Q,h.value]])])]),n("tr",null,[_i,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":$[9]||($[9]=D=>v.value=D),autocomplete:"off",class:"create-user-input"},null,512),[[Q,v.value]])])]),n("tr",null,[bi,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":$[10]||($[10]=D=>f.value=D),autocomplete:"off",class:"create-user-input"},null,512),[[Q,f.value]])])]),n("tr",null,[ki,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":$[11]||($[11]=D=>m.value=D),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[Q,m.value]])])]),n("tr",null,[n("td",Si,[C(pe,{checked:c.value,onOnCheck:$[12]||($[12]=()=>{c.value=!c.value})},{default:B(()=>[A(" Administrator")]),_:1},8,["checked"])])])])]),_:1},8,["show"]),n("div",$i,[Di,e.value?(y(),_("div",{key:0,id:"add-user-div",onClick:$[14]||($[14]=()=>u.value=!0)},"+")):F("",!0)]),n("table",null,[n("tr",null,[e.value?(y(),_("th",Ci)):F("",!0),xi,Ti,Pi,Ii]),(y(!0),_(H,null,X(t.value,D=>(y(),_("tr",Li,[e.value?(y(),_("td",Ui,[n("div",{class:"edit-button",onClick:()=>i(D)},[n("img",{src:x(ii),alt:"",class:"icon"},null,8,Ri)],8,Ai)])):F("",!0),n("td",null,[n("div",Bi,[n("img",{src:`${x(J)()}/user-avatar/${D.username}?size=60`,alt:"",class:"avatar"},null,8,qi)])]),n("td",Ei,P(D.username),1),n("td",null,P(D.name),1),n("td",null,[D.is_admin?(y(),_("label",Oi,"ADMIN")):(y(),V(rt,{key:0,tags:D.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),n("tr",null,[t.value.length===0?(y(),_("td",Mi," No users ")):F("",!0)])])]))}}),Fi=O(zi,[["__scopeId","data-v-2a0c8094"]]),Ni={id:"main-dashboard",class:"slideIn"},Hi=q({__name:"Dashboard",setup(r){const t=Xe(),e=new R,a=T(()=>K().user.id===s.value.id),s=w({id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1});function i(){e.reqUserInfo(t.params.username).then(o=>{s.value=o},o=>{E().showPopup(o,"error")})}return qe(i),window.onhashchange=i,ae("update_user",o=>{o.username===s.value.username&&i()}),(o,p)=>(y(),_(H,null,[C(xe),n("div",Ni,[C(Je,null,{default:B(()=>[C(ri,{"user-info":s.value},null,8,["user-info"])]),_:1}),C(Je,null,{default:B(()=>[a.value?(y(),V(Fi,{key:0})):F("",!0)]),_:1})])],64))}}),Ki=O(Hi,[["__scopeId","data-v-0b108cda"]]),Wi=[{path:"/",component:po},{path:"/feed",component:No},{path:"/login",component:rr},{path:"/reader/:id",component:kr},{path:"/about",component:Nr},{path:"/dashboard/:username",component:Ki}],Zi=It({history:Lt(),routes:Wi}),Vi=Pt();Tt(ta).use(Vi).use(Zi).mount("#app");
