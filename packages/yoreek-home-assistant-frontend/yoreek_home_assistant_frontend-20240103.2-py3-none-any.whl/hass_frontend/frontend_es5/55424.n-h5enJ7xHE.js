"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[55424],{72043:function(e,n,t){t.d(n,{A:function(){return a},v:function(){return c}});var r=t(23158),o=t(25101),i=t(66477),u=function(e,n,t,i){var u=t((0,r.Z)(e,n),i);return u instanceof Date?(0,o.Z)(u,n):u},a=function(e,n,t,r,o){return t.time_zone===i.c_.server?u(e,r.time_zone,n,o):n(e,o)},c=function(e,n,t,r,o){return t.time_zone===i.c_.server?u(e,r.time_zone,n,o):n(e,o)}},92306:function(e,n,t){t.d(n,{v:function(){return o}});var r=t(40039),o=(t(36513),function(e,n){var t,o={},i=(0,r.Z)(e);try{for(i.s();!(t=i.n()).done;){var u=t.value,a=n(u);a in o?o[a].push(u):o[a]=[u]}}catch(c){i.e(c)}finally{i.f()}return o})},81582:function(e,n,t){t.d(n,{DJ:function(){return u},LZ:function(){return o},Nn:function(){return l},Ny:function(){return _},Pk:function(){return g},Q4:function(){return i},RQ:function(){return c},SO:function(){return s},T0:function(){return y},iJ:function(){return f},pB:function(){return a}});var r=t(53709),o=(t(85717),t(37313),32143==t.j?["migration_error","setup_error","setup_retry"]:null),i=32143==t.j?["not_loaded","loaded","setup_error","setup_retry"]:null,u=function(e,n,t){var r={type:"config_entries/subscribe"};return t&&t.type&&(r.type_filter=t.type),e.connection.subscribeMessage((function(e){return n(e)}),r)},a=function(e,n){var t={};return n&&(n.type&&(t.type_filter=n.type),n.domain&&(t.domain=n.domain)),e.callWS(Object.assign({type:"config_entries/get"},t))},c=function(e,n){return e.callWS({type:"config_entries/get_single",entry_id:n})},s=function(e,n,t){return e.callWS(Object.assign({type:"config_entries/update",entry_id:n},t))},f=function(e,n){return e.callApi("DELETE","config/config_entries/entry/".concat(n))},l=function(e,n){return e.callApi("POST","config/config_entries/entry/".concat(n,"/reload"))},_=function(e,n){return e.callWS({type:"config_entries/disable",entry_id:n,disabled_by:"user"})},y=function(e,n){return e.callWS({type:"config_entries/disable",entry_id:n,disabled_by:null})},g=function(e,n){var t=(0,r.Z)(e),o=function(e){var t=n[e.domain];return"helper"===(null==t?void 0:t.integration_type)?-1:1};return t.sort((function(e,n){return o(n)-o(e)}))}},55424:function(e,n,t){t.d(n,{Bm:function(){return x},Cj:function(){return O},G9:function(){return G},Jj:function(){return M},KU:function(){return C},P:function(){return A},UB:function(){return Q},ZC:function(){return B},_Z:function(){return z},b:function(){return F},gy:function(){return L},iK:function(){return P},jB:function(){return U},kJ:function(){return V},o1:function(){return D},rl:function(){return W},vE:function(){return R},xZ:function(){return E},yH:function(){return H}});var r,o,i=t(53709),u=t(68990),a=t(40039),c=t(99312),s=t(81043),f=(t(85717),t(40271),t(60163),t(36513),t(51358),t(46798),t(47084),t(5239),t(98490),t(10733),t(97393),t(9849),t(50289),t(94167),t(88640),t(51467),t(24112)),l=t(74774),_=t(63390),y=t(32182),g=t(38588),p=t(79021),d=t(39244),m=t(59429),v=t(93752),h=t(59699),Z=t(97330),b=t(72043),w=t(49684),k=t(92306),T=t(81582),S=t(38014),j=[],x=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},D=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},P=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},W=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},A=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},C=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},O=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},E=function(e){return e.callWS({type:"energy/info"})},L=32143==t.j?(r=(0,s.Z)((0,c.Z)().mark((function e(n){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",n.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}):null,B=function(e){return e.callWS({type:"energy/get_prefs"})},z=32143==t.j?(o=(0,s.Z)((0,c.Z)().mark((function e(n,t){var r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.callWS(Object.assign({type:"energy/save_prefs"},t)),I(n),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)}))),function(e,n){return o.apply(this,arguments)}):null,J=function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n,t,r,o,i){var u,a=arguments;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=a.length>5&&void 0!==a[5]?a[5]:"hour",e.abrupt("return",n.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:null==i?void 0:i.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:u}));case 2:case"end":return e.stop()}}),e)})));return function(n,t,r,o,i){return e.apply(this,arguments)}}(),M=function(e){return(0,k.v)(e.energy_sources,(function(e){return e.type}))},H=function(e,n,t){var r,o=[],i=(0,a.Z)(e.energy_sources);try{for(i.s();!(r=i.n()).done;){var u=r.value;if(!t||t.includes(u.type))if("solar"!==u.type)if("gas"!==u.type&&"water"!==u.type)if("battery"!==u.type){var c,s=(0,a.Z)(u.flow_from);try{for(s.s();!(c=s.n()).done;){var f=c.value;o.push(f.stat_energy_from),f.stat_cost&&o.push(f.stat_cost);var l=n.cost_sensors[f.stat_energy_from];l&&o.push(l)}}catch(m){s.e(m)}finally{s.f()}var _,y=(0,a.Z)(u.flow_to);try{for(y.s();!(_=y.n()).done;){var g=_.value;o.push(g.stat_energy_to),g.stat_compensation&&o.push(g.stat_compensation);var p=n.cost_sensors[g.stat_energy_to];p&&o.push(p)}}catch(m){y.e(m)}finally{y.f()}}else o.push(u.stat_energy_from),o.push(u.stat_energy_to);else{o.push(u.stat_energy_from),u.stat_cost&&o.push(u.stat_cost);var d=n.cost_sensors[u.stat_energy_from];d&&o.push(d)}else o.push(u.stat_energy_from)}}catch(m){i.e(m)}finally{i.f()}return o},K=function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n,t,r,o,s){var m,v,h,Z,w,k,j,x,D,P,W,A,C,O,L,B,z,M,K,I,N,Q,U,q,G,R,F,V,X,Y,$,ee,ne,te,re,oe,ie,ue,ae,ce,se,fe,le,_e,ye,ge,pe;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,T.pB)(n,{domain:"co2signal"}),E(n)]);case 2:if(m=e.sent,v=(0,u.Z)(m,2),h=v[0],Z=v[1],!(w=h.length?h[0]:void 0)){e.next=21;break}j=0,x=Object.values(n.entities);case 9:if(!(j<x.length)){e.next=21;break}if("co2signal"===(D=x[j]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((P=n.states[D.entity_id])&&"%"===P.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return k=P.entity_id,e.abrupt("break",21);case 18:j++,e.next=9;break;case 21:W=[],A=(0,a.Z)(t.energy_sources);try{for(A.s();!(C=A.n()).done;)if("grid"===(O=C.value).type){L=(0,a.Z)(O.flow_from);try{for(L.s();!(B=L.n()).done;)z=B.value,W.push(z.stat_energy_from)}catch(c){L.e(c)}finally{L.f()}}}catch(c){A.e(c)}finally{A.f()}return M=H(t,Z,["grid","solar","battery","gas"]),K=H(t,Z,["water"]),I=[].concat((0,i.Z)(M),(0,i.Z)(K)),N=(0,f.Z)(o||new Date,r),Q=N>35?"month":N>2?"day":"hour",U=n.config.unit_system.length||"",q={energy:"kWh",volume:"km"===U?"m³":"ft³"},G={volume:"km"===U?"L":"gal"},R=M.length?(0,S.dL)(n,r,o,M,Q,q,["change"]):{},F=K.length?(0,S.dL)(n,r,o,K,Q,G,["change"]):{},$={},ee={},s&&(X=(0,b.v)(r,l.Z,n.locale,n.config)&&(0,b.v)(o||new Date,_.Z,n.locale,n.config)?(0,b.A)(r,y.Z,n.locale,n.config,-(0,b.v)(o||new Date,g.Z,n.locale,n.config,r)-1):(0,b.A)(r,p.Z,n.locale,n.config,-1*(N+1)),Y=(0,d.Z)(r,-1),M.length&&($=(0,S.dL)(n,X,Y,M,Q,q,["change"])),K.length&&(ee=(0,S.dL)(n,X,Y,K,Q,G,["change"]))),void 0!==k&&(ne=J(n,r,W,k,o,N>35?"month":N>2?"day":"hour"),s&&(te=J(n,X,W,k,Y,N>35?"month":N>2?"day":"hour"))),re={},oe=I.length?(0,S.Py)(n,I):[],e.next=42,Promise.all([R,F,$,ee,oe,ne,te]);case 42:return ie=e.sent,ue=(0,u.Z)(ie,7),ae=ue[0],ce=ue[1],se=ue[2],fe=ue[3],le=ue[4],_e=ue[5],ye=ue[6],ge=Object.assign(Object.assign({},ae),ce),s&&(V=Object.assign(Object.assign({},se),fe)),I.length&&le.forEach((function(e){re[e.statistic_id]=e})),pe={start:r,end:o,startCompare:X,endCompare:Y,info:Z,prefs:t,stats:ge,statsMetadata:re,statsCompare:V,co2SignalConfigEntry:w,co2SignalEntity:k,fossilEnergyConsumption:_e,fossilEnergyConsumptionCompare:ye},e.abrupt("return",pe);case 56:case"end":return e.stop()}}),e)})));return function(n,t,r,o,i){return e.apply(this,arguments)}}(),I=function(e){j.forEach((function(n){var t=Q(e,{key:n});t.clearPrefs(),t._active&&t.refresh()}))},N=function(e){if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){var n=new Date;n.getMinutes()>=20&&n.setHours(n.getHours()+1),n.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((function(){return e.refresh()}),n.getTime()-Date.now())}},Q=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="_energy";if(n.key){if(!n.key.startsWith("energy_"))throw new Error("Key need to start with energy_");t="_".concat(n.key)}if(e.connection[t])return e.connection[t];j.push(n.key);var r=(0,Z._)(e.connection,t,(0,s.Z)((0,c.Z)().mark((function n(){return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.prefs){n.next=4;break}return n.next=3,B(e);case 3:r.prefs=n.sent;case 4:return N(r),n.abrupt("return",K(e,r.prefs,r.start,r.end,r.compare));case 6:case"end":return n.stop()}}),n)})))),o=r.subscribe;r.subscribe=function(e){var n=o(e);return r._active++,void 0===r._refreshTimeout&&N(r),function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),n()}},r._active=0,r.prefs=n.prefs;var i=new Date,u=(0,w.Zs)(i,e.locale,e.config).split(":")[0];r.start=(0,b.A)("0"===u?(0,p.Z)(i,-1):i,m.Z,e.locale,e.config),r.end=(0,b.A)("0"===u?(0,p.Z)(i,-1):i,v.Z,e.locale,e.config);var a=function n(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,b.A)(new Date,m.Z,e.locale,e.config),r.end=(0,b.A)(new Date,v.Z,e.locale,e.config),n()}),(0,h.Z)((0,b.A)(i,v.Z,e.locale,e.config),1).getTime()-Date.now())};return a(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(n,t){var o;r.start=n,r.end=t,r.start.getTime()!==(0,b.A)(new Date,m.Z,e.locale,e.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,b.A)(new Date,v.Z,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):a()},r.setCompare=function(e){r.compare=e},r},U=function(e){return e.callWS({type:"energy/solar_forecast"})},q=["volume","energy"],G=function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,a.Z)(e.energy_sources);try{for(o.s();!(n=o.n()).done;){var i=n.value;if("gas"===i.type&&(!r||r!==i.stat_energy_from)){var u=t[i.stat_energy_from];if(q.includes(null==u?void 0:u.unit_class))return u.unit_class}}}catch(c){o.e(c)}finally{o.f()}},R=function(e,n){var t=G(n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==t)return"energy"===t?"kWh":"km"===e.config.unit_system.length?"m³":"ft³"},F=function(e){return"km"===e.config.unit_system.length?"L":"gal"},V="/docs/energy/faq/#troubleshooting-missing-entities"}}]);
//# sourceMappingURL=55424.n-h5enJ7xHE.js.map