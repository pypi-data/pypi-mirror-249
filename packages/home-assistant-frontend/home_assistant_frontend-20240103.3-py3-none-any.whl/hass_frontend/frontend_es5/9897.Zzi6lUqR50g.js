"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[9897],{73826:function(e,t,r){r.d(t,{f:function(){return f}});var a=r(40039),s=r(33368),i=r(71650),n=r(82390),o=r(69205),d=r(70906),u=r(91808),c=r(34541),l=r(47838),h=(r(97393),r(46798),r(47084),r(51358),r(98490),r(40271),r(60163),r(9849),r(13526),r(95260)),f=function(e){var t=(0,u.Z)(null,(function(e,t){var r=function(t){(0,o.Z)(a,t);var r=(0,d.Z)(a);function a(){var t;(0,i.Z)(this,a);for(var s=arguments.length,o=new Array(s),d=0;d<s;d++)o[d]=arguments[d];return t=r.call.apply(r,[this].concat(o)),e((0,n.Z)(t)),t}return(0,s.Z)(a)}(t);return{F:r,d:[{kind:"field",decorators:[(0,h.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,c.Z)((0,l.Z)(r.prototype),"connectedCallback",this).call(this),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,c.Z)((0,l.Z)(r.prototype),"disconnectedCallback",this).call(this),this.__unsubs){for(;this.__unsubs.length;){var e=this.__unsubs.pop();e instanceof Promise?e.then((function(e){return e()})):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,c.Z)((0,l.Z)(r.prototype),"updated",this).call(this,e),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps){var t,s=(0,a.Z)(e.keys());try{for(s.s();!(t=s.n()).done;){var i=t.value;if(this.hassSubscribeRequiredHostProps.includes(i))return void this.__checkSubscribed()}}catch(n){s.e(n)}finally{s.f()}}}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var e,t=this;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((function(e){return void 0===t[e]}))||(this.__unsubs=this.hassSubscribe())}}]}}),e);return t}},91965:function(e,t,r){r.d(t,{J:function(){return l}});r(97393),r(85717);var a=r(42722),s=r(24112),i=r(72277),n=r(59699),o=r(18457),d=r(12198),u=r(49684);function c(e,t){var r=new Date(t);return e>2&&0===r.getHours()&&(r=(0,a.Z)(r,1)),r.setMinutes(0,0,0),e>35&&r.setDate(1),e>2&&r.setHours(0),r.getTime()}function l(e,t,r,a,l,h,f){var _=(0,s.Z)(t,e),g=void 0!==h&&void 0!==f;if(g&&_<=35){var y=(0,i.Z)(t,e),b=(0,i.Z)(f,h);b>y?t=(0,n.Z)(t,b-y):y>b&&(f=(0,n.Z)(f,y-b))}var v={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:e.getTime(),max:c(_,t),adapters:{date:{locale:r,config:a}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(e){return e.tick&&e.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:_>35?"monthyear":_>7?"date":_>2?"weekday":_>0?"datetime":"hour",minUnit:_>35?"month":_>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:l},ticks:{beginAtZero:!0,callback:function(e){return(0,o.uf)(Math.abs(e),r)}}}},plugins:{tooltip:{position:"nearest",filter:function(e){return"0"!==e.formattedValue},itemSort:function(e,t){return t.datasetIndex-e.datasetIndex},callbacks:{title:function(e){if(_>0)return e[0].label;var t=new Date(e[0].parsed.x);return"".concat(g?"".concat((0,d.ud)(t,r,a),": "):"").concat((0,u.mr)(t,r,a)," â€“ ").concat((0,u.mr)((0,n.Z)(t,1),r,a))},label:function(e){return"".concat(e.dataset.label,": ").concat((0,o.uf)(e.parsed.y,r)," ").concat(l)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,o.Hd)(r)};return g&&(v.scales.xAxisCompare=Object.assign(Object.assign({},v.scales.x),{},{suggestedMin:h.getTime(),max:c(_,f),display:!1})),v}},9897:function(e,t,r){r.r(t),r.d(t,{HuiEnergyUsageGraphCard:function(){return R}});var a,s,i,n,o=r(99312),d=r(53709),u=r(68990),c=r(81043),l=r(40039),h=r(88962),f=r(33368),_=r(71650),g=r(82390),y=r(69205),b=r(70906),v=r(91808),p=(r(97393),r(46798),r(9849),r(13526),r(85717),r(87438),r(22890),r(11451),r(50289),r(94167),r(82073),r(10733),r(36513),r(40271),r(65974),r(37313),r(32797),r(5239),r(51358),r(78399),r(56086),r(47884),r(81912),r(64584),r(41483),r(12367),r(9454),r(98490),r(76843),r(27088)),m=r(70390),k=r(53970),Z=r(68144),x=r(95260),S=r(83448),O=r(14516),j=r(15838),C=r(89525),w=r(18457),P=(r(62336),r(22098),r(55424)),E=r(38014),D=r(73826),z=r(53658),M=r(91965),R=(0,v.Z)([(0,x.Mo)("hui-energy-usage-graph-card")],(function(e,t){var r,v=function(t){(0,y.Z)(a,t);var r=(0,b.Z)(a);function a(){var t;(0,_.Z)(this,a);for(var s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return t=r.call.apply(r,[this].concat(i)),e((0,g.Z)(t)),t}return(0,f.Z)(a)}(t);return{F:v,d:[{kind:"field",decorators:[(0,x.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,x.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,x.SB)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,x.SB)()],key:"_start",value:function(){return(0,p.Z)()}},{kind:"field",decorators:[(0,x.SB)()],key:"_end",value:function(){return(0,m.Z)()}},{kind:"field",decorators:[(0,x.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,x.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e,t=this;return[(0,P.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((function(e){return t._getStatistics(e)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,z.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,Z.dy)(a||(a=(0,h.Z)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,Z.dy)(s||(s=(0,h.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,S.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.some((function(e){return e.data.length}))?"":(0,Z.dy)(i||(i=(0,h.Z)(['<div class="no-data"> '," </div>"])),(0,k.Z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):Z.Ld}},{kind:"field",key:"_createOptions",value:function(){var e=this;return(0,O.Z)((function(t,r,a,s,i,n){var o=(0,M.J)(t,r,a,s,"kWh",i,n),d=Object.assign(Object.assign({},o),{},{plugins:Object.assign(Object.assign({},o.plugins),{},{tooltip:Object.assign(Object.assign({},o.plugins.tooltip),{},{itemSort:function(e,t){var r,a,s,i,n;return(null===(r=e.raw)||void 0===r?void 0:r.y)>0&&(null===(a=t.raw)||void 0===a?void 0:a.y)<0?-1:(null===(s=t.raw)||void 0===s?void 0:s.y)>0&&(null===(i=e.raw)||void 0===i?void 0:i.y)<0?1:(null===(n=e.raw)||void 0===n?void 0:n.y)>0?t.datasetIndex-e.datasetIndex:e.datasetIndex-t.datasetIndex},callbacks:Object.assign(Object.assign({},o.plugins.tooltip.callbacks),{},{footer:function(t){var r,s=0,i=0,n=(0,l.Z)(t);try{for(n.s();!(r=n.n()).done;){var o=r.value,d=o.dataset.data[o.dataIndex].y;d>0?s+=d:i+=Math.abs(d)}}catch(u){n.e(u)}finally{n.f()}return[s?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,w.uf)(s,a)}):"",i?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,w.uf)(i,a)}):""].filter(Boolean)}})})})});return d}))}},{kind:"method",key:"_getStatistics",value:(r=(0,c.Z)((0,o.Z)().mark((function e(t){var r,a,s,i,n,c,h,f,_,g,y,b,v,p,k;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a={},s=(0,l.Z)(t.prefs.energy_sources),e.prev=3,s.s();case 5:if((i=s.n()).done){e.next=21;break}if("solar"!==(n=i.value).type){e.next=10;break}return a.solar?a.solar.push(n.stat_energy_from):a.solar=[n.stat_energy_from],e.abrupt("continue",19);case 10:if("battery"!==n.type){e.next=13;break}return a.to_battery?(a.to_battery.push(n.stat_energy_to),a.from_battery.push(n.stat_energy_from)):(a.to_battery=[n.stat_energy_to],a.from_battery=[n.stat_energy_from]),e.abrupt("continue",19);case 13:if("grid"===n.type){e.next=15;break}return e.abrupt("continue",19);case 15:c=(0,l.Z)(n.flow_from);try{for(c.s();!(h=c.n()).done;)f=h.value,a.from_grid?a.from_grid.push(f.stat_energy_from):a.from_grid=[f.stat_energy_from]}catch(o){c.e(o)}finally{c.f()}_=(0,l.Z)(n.flow_to);try{for(_.s();!(g=_.n()).done;)y=g.value,a.to_grid?a.to_grid.push(y.stat_energy_to):a.to_grid=[y.stat_energy_to]}catch(o){_.e(o)}finally{_.f()}case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),s.e(e.t0);case 26:return e.prev=26,s.f(),e.finish(26);case 29:b=getComputedStyle(this),v={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},p={to_grid:{base:b.getPropertyValue(v.to_grid).trim()},to_battery:{base:b.getPropertyValue(v.to_battery).trim()},from_grid:{base:b.getPropertyValue(v.from_grid).trim()},used_grid:{base:b.getPropertyValue(v.used_grid).trim()},used_solar:{base:b.getPropertyValue(v.used_solar).trim()},used_battery:{base:b.getPropertyValue(v.used_battery).trim()}},Object.entries(v).forEach((function(e){var t=(0,u.Z)(e,2),r=t[0],s=t[1];"used_grid"!==r&&"used_solar"!==r&&"used_battery"!==r&&(p[r].overrides=[],a[r]&&Object.values(a[r]).forEach((function(e,t){var a=b.getPropertyValue(s+"-"+t).trim();a.length>0&&(p[r].overrides[e]=a)})))})),k={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=t.start,this._end=t.end||(0,m.Z)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,r.push.apply(r,(0,d.Z)(this._processDataSet(t.stats,t.statsMetadata,a,p,k,!1))),t.statsCompare&&(r.push({order:0,data:[]}),r.push({order:999,data:[],xAxisID:"xAxisCompare"}),r.push.apply(r,(0,d.Z)(this._processDataSet(t.statsCompare,t.statsMetadata,a,p,k,!0)))),this._chartData={datasets:r};case 41:case"end":return e.stop()}}),e,this,[[3,23,26,29]])}))),function(e){return r.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(e,t,r,a,s){var i,n=this,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=[],c={},h={};Object.entries(r).forEach((function(t){var r=(0,u.Z)(t,2),a=r[0],s=r[1],n=["solar","to_grid","from_grid","to_battery","from_battery"].includes(a),o=!["solar","from_battery"].includes(a),d={},l={};s.forEach((function(t){var r=e[t];if(r){var a={};r.forEach((function(e){if(null!==e.change&&void 0!==e.change){var t=e.change;n&&(d[e.start]=e.start in d?d[e.start]+t:t,i=e.end),o&&!(e.start in a)&&(a[e.start]=t,i=e.end)}})),l[t]=a}})),n&&(h[a]=d),o&&(c[a]=l)}));var f={},_={};if((h.to_grid||h.to_battery)&&h.solar){for(var g={},y=0,b=Object.keys(h.solar);y<b.length;y++){var v,p,m=b[y];if(g[m]=(h.solar[m]||0)-((null===(v=h.to_grid)||void 0===v?void 0:v[m])||0)-((null===(p=h.to_battery)||void 0===p?void 0:p[m])||0),g[m]<0){var k,Z,x;if(h.to_battery)if(f[m]=-1*g[m],f[m]>((null===(k=h.from_grid)||void 0===k?void 0:k[m])||0))_[m]=Math.min(0,f[m]-((null===(Z=h.from_grid)||void 0===Z?void 0:Z[m])||0)),f[m]=null===(x=h.from_grid)||void 0===x?void 0:x[m];g[m]=0}}c.used_solar={used_solar:g}}if(h.from_battery)if(h.to_grid){for(var S={},O=0,w=Object.keys(h.from_battery);O<w.length;O++){var P=w[O];S[P]=(h.from_battery[P]||0)-(_[P]||0)}c.used_battery={used_battery:S}}else c.used_battery={used_battery:h.from_battery};if(c.from_grid&&h.to_battery){for(var D={},z=function(){for(var e,t=R[M],r=0,a=0,s=Object.entries(c.from_grid);a<s.length;a++){var i=(0,u.Z)(s[a],2),n=i[0];if(i[1][t]&&(e=n,r++),r>1)break}if(1===r)c.from_grid[e][t]-=f[t]||0;else{var o=0;Object.values(c.from_grid).forEach((function(e){o+=e[t]||0,delete e[t]})),D[t]=o-(f[t]||0)}},M=0,R=Object.keys(f);M<R.length;M++)z();c.used_grid={used_grid:D}}var A=[];Object.values(c).forEach((function(e){Object.values(e).forEach((function(e){A=A.concat(Object.keys(e))}))}));var H=Array.from(new Set(A)).sort((function(e,t){return Number(e)-Number(t)}));return Object.entries(c).forEach((function(e){var r=(0,u.Z)(e,2),h=r[0],f=r[1];Object.entries(f).forEach((function(e,r){var f,_=(0,u.Z)(e,2),g=_[0],y=_[1],b=null===(f=a[h].overrides)||void 0===f?void 0:f[g];if(!b){var v=r>0?n.hass.themes.darkMode?(0,C.C)((0,j.Rw)((0,j.wK)(a[h].base)),r):(0,C.W)((0,j.Rw)((0,j.wK)(a[h].base)),r):void 0;b=v?(0,j.CO)((0,j.p3)(v)):a[h].base}var p,m=[],k=(0,l.Z)(H);try{for(k.s();!(p=k.n()).done;){var Z=p.value,x=y[Z]||0;m.push({x:Number(Z),y:x&&["to_grid","to_battery"].includes(h)?-1*x:x})}}catch(S){k.e(S)}finally{k.f()}1===m.length&&m.push({x:i,y:0}),d.push({label:h in s?s[h]:(0,E.Kd)(n.hass,g,t[g]),order:"used_solar"===h?1:"to_battery"===h?Object.keys(c).length:r+2,borderColor:o?b+"7F":b,backgroundColor:o?b+"32":b+"7F",stack:"stack",data:m,xAxisID:o?"xAxisCompare":void 0})}))})),d}},{kind:"get",static:!0,key:"styles",value:function(){return(0,Z.iv)(n||(n=(0,h.Z)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;box-sizing:border-box}"])))}}]}}),(0,D.f)(Z.oi))}}]);
//# sourceMappingURL=9897.Zzi6lUqR50g.js.map