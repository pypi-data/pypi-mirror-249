"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[70310],{73826:function(e,t,a){a.d(t,{f:function(){return f}});var r=a(40039),s=a(33368),n=a(71650),i=a(82390),o=a(69205),c=a(70906),d=a(91808),u=a(34541),l=a(47838),h=(a(97393),a(46798),a(47084),a(51358),a(98490),a(40271),a(60163),a(9849),a(13526),a(95260)),f=function(e){var t=(0,d.Z)(null,(function(e,t){var a=function(t){(0,o.Z)(r,t);var a=(0,c.Z)(r);function r(){var t;(0,n.Z)(this,r);for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return t=a.call.apply(a,[this].concat(o)),e((0,i.Z)(t)),t}return(0,s.Z)(r)}(t);return{F:a,d:[{kind:"field",decorators:[(0,h.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,u.Z)((0,l.Z)(a.prototype),"connectedCallback",this).call(this),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,u.Z)((0,l.Z)(a.prototype),"disconnectedCallback",this).call(this),this.__unsubs){for(;this.__unsubs.length;){var e=this.__unsubs.pop();e instanceof Promise?e.then((function(e){return e()})):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,u.Z)((0,l.Z)(a.prototype),"updated",this).call(this,e),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps){var t,s=(0,r.Z)(e.keys());try{for(s.s();!(t=s.n()).done;){var n=t.value;if(this.hassSubscribeRequiredHostProps.includes(n))return void this.__checkSubscribed()}}catch(i){s.e(i)}finally{s.f()}}}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var e,t=this;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((function(e){return void 0===t[e]}))||(this.__unsubs=this.hassSubscribe())}}]}}),e);return t}},91965:function(e,t,a){a.d(t,{J:function(){return l}});a(97393),a(85717);var r=a(42722),s=a(24112),n=a(72277),i=a(59699),o=a(18457),c=a(12198),d=a(49684);function u(e,t){var a=new Date(t);return e>2&&0===a.getHours()&&(a=(0,r.Z)(a,1)),a.setMinutes(0,0,0),e>35&&a.setDate(1),e>2&&a.setHours(0),a.getTime()}function l(e,t,a,r,l,h,f){var p=(0,s.Z)(t,e),v=void 0!==h&&void 0!==f;if(v&&p<=35){var g=(0,n.Z)(t,e),y=(0,n.Z)(f,h);y>g?t=(0,i.Z)(t,y-g):g>y&&(f=(0,i.Z)(f,g-y))}var _={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:e.getTime(),max:u(p,t),adapters:{date:{locale:a,config:r}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(e){return e.tick&&e.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:p>35?"monthyear":p>7?"date":p>2?"weekday":p>0?"datetime":"hour",minUnit:p>35?"month":p>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:l},ticks:{beginAtZero:!0,callback:function(e){return(0,o.uf)(Math.abs(e),a)}}}},plugins:{tooltip:{position:"nearest",filter:function(e){return"0"!==e.formattedValue},itemSort:function(e,t){return t.datasetIndex-e.datasetIndex},callbacks:{title:function(e){if(p>0)return e[0].label;var t=new Date(e[0].parsed.x);return"".concat(v?"".concat((0,c.ud)(t,a,r),": "):"").concat((0,d.mr)(t,a,r)," â€“ ").concat((0,d.mr)((0,i.Z)(t,1),a,r))},label:function(e){return"".concat(e.dataset.label,": ").concat((0,o.uf)(e.parsed.y,a)," ").concat(l)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,o.Hd)(a)};return v&&(_.scales.xAxisCompare=Object.assign(Object.assign({},_.scales.x),{},{suggestedMin:h.getTime(),max:u(p,f),display:!1})),_}},70310:function(e,t,a){a.r(t),a.d(t,{HuiEnergySolarGraphCard:function(){return A}});var r,s,n,i,o=a(68990),c=a(99312),d=a(53709),u=a(81043),l=a(40039),h=a(88962),f=a(33368),p=a(71650),v=a(82390),g=a(69205),y=a(70906),_=a(91808),b=(a(97393),a(85717),a(87438),a(46798),a(9849),a(22890),a(13526),a(11451),a(36513),a(50289),a(94167),a(82073),a(76843),a(27088)),k=a(70390),m=a(53970),Z=a(24112),x=a(68144),S=a(95260),C=a(83448),w=a(14516),D=a(15838),j=a(89525),O=a(18457),R=(a(62336),a(22098),a(55424)),P=a(38014),H=a(73826),M=a(53658),z=a(91965),A=(0,_.Z)([(0,S.Mo)("hui-energy-solar-graph-card")],(function(e,t){var a,_=function(t){(0,g.Z)(r,t);var a=(0,y.Z)(r);function r(){var t;(0,p.Z)(this,r);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return t=a.call.apply(a,[this].concat(n)),e((0,v.Z)(t)),t}return(0,f.Z)(r)}(t);return{F:_,d:[{kind:"field",decorators:[(0,S.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,S.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,S.SB)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,S.SB)()],key:"_start",value:function(){return(0,b.Z)()}},{kind:"field",decorators:[(0,S.SB)()],key:"_end",value:function(){return(0,k.Z)()}},{kind:"field",decorators:[(0,S.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,S.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e,t=this;return[(0,R.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((function(e){return t._getStatistics(e)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,M.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,x.dy)(r||(r=(0,h.Z)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,x.dy)(s||(s=(0,h.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,C.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.length?"":(0,x.dy)(n||(n=(0,h.Z)(['<div class="no-data"> '," </div>"])),(0,m.Z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):x.Ld}},{kind:"field",key:"_createOptions",value:function(){var e=this;return(0,w.Z)((function(t,a,r,s,n,i){var o=(0,z.J)(t,a,r,s,"kWh",n,i);return Object.assign(Object.assign({},o),{},{plugins:Object.assign(Object.assign({},o.plugins),{},{tooltip:Object.assign(Object.assign({},o.plugins.tooltip),{},{callbacks:Object.assign(Object.assign({},o.plugins.tooltip.callbacks),{},{footer:function(t){var a=t.filter((function(e){var t;return"solar"===(null===(t=e.dataset)||void 0===t?void 0:t.stack)}));if(a.length<2)return[];var s,n=0,i=(0,l.Z)(a);try{for(i.s();!(s=i.n()).done;){var o=s.value;n+=o.dataset.data[o.dataIndex].y}}catch(c){i.e(c)}finally{i.f()}return 0===n?[]:[e.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.total_produced",{num:(0,O.uf)(n,r)})]}})})}),elements:{line:{tension:.3,borderWidth:1.5},bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:5}}})}))}},{kind:"method",key:"_getStatistics",value:(a=(0,u.Z)((0,c.Z)().mark((function e(t){var a,r,s,n,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.prefs.energy_sources.filter((function(e){return"solar"===e.type}))).some((function(e){var t;return null===(t=e.config_entry_solar_forecast)||void 0===t?void 0:t.length}))){e.next=10;break}return e.prev=2,e.next=5,(0,R.jB)(this.hass);case 5:r=e.sent,e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:s=[],n=getComputedStyle(this),i=n.getPropertyValue("--energy-solar-color").trim(),s.push.apply(s,(0,d.Z)(this._processDataSet(t.stats,t.statsMetadata,a,i,n))),t.statsCompare&&(s.push({order:0,data:[]}),s.push({order:999,data:[],xAxisID:"xAxisCompare"}),s.push.apply(s,(0,d.Z)(this._processDataSet(t.statsCompare,t.statsMetadata,a,i,n,!0)))),r&&s.push.apply(s,(0,d.Z)(this._processForecast(t.statsMetadata,r,a,n.getPropertyValue("--primary-text-color"),t.start,t.end))),this._start=t.start,this._end=t.end||(0,k.Z)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:s};case 21:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return a.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(e,t,a,r,s){var n=this,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=[];return a.forEach((function(a,c){var d=s.getPropertyValue("--energy-solar-color-"+c).trim();if(0===d.length){var u=c>0?n.hass.themes.darkMode?(0,j.C)((0,D.Rw)((0,D.wK)(r)),c):(0,j.W)((0,D.Rw)((0,D.wK)(r)),c):void 0;d=u?(0,D.CO)((0,D.p3)(u)):r}var h=null,f=[];if(a.stat_energy_from in e){var p,v,g=e[a.stat_energy_from],y=(0,l.Z)(g);try{for(y.s();!(v=y.n()).done;){var _=v.value;if(null!==_.change&&void 0!==_.change&&h!==_.start){var b=new Date(_.start);f.push({x:b.getTime(),y:_.change}),h=_.start,p=_.end}}}catch(k){y.e(k)}finally{y.f()}1===f.length&&f.push({x:p,y:0})}o.push({label:n.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.production",{name:(0,P.Kd)(n.hass,a.stat_energy_from,t[a.stat_energy_from])}),borderColor:i?d+"7F":d,backgroundColor:i?d+"32":d+"7F",data:f,order:1,stack:"solar",xAxisID:i?"xAxisCompare":void 0})})),o}},{kind:"method",key:"_processForecast",value:function(e,t,a,r,s,n){var i=this,c=[],d=(0,Z.Z)(n||new Date,s);return a.forEach((function(a){if(a.config_entry_solar_forecast){var u={};if(a.config_entry_solar_forecast.forEach((function(e){t[e]&&Object.entries(t[e].wh_hours).forEach((function(e){var t=(0,o.Z)(e,2),a=t[0],r=t[1],i=new Date(a);if(!(i<s||n&&i>n)){d>35&&i.setDate(1),d>2?i.setHours(0,0,0,0):i.setMinutes(0,0,0);var c=i.getTime();c in u?u[c]+=r:u[c]=r}}))})),u){for(var l=[],h=0,f=Object.entries(u);h<f.length;h++){var p=(0,o.Z)(f[h],2),v=p[0],g=p[1];l.push({x:Number(v),y:g/1e3})}l.length&&c.push({type:"line",label:i.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.forecast",{name:(0,P.Kd)(i.hass,a.stat_energy_from,e[a.stat_energy_from])}),fill:!1,stepped:!1,borderColor:r,borderDash:[7,5],pointRadius:0,data:l})}}})),c}},{kind:"get",static:!0,key:"styles",value:function(){return(0,x.iv)(i||(i=(0,h.Z)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;box-sizing:border-box}"])))}}]}}),(0,H.f)(x.oi))}}]);
//# sourceMappingURL=70310.KULIt3hqgDI.js.map