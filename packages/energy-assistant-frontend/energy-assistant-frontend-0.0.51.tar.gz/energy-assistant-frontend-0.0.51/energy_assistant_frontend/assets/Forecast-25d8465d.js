var B=Object.defineProperty;var I=(u,r,l)=>r in u?B(u,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[r]=l;var S=(u,r,l)=>(I(u,typeof r!="symbol"?r+"":r,l),l);import{C as j,j as A,L as M,P as R,l as $,h as J,p as O,f as Q,n as w}from"./index-ee573144.js";import{M as Z,Z as q,r as D,c as f,o as z,a3 as _,l as G,S as H,J as o,O as c,Q as p,w as i,aa as n,_ as v,$ as m}from"./index-8ef18653.js";import{V as K}from"./VToolbar-e324ab48.js";import{V as U}from"./VDivider-55d508c3.js";import{b,V as h,a as C}from"./VCard-b69b9241.js";import"./VImg-326431bc.js";import"./index-7cdcfa5d.js";import"./VAvatar-9bbc4728.js";const X={class:"v-full w-full justify-center p-4 bg-background"},Y={class:"h-96"},ee={class:"h-96"},ce=Z({__name:"Forecast",setup(u){const r=q(),l=D(),d=D(""),y=["red","pink","purple","deep-purple","blue","light-blue","cyan","teal","green","light-green","lime","organe","deep-orange","brown","blue-grey"];class V{constructor(){S(this,"index",0)}getNextColor(){const a=y[this.index++];return this.index>=y.length&&(this.index=0),a}}function x(e){switch(e){case"pv":return r.current.value.colors.sun;case"pv_forecast":return r.current.value.colors.sun;case"consumption":return r.current.value.colors.grid;case"no_var_loads":return r.current.value.colors.grid;default:return null}}function g(e){switch(e){case"pv":return n("forecast.pv");case"pv_forecast":return n("forecast.pv_forecast");case"consumption":return n("forecast.consumption");case"no_var_loads":return n("forecast.no_var_loads");default:return _.getDeviceInfo(e).name}}function k(e){if(e&&e.series){let a=new V;return e.series.filter(t=>t.name!="cost_profit").map(t=>{if(t.name=="pv"||t.name=="no_var_loads"){let s=x(t.name);return{label:g(t.name),data:t.data,fill:!1,backgroundColor:s,borderColor:s,borderDash:[5,5],borderWidth:2,pointStyle:!1}}else if(t.name=="pv_forecast"||t.name=="consumption"){let s=x(t.name);return{label:g(t.name),data:t.data,fill:!1,backgroundColor:s,borderColor:s,borderWidth:2,pointStyle:!1}}else{let s=a.getNextColor();return{label:g(t.name),data:t.data,fill:!1,backgroundColor:s,borderColor:s,stepped:!0,borderWidth:2,pointStyle:!1}}})}return[]}function L(e){return e&&e.series?e.series.filter(a=>a.name=="cost_profit").map(a=>{const t="blue";return{label:n("forecast.cost_profit"),data:a.data,fill:!1,backgroundColor:t,borderColor:t,borderWidth:2,pointStyle:!1,stepped:!0}}):[]}const T=f(()=>{var e;return{labels:(e=l.value)==null?void 0:e.time.map(a=>new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),datasets:k(l.value)}}),P=f(()=>{var e;return{labels:(e=l.value)==null?void 0:e.time.map(a=>new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),datasets:L(l.value)}}),N=f(()=>{var t;const e=(t=l.value)==null?void 0:t.series.filter(s=>s.name=="cost_profit")[0].data,a=e==null?void 0:e.reduce((s,F)=>s+F,0);return a?a<0?n("forecast.total_cost")+": "+-a.toFixed(2)+" "+d.value:n("forecast.total_profit")+": "+a.toFixed(2)+" "+d.value:"unknown"}),W={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}},scales:{y:{title:{display:!0,text:"W"}}}},E=f(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}},scales:{y:{title:{display:!0,text:d.value}}}}));return j.register(A,M,R,$,J,O,Q),z(async()=>{l.value=await _.getForecast();const e=await _.getConfig();d.value=e.home_assistant.currency,console.log(e.home_assistant)}),(e,a)=>(G(),H("div",null,[o(K,{color:"transparent",title:c(n)("app.forecast")},null,8,["title"]),o(U),p("div",X,[o(b,{class:"mb-4 p-4 rounded-lg elevation-6"},{default:i(()=>[o(h,null,{default:i(()=>[v(m(c(n)("forecast.summary")),1)]),_:1}),o(C,null,{default:i(()=>[p("div",null,m(N.value),1)]),_:1})]),_:1}),o(b,{class:"mb-4 p-4 rounded-lg elevation-6"},{default:i(()=>[o(h,null,{default:i(()=>[v(m(c(n)("forecast.energy")),1)]),_:1}),o(C,null,{default:i(()=>[p("div",Y,[o(c(w),{data:T.value,options:W},null,8,["data"])])]),_:1})]),_:1}),o(b,{class:"mb-4 p-4 rounded-lg elevation-6"},{default:i(()=>[o(h,null,{default:i(()=>[v(m(c(n)("forecast.cost_profit")),1)]),_:1}),o(C,null,{default:i(()=>[p("div",ee,[o(c(w),{data:P.value,options:E.value},null,8,["data","options"])])]),_:1})]),_:1})])]))}});export{ce as default};
