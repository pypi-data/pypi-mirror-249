version: "3"
name: jasmin-mongo
services:
  logger:
    build: .
    image: jasmin-mongo-logger
    restart: always
    networks:
      - mongo-cluster_cluster_subnet
    environment:
      AMQP_BROKER_HOST: ${AMQP_BROKER_HOST:-rabbit-mq}
      AMQP_BROKER_PORT: ${AMQP_BROKER_PORT:-5672}
      AMQP_BROKER_USERNAME: ${AMQP_BROKER_USERNAME:-guest}
      AMQP_BROKER_PASSWORD: ${AMQP_BROKER_PASSWORD:-guest}
      AMQP_BROKER_VHOST: ${AMQP_BROKER_VHOST:-/}
      AMQP_BROKER_HEARTBEAT: ${AMQP_BROKER_HEARTBEAT:-0}

      MONGO_CONNECTION_STRING: mongodb://${MONGODB_USERNAME:?err}:${MONGODB_PASSWORD:?err}@${MONGODB_CLUSTER_HOSTS:?err}/?authSource=admin&replicaSet=rs
      MONGO_LOGGER_DATABASE: ${MONGO_LOGGER_DATABASE:-logger}
      MONGO_LOGGER_COLLECTION: ${MONGO_LOGGER_COLLECTION:-sms_log}
      
      RETRY_ON_CONNECTION_ERROR: ${RETRY_ON_CONNECTION_ERROR:-True}
      RETRY_COUNT: ${RETRY_COUNT:-0}
      RETRY_TIMEOUT: ${RETRY_TIMEOUT:-5}

      JASMIN_MONGO_LOGGER_LOG_LEVEL: ${JASMIN_MONGO_LOGGER_LOG_LEVEL:-INFO}
      JASMIN_MONGO_LOGGER_LOG_PATH: ${JASMIN_MONGO_LOGGER_LOG_PATH:-/var/log/jasmin/}
      JASMIN_MONGO_LOGGER_LOG_FILE: ${JASMIN_MONGO_LOGGER_LOG_FILE:-mongo-logger.log}      
      JASMIN_MONGO_LOGGER_LOG_ROTATE: ${JASMIN_MONGO_LOGGER_LOG_ROTATE:-midnight}
      JASMIN_MONGO_LOGGER_LOG_FORMAT: ${JASMIN_MONGO_LOGGER_LOG_FORMAT:-'%(asctime)s %(levelname)-8s %(name)-15s %(message)s'}
      JASMIN_MONGO_LOGGER_LOG_DATE_FORMAT: ${JASMIN_MONGO_LOGGER_LOG_DATE_FORMAT:-'%Y-%m-%d %H:%M:%S'}
      JASMIN_MONGO_LOGGER_FILE_LOGGING: ${JASMIN_MONGO_LOGGER_FILE_LOGGING:-False}
      JASMIN_MONGO_LOGGER_CONSOLE_LOGGING: ${JASMIN_MONGO_LOGGER_CONSOLE_LOGGING:-True}


networks:
  mongo-cluster_cluster_subnet:
    external: true
