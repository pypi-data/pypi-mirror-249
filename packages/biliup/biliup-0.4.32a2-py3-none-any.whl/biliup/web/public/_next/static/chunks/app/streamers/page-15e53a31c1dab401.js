(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[350],{92832:function(e,t,r){"use strict";var n=r(2265),i=r(88046);let a=(0,i.A)(function(e){return n.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 5V4H14V5H10ZM8 5V3C8 2.44772 8.44772 2 9 2H15C15.5523 2 16 2.44772 16 3V5H19H20C20.5523 5 21 5.44772 21 6C21 6.55228 20.5523 7 20 7H19V21C19 21.5523 18.5523 22 18 22H6C5.44772 22 5 21.5523 5 21V7H4C3.44772 7 3 6.55228 3 6C3 5.44772 3.44772 5 4 5H5H8ZM15 7H9H7V20H17V7H15ZM9 9.5C9 9.22386 9.22386 9 9.5 9H10.5C10.7761 9 11 9.22386 11 9.5V16.5C11 16.7761 10.7761 17 10.5 17H9.5C9.22386 17 9 16.7761 9 16.5V9.5ZM13 9.5C13 9.22386 13.2239 9 13.5 9H14.5C14.7761 9 15 9.22386 15 9.5V16.5C15 16.7761 14.7761 17 14.5 17H13.5C13.2239 17 13 16.7761 13 16.5V9.5Z",fill:"currentColor"}))},"delete_stroked");t.Z=a},64724:function(e,t,r){"use strict";var n=r(2265),i=r(88046);let a=(0,i.A)(function(e){return n.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.1422 4.41421L19.728 3C18.9469 2.21895 17.6806 2.21895 16.8995 3L15.4853 4.41423L14.7782 5.12132L8.31076 11.5888C8.16555 11.734 8.06856 11.9204 8.03299 12.1227L7.42936 15.5547C7.37287 15.8759 7.47654 16.2045 7.70714 16.435C7.93773 16.6656 8.26628 16.7693 8.58746 16.7128L12.0195 16.1092C12.2218 16.0736 12.4082 15.9766 12.5534 15.8314L19.0209 9.36396L19.728 8.65687L21.1422 7.24264C21.9232 6.46159 21.9232 5.19526 21.1422 4.41421ZM19.0209 6.53554L19.728 5.82843L18.3138 4.41421L17.6066 5.12132L19.0209 6.53554ZM17.6066 7.94977L16.1924 6.53555L9.9481 12.7799L9.64628 14.4959L11.3623 14.1941L17.6066 7.94977ZM2 5C2 4.44771 2.44772 4 3 4H10C10.5523 4 11 4.44771 11 5C11 5.55228 10.5523 6 10 6H4V20H18V14C18 13.4477 18.4477 13 19 13C19.5523 13 20 13.4477 20 14V21C20 21.5523 19.5523 22 19 22H3C2.44772 22 2 21.5523 2 21V5Z",fill:"currentColor"}))},"edit_2_stroked");t.Z=a},43402:function(e,t,r){"use strict";var n=r(2265),i=r(88046);let a=(0,i.A)(function(e){return n.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23ZM18.9988 11.8778C19.0132 12.7061 18.3535 13.3893 17.5252 13.4038L13.5258 13.4736L13.5956 17.473C13.61 18.3013 12.9503 18.9845 12.122 18.9989C11.2937 19.0134 10.6105 18.3537 10.596 17.5254L10.5262 13.526L6.52684 13.5958C5.69854 13.6102 5.01535 12.9505 5.00089 12.1222C4.98644 11.2939 5.64619 10.6107 6.47449 10.5962L10.4739 10.5264L10.4041 6.52703C10.3896 5.69873 11.0494 5.01553 11.8777 5.00108C12.706 4.98662 13.3892 5.64637 13.4036 6.47467L13.4734 10.4741L17.4728 10.4043C18.3011 10.3898 18.9843 11.0495 18.9988 11.8778Z",fill:"currentColor"}))},"plus_circle");t.Z=a},74313:function(e,t,r){"use strict";var n=r(2265),i=r(88046);let a=(0,i.A)(function(e){return n.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 2C2.89543 2 2 2.89543 2 4V20C2 21.1046 2.89543 22 4 22H11C11.5523 22 12 21.5523 12 21C12 20.4477 11.5523 20 11 20H4V4L20 4V14C20 14.5523 20.4477 15 21 15C21.5523 15 22 14.5523 22 14V4C22 2.89543 21.1046 2 20 2H4ZM9.49614 7.13176C9.18664 6.9549 8.80639 6.95617 8.49807 7.13509C8.18976 7.31401 8 7.64353 8 8V16C8 16.3565 8.18976 16.686 8.49807 16.8649C8.80639 17.0438 9.18664 17.0451 9.49614 16.8682L16.4961 12.8682C16.8077 12.6902 17 12.3589 17 12C17 11.6411 16.8077 11.3098 16.4961 11.1318L9.49614 7.13176ZM13.9844 12L10 14.2768V9.72318L13.9844 12ZM14.5 17C14.2239 17 14 17.2239 14 17.5V18.5C14 18.7761 14.2239 19 14.5 19H15.5C15.7761 19 16 18.7761 16 18.5V17.5C16 17.2239 15.7761 17 15.5 17H14.5ZM14.5 20C14.2239 20 14 20.2239 14 20.5V21.5C14 21.7761 14.2239 22 14.5 22H15.5C15.7761 22 16 21.7761 16 21.5V20.5C16 20.2239 15.7761 20 15.5 20H14.5ZM17 17.5C17 17.2239 17.2239 17 17.5 17H21.5C21.7761 17 22 17.2239 22 17.5V18.5C22 18.7761 21.7761 19 21.5 19H17.5C17.2239 19 17 18.7761 17 18.5V17.5ZM17.5 20C17.2239 20 17 20.2239 17 20.5V21.5C17 21.7761 17.2239 22 17.5 22H21.5C21.7761 22 22 21.7761 22 21.5V20.5C22 20.2239 21.7761 20 21.5 20H17.5Z",fill:"currentColor"}))},"video_list_stroked");t.Z=a},7812:function(e,t,r){Promise.resolve().then(r.bind(r,81856))},16869:function(e,t,r){"use strict";async function n(e,t){let{arg:r}=t;console.log(JSON.stringify(r));let n=await fetch(""+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!(n.status>=200&&n.status<300))throw Error(await n.text());let i=await n.json();if(!n.ok)throw Error(i.message);return i}r.d(t,{_i:function(){return i},gz:function(){return o},hw:function(){return l},sj:function(){return a},wG:function(){return n}});let i=async function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=await fetch(""+t[0],t[1]);if(!n.ok)throw Error(await n.text());return n.json()},a=async(e,t)=>{let r=await fetch(""+e,t);if(!r.ok)throw Error(await r.text());return r};async function l(e,t){let{arg:r}=t,n=await fetch("".concat("").concat(e,"/").concat(r),{method:"DELETE"});if(!n.ok)throw Error(await n.text());return n}async function o(e,t){let{arg:r}=t,n=await fetch("".concat("").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw Error(await n.text());return n}},65746:function(e,t,r){"use strict";r.d(t,{Bf:function(){return o},JB:function(){return s},ZP:function(){return l}});var n=r(30713),i=r(16869),a=r(2265);function l(){let{data:e,error:t,isLoading:r}=(0,n.ZP)("/v1/streamers",i._i);return{isLoading:r,streamers:e}}function o(){let{data:e,error:t,isLoading:r}=(0,n.ZP)("/v1/users",i._i),[l,o]=(0,a.useState)([]);return(0,a.useEffect)(()=>{(null==e?void 0:e.length)===0&&o([]),null==e||e.forEach(t=>{(async()=>{let r=await (0,i._i)("/bili/space/myinfo?user=".concat(t.value),void 0),n=await (0,i.sj)("/bili/proxy?url=".concat(r.data.face)),a=await n.blob(),l=e.map(e=>e.id===t.id?{...e,name:r.data.name,face:URL.createObjectURL(a)}:e);o(l)})()})},[e]),{isLoading:r,isError:t,biliUsers:l}}function s(){var e;let{data:t,error:r,isLoading:a}=(0,n.ZP)("/bili/archive/pre",i._i),l=null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.typelist.map(e=>({label:e.name,value:e.id,children:e.children}));return{isLoading:a,isError:r,typeTree:l}}},81856:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return C}});var n=r(57437),i=r(76842),a=r(74313),l=r(32718),o=r(43402),s=r(64724),c=r(92832),u=r(2265),d=r(65746),h=r(16869),g=r(30713),f=e=>{let{children:t,entity:r,onOk:a}=e,l="该项为必填项",o=(0,u.useRef)(),{data:s,error:c,isLoading:d}=(0,g.ZP)("/v1/upload/streamers",h._i),[f,m]=(0,u.useState)(!1),C=()=>{m(!0)},x=async()=>{var e;let t=await (null===(e=o.current)||void 0===e?void 0:e.validate());await a(t),m(!1)},p=u.Children.map(t,e=>{if(u.isValidElement(e))return u.cloneElement(e,{onClick:()=>{var t,r;C(),null===(t=(r=e.props).onClick)||void 0===t||t.call(r)}})}),w=null==s?void 0:s.map(e=>({value:e.id,label:e.template_name}));return(0,n.jsxs)(n.Fragment,{children:[p,(0,n.jsx)(i.u_,{title:"新建",visible:f,onOk:x,onCancel:()=>{m(!1)},bodyStyle:{overflow:"auto",maxHeight:"calc(100vh - 320px)",paddingLeft:10,paddingRight:10},children:(0,n.jsxs)(i.Form,{initValues:r,getFormApi:e=>o.current=e,children:[(0,n.jsx)(i.Form.Input,{field:"remark",label:"录播备注",trigger:"blur",rules:[{required:!0,message:l}]}),(0,n.jsx)(i.Form.Input,{field:"url",label:"直播链接",trigger:"blur",rules:[{required:!0,message:l}]}),(0,n.jsx)(i.Form.Input,{field:"filename_prefix",label:{text:"文件名模板",optional:!0},placeholder:"{streamer}%Y-%m-%d %H_%M_%S{title}"}),(0,n.jsx)(i.Form.Select,{showClear:!0,field:"upload_id",label:{text:"投稿模板",optional:!0},style:{width:176},optionList:w})]})})]})},m=r(33068);function C(){let{Header:e,Content:t}=i.Layout,{Text}=i.Typography,{streamers:r,isLoading:u}=(0,d.ZP)(),{trigger:g}=(0,m.Z)("/v1/streamers",h.hw),{trigger:C}=(0,m.Z)("/v1/streamers",h.gz),{trigger:x}=(0,m.Z)("/v1/streamers",h.wG),p=async e=>{await g(e)},w=null==r?void 0:r.map(e=>{let t;switch(e.status){case"Working":t=(0,n.jsx)(i.Vp,{color:"red",children:"直播中"});break;case"Idle":t=(0,n.jsx)(i.Vp,{color:"green",children:"空闲"});break;case"Pending":t=(0,n.jsx)(i.Vp,{color:"grey",children:"未知"});break;case"Inspecting":t=(0,n.jsx)(i.Vp,{color:"indigo",children:"检测中"})}return{...e,status:t}}),v=async e=>{try{await x(e)}catch(e){throw i.P_.error({title:"创建失败",content:(0,n.jsx)(i.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}}),e}},y=async e=>{console.log(e),delete e.status;try{await C(e)}catch(e){throw i.P_.error({title:"更新失败",content:(0,n.jsx)(i.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}}),e}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e,{style:{backgroundColor:"var(--semi-color-bg-1)"},children:(0,n.jsx)(i.JL,{header:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{backgroundColor:"rgba(var(--semi-green-4), 1)",borderRadius:"var(--semi-border-radius-large)",color:"var(--semi-color-bg-0)",display:"flex",padding:"6px"},children:(0,n.jsx)(a.Z,{size:"large"})}),(0,n.jsx)("h4",{style:{marginLeft:"12px"},children:"录播管理"})]}),mode:"horizontal",footer:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.zx,{theme:"borderless",icon:(0,n.jsx)(l.Z,{size:"large"}),style:{color:"var(--semi-color-text-2)",marginRight:"12px"}}),(0,n.jsx)(f,{onOk:v,children:(0,n.jsx)(i.zx,{icon:(0,n.jsx)(o.Z,{}),theme:"solid",style:{marginRight:10},children:"新建"})})]})})}),(0,n.jsx)(t,{style:{padding:"24px",backgroundColor:"var(--semi-color-bg-0)"},children:(0,n.jsx)("main",{children:(0,n.jsx)(i.aV,{grid:{gutter:12,xs:24,sm:24,md:12,lg:8,xl:6,xxl:4},dataSource:w,renderItem:e=>(0,n.jsx)(i.aV.Item,{style:{border:"1px solid var(--semi-color-border)",backgroundColor:"var(--semi-color-bg-2)",borderRadius:"3px",paddingLeft:"20px",paddingRight:"20px",margin:"8px 2px",minWidth:292,maxWidth:310},children:(0,n.jsxs)("div",{style:{flexGrow:1,maxWidth:250},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,n.jsx)("h3",{style:{color:"var(--semi-color-text-0)",fontWeight:500},children:e.remark}),e.status]}),(0,n.jsx)(Text,{ellipsis:{showTooltip:{opts:{style:{wordBreak:"break-all"}}}},type:"tertiary",children:e.url}),(0,n.jsx)("div",{style:{margin:"10px 0",display:"flex",justifyContent:"flex-end"},children:(0,n.jsxs)(i.hE,{theme:"borderless",children:[(0,n.jsx)(f,{onOk:y,entity:e,children:(0,n.jsx)(i.zx,{theme:"borderless",icon:(0,n.jsx)(s.Z,{})})}),(0,n.jsx)("span",{className:"semi-button-group-line semi-button-group-line-borderless semi-button-group-line-primary"}),(0,n.jsx)(i.gn,{title:"确定是否要删除？",content:"此操作将不可逆",onConfirm:async()=>await p(e.id),children:(0,n.jsx)(i.zx,{theme:"borderless",icon:(0,n.jsx)(c.Z,{})})})]})})]})})})})})]})}},33068:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(2265),i=r(30713),a=r(44796);let l=a.w6?e=>{e()}:n.startTransition,o=e=>{let[,t]=(0,n.useState)({}),r=(0,n.useRef)(!1),i=(0,n.useRef)(e),l=(0,n.useRef)({data:!1,error:!1,isValidating:!1}),o=(0,n.useCallback)(e=>{let n=!1,a=i.current;for(let t in e)a[t]!==e[t]&&(a[t]=e[t],l.current[t]&&(n=!0));n&&!r.current&&t({})},[]);return(0,a.LI)(()=>(r.current=!1,()=>{r.current=!0})),[i,l.current,o]},s=(0,a.xD)(i.ZP,()=>(e,t,r={})=>{let{mutate:s}=(0,i.kY)(),c=(0,n.useRef)(e),u=(0,n.useRef)(t),d=(0,n.useRef)(r),h=(0,n.useRef)(0),[g,f,m]=o({data:a.i_,error:a.i_,isMutating:!1}),C=g.current,x=(0,n.useCallback)(async(e,t)=>{var r,n;let[i,o]=(0,a.qC)(c.current);if(!u.current)throw Error("Can’t trigger the mutation: missing fetcher.");if(!i)throw Error("Can’t trigger the mutation: missing key.");let g=(0,a.PM)((0,a.PM)({populateCache:!1,throwOnError:!0},d.current),t),f=(0,a.u3)();h.current=f,m({isMutating:!0});try{let t=await s(i,u.current(o,{arg:e}),(0,a.PM)(g,{throwOnError:!0}));return h.current<=f&&(l(()=>m({data:t,isMutating:!1,error:void 0})),null==(r=g.onSuccess)||r.call(g,t,i,g)),t}catch(e){if(h.current<=f&&(l(()=>m({error:e,isMutating:!1})),null==(n=g.onError)||n.call(g,e,i,g),g.throwOnError))throw e}},[]),p=(0,n.useCallback)(()=>{h.current=(0,a.u3)(),m({data:a.i_,error:a.i_,isMutating:!1})},[]);return(0,a.LI)(()=>{c.current=e,u.current=t,d.current=r}),{trigger:x,reset:p,get data(){return f.data=!0,C.data},get error(){return f.error=!0,C.error},get isMutating(){return f.isMutating=!0,C.isMutating}}})}},function(e){e.O(0,[368,713,971,472,744],function(){return e(e.s=7812)}),_N_E=e.O()}]);