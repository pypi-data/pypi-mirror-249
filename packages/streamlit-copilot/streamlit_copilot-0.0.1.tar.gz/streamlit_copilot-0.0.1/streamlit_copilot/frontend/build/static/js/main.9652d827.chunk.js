(this.webpackJsonpstreamlit_copilot=this.webpackJsonpstreamlit_copilot||[]).push([[0],{12:function(t,e,s){"use strict";s.r(e);var r=s(0),o=s.n(r),i=s(3),n=s.n(i),a=s(1);class l extends a.b{constructor(){super(...arguments),this.userTextarea=null,this.suggestionTextarea=null,this.state={text:"",suggestion:"",isFocused:!1,textAreaIsFocused:!1,requestsThisMinute:0,currentMinute:Math.floor(Date.now()/6e4)},this.render=()=>{const{theme:t}=this.props;if(!t)return o.a.createElement("div",null,"Theme is undefined, please check streamlit version.");const e=this.props.args.height,s=t.font,r=e+"px",i="1px solid "+t.primaryColor,n="1px solid "+t.secondaryBackgroundColor;return o.a.createElement("div",{tabIndex:0,style:{height:r,width:"auto",border:this.state.isFocused?i:n,borderRadius:"0.5em",overflowY:"scroll",overflowX:"hidden",position:"relative",backgroundColor:t.secondaryBackgroundColor},onFocus:this._onFocus,onBlur:this._onBlur},o.a.createElement("textarea",{style:{marginLeft:"0.5em",fontFamily:s,marginTop:"0.2em",whiteSpace:"pre-wrap",width:"calc(100% - 1.2em)",height:"100%",border:"none",outline:"none",position:"absolute",backgroundColor:"transparent",color:"light"===t.base?"rgba(41,51,62,0.5)":"rgba(255,255,255,0.5)",padding:"0"},value:this.state.suggestion,readOnly:!0,ref:t=>{this.suggestionTextarea=t}}),o.a.createElement("textarea",{style:{marginLeft:"0.5em",fontFamily:s,marginTop:"0.2em",whiteSpace:"pre-wrap",width:"calc(100% - 1.2em)",height:"100%",border:"none",outline:"none",position:"absolute",backgroundColor:"transparent",color:t.textColor,padding:"0"},value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this._onTextAreaBlur,onScroll:this.onScroll,ref:t=>{this.userTextarea=t}}))},this.onScroll=()=>{this.forceUpdate()},this.onChange=t=>{const e=t.target.value,s=this.props.args.api_url;this.setState({text:e,suggestion:""},()=>{""!==e.trim()&&this.callApi(e,s).then(t=>{""!==this.state.text.trim()&&this.setState({suggestion:this.state.text+t})})})},this.onKeyDown=t=>{"Enter"===t.key&&(t.preventDefault(),this.setState(t=>({text:t.suggestion,suggestion:""}),()=>{const t={target:{value:this.state.text}};this.onChange(t)}))},this._onTextAreaBlur=()=>{this.setState({textAreaIsFocused:!1},()=>{a.a.setComponentValue(this.state.text),this.setState({suggestion:""})})},this._onFocus=()=>{this.setState({isFocused:!0})},this._onBlur=()=>{this.setState({isFocused:!1})},this.abortController=new AbortController,this.callApi=async(t,e)=>{if(this.abortController.abort(),this.abortController=new AbortController,""===t.trim())return"";const s=Math.floor(Date.now()/6e4);if(s>this.state.currentMinute)this.setState({currentMinute:s,requestsThisMinute:0});else if(this.state.requestsThisMinute>this.props.args.rpm_limit)return new Promise(s=>{setTimeout(()=>{s(this.callApi(t,e))},1e3)});const{prompt_template:r,api_url:o,height:i,fontFamily:n,border:a,...l}=this.props.args,h={prompt:r.replace("{text}",t),...l,echo:!1},u={"Content-Type":"application/json"};try{const t=await fetch(e,{method:"POST",headers:u,body:JSON.stringify(h),signal:this.abortController.signal});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));this.setState(t=>({requestsThisMinute:t.requestsThisMinute+1}));return(await t.json()).choices[0].text}catch(c){return"AbortError"===c.name||console.error("Error decoding response",c),""}}}componentDidUpdate(){this.userTextarea&&this.suggestionTextarea&&(this.suggestionTextarea.scrollTop=this.userTextarea.scrollTop)}}var h=Object(a.c)(l);n.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(h,null)),document.getElementById("root"))},5:function(t,e,s){t.exports=s(12)}},[[5,1,2]]]);
//# sourceMappingURL=main.9652d827.chunk.js.map