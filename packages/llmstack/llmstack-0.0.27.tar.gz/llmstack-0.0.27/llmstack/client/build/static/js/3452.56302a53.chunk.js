"use strict";(self.webpackChunkpromptmanager=self.webpackChunkpromptmanager||[]).push([[3452],{61088:function(e,t,n){n.d(t,{P:function(){return a},_:function(){return s}});var o=n(93433),i=n(29439),r=n(1413);function l(e,t){if(e.match(/^data:(.*);name=(.*);base64,(.*)/i)&&t.match(/^data:(.*);name=(.*);base64,(.*)/i)){var n=e.split(",")[1],o=t.split(",")[1],i=atob(n),r=atob(o),l=btoa(i+r);return e.split(",")[0]+","+e.split(",")[1]+","+l}return e+t}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!e)return[t,s];if(!t)return[e,s];for(var u=(0,r.Z)({},e),d=0,c=Object.entries(t);d<c.length;d++){var p=(0,i.Z)(c[d],2),v=p[0],f=p[1];if(u[v])if(Array.isArray(f))if(Array.isArray(u[v]))for(var g=0;g<f.length;g++)if(g<u[v].length){if("string"===typeof f[g]){u[v][g]=l(u[v][g],f[g]),f[g].match(/^data:(.*);name=(.*);base64,(.*)/i)&&u["_".concat(v,"_base64_chunks")][g].push(f[g].split(",")[1]),s.includes("".concat(n,"_").concat(v,"_base64_chunks[").concat(g,"]"))||s.push("".concat(n,"_").concat(v,"_base64_chunks[").concat(g,"]"));continue}if("number"===typeof f[g]){u[v][g]=f[g];continue}var m=a(u[v][g],f[g],"".concat(n,"_").concat(v,"[").concat(g,"]"),s),h=(0,i.Z)(m,2);u[v][g]=h[0],s=h[1]}else u[v].push(f[g]);else u[v]=u[v]+f;else if("object"===typeof f){var x=a(u[v],f,"".concat(v,"."),s),b=(0,i.Z)(x,2);u[v]=b[0],s=b[1]}else"string"===typeof f?(u[v]=l(u[v],f),f.match(/^data:(.*);name=(.*);base64,(.*)/i)&&(u["_".concat(v,"_base64_chunks")]||(u["_".concat(v,"_base64_chunks")]=[u[v].split(",")[1]]),u["_".concat(v,"_base64_chunks")]=[].concat((0,o.Z)(u["_".concat(v,"_base64_chunks")]),[f.split(",")[1]]),s.includes("".concat(n,"_").concat(v,"_base64_chunks"))||s.push("".concat(n,"_").concat(v,"_base64_chunks")))):u[v]=u[v]+f;else u[v]=f,"string"===typeof f&&f.match(/^data:(.*);name=(.*);base64,(.*)/i)&&(u["_".concat(v,"_base64_chunks")]=[f.split(",")[1]],s.includes("_".concat(v,"_base64_chunks"))||s.push("".concat(n,"_").concat(v,"_base64_chunks")))}return[u,s]}function s(e){var t={type:"object",properties:{}},n={},o=[],i=[];return e&&e.forEach((function(e){var r,l;(o.push(e.name),e.required&&i.push(e.name),t.properties[e.name]={type:"text"===e.type||"voice"===e.type||"file"===e.type||"select"===e.type?"string":e.type,title:e.title,description:e.description},e.default&&(t.properties[e.name].default=e.default),"text"===e.type&&(n[e.name]={"ui:widget":"textarea"}),"boolean"===e.type&&(n[e.name]={"ui:widget":"radio"}),"file"===e.type&&(n[e.name]={"ui:widget":"file"},t.properties[e.name].format="data-url",t.properties[e.name].pattern="data:(.*);name=(.*);base64,(.*)"),"voice"===e.type&&(n[e.name]={"ui:widget":"voice"},t.properties[e.name].format="data-url",t.properties[e.name].pattern="data:(.*);name=(.*);base64,(.*)"),"select"===e.type)&&(n[e.name]={"ui:widget":"select"},t.properties[e.name].enum=null===(r=e.options)||void 0===r?void 0:r.map((function(e){return e.value})),t.properties[e.name].enumNames=null===(l=e.options)||void 0===l?void 0:l.map((function(e){return e.label})))})),n["ui:order"]=o,n["ui:required"]=i,{schema:t,uiSchema:n}}},28592:function(e,t,n){n.d(t,{Ws:function(){return r}});var o=n(15671),i=n(43144),r=function(){function e(t){(0,o.Z)(this,e),this.url=t,this.ws=null,this.onMessage=null,this.queue=[]}return(0,i.Z)(e,[{key:"status",value:function(){return this.ws.readyState}},{key:"connect",value:function(){var e=this;this.ws=new WebSocket(this.url),this.ws.onmessage=this.onMessage,this.ws.onopen=function(){e.queue.forEach((function(t){e.ws.send(t)})),e.queue=[]},this.ws.onclose=function(){console.log("Websocket closed")}}},{key:"send",value:function(e){null===this.ws&&this.connect(),this.ws.readyState===WebSocket.CONNECTING?this.queue.push(e):this.ws.readyState===WebSocket.OPEN?this.ws.send(e):(this.queue.push(e),this.connect())}},{key:"close",value:function(){this.ws.close()}},{key:"setOnMessage",value:function(e){this.onMessage=e}}]),e}()},67337:function(e,t,n){n.d(t,{P:function(){return F}});var o=n(93433),i=n(37762),r=n(4942),l=n(29439),a=n(1413),s=n(71233),u=n(89499),d=n(64991),c=n(92886),p=n(94766),v=n(62848),f=n(44258),g=n(45734),m=n(98083),h=n(23526),x=n(45234),b=n(35969),_=n(57707),y=n(23005),Z=n(24464),j=n(35680),w=n(22423),S=(n(61768),n(18282)),k=n(20076),O=n(64350),A=n(19409),M=n(52115),P=n(86003),C=n(61088),T=n(44550),E=n(72369),N=n(29391),R=n(37881);function B(e){return(0,R.jsx)(A.Z,(0,a.Z)({},e))}function I(e){return(0,R.jsx)(M.Z,(0,a.Z)({},e))}var z=s.memo((function(e){var t=e.messageId,n=e.step,o=e.app;if(!n)return null;var i=function(e,t){var n,o,i=null===e||void 0===e||null===(n=e.data)||void 0===n||null===(o=n.processors)||void 0===o?void 0:o.find((function(e){return e.id===t}));return{icon:(0,R.jsx)(P.L,{provider_slug:null===i||void 0===i?void 0:i.provider_slug,style:{width:"15px",height:"15px"}}),name:(null===i||void 0===i?void 0:i.name)||(null===i||void 0===i?void 0:i.processor_slug)}}(o,n.name);return(0,R.jsxs)(d.Z,{direction:"column",gap:1,children:[(0,R.jsxs)(c.Z,{className:"chat_message_from_bot chat_message_type_step",children:["Using\xa0\xa0",i.icon,"\xa0",(0,R.jsx)("i",{children:i.name}),!n.content&&(0,R.jsxs)("div",{className:"chat_message_from_bot typing-indicator",children:[(0,R.jsx)("span",{}),(0,R.jsx)("span",{}),(0,R.jsx)("span",{})]})]}),(0,R.jsx)(p.Z,{variant:"caption",sx:{textAlign:"left",fontSize:"0.8rem"},children:"Input"}),n.arguments&&(0,R.jsx)(w.ZP,{mode:"json",theme:"dracula",value:n.arguments,editorProps:{$blockScrolling:!0},setOptions:{useWorker:!1,showGutter:!1,maxLines:1/0},style:{marginBottom:10,borderRadius:"5px",wordWrap:"break-word",maxWidth:"75%"}}),(0,R.jsx)(p.Z,{variant:"caption",sx:{textAlign:"left",fontSize:"0.8rem"},children:"Output"}),(0,R.jsx)(N.Z,{className:"chat_message_type_step_output",messageId:t,children:n.content})]})})),W=function(e){var t=e.message,n=e.app;try{return"bot"===t.role?t.content:1===Object.keys(t.content).length?Object.keys(t.content).map((function(e){return t.content[e]})).join("\n\n"):Object.keys(t.content).map((function(e){var o,i,r=null===n||void 0===n||null===(o=n.data)||void 0===o||null===(i=o.input_fields)||void 0===i?void 0:i.find((function(t){return t.name===e}));return"**".concat(e,"**: ").concat(!r||"file"!==r.type&&"voice"!==r.type&&"image"!==r.type?t.content[e]:t.content[e].split(",")[0].split(";")[1].split("=")[1])})).join("\n\n")}catch(o){return""}},D=s.memo((function(e){var t,n,o,i,r=e.message,l=e.index,a=e.app,s=e.onInMessageFormSubmit;return(0,R.jsxs)("div",{style:"bot"===r.role?{display:"flex",textAlign:"left",fontSize:16,padding:3}:{textAlign:"right"},children:["bot"===r.role&&(null===a||void 0===a||null===(t=a.data)||void 0===t||null===(n=t.config)||void 0===n?void 0:n.assistant_image)&&(0,R.jsx)(v.Z,{src:null===(o=a.data)||void 0===o||null===(i=o.config)||void 0===i?void 0:i.assistant_image,alt:"Bot",style:{margin:"".concat("step"===(null===r||void 0===r?void 0:r.type)?"0px 8px 16px 0px":"16px 8px 16px 0px")}}),"bot"===r.role&&r.content.length<=1&&(0,R.jsxs)("div",{className:"chat_message_from_bot typing-indicator",children:[(0,R.jsx)("span",{}),(0,R.jsx)("span",{}),(0,R.jsx)("span",{})]}),"bot"===r.role&&"step"===r.type&&(0,R.jsx)(z,{messageId:r.id,step:r.content,app:a}),"step"!==r.type&&(0,R.jsx)(N.Z,{className:"chat_message_from_".concat(r.role," ").concat(r.error?"error":""," chat_message_type_").concat(r.type),onFormSubmit:s,children:W({message:r,app:a})})]},l)}),(function(e,t){var n,o,i,r,l,a,s,u,d,c,p,v;return"step"===(null===(n=e.message)||void 0===n?void 0:n.type)&&"object"===typeof(null===(o=e.message)||void 0===o?void 0:o.content)?(null===(i=e.message)||void 0===i?void 0:i.rendered_content)===(null===(r=t.message)||void 0===r?void 0:r.rendered_content)&&(null===(l=e.message)||void 0===l||null===(a=l.content)||void 0===a?void 0:a.name)===(null===(s=t.message)||void 0===s||null===(u=s.content)||void 0===u?void 0:u.name)&&(null===(d=e.message)||void 0===d||null===(c=d.content)||void 0===c?void 0:c.arguments)===(null===(p=t.message)||void 0===p||null===(v=p.content)||void 0===v?void 0:v.arguments):e.message.content===t.message.content}));function F(e){var t,n,c,w,A,M,P,N,z,W,F,L,H,U,J,q,K,G,$,V,X,Y,Q,ee,te,ne,oe=e.app,ie=e.isMobile,re=e.embed,le=void 0!==re&&re,ae=e.ws,se=(0,C._)(null===oe||void 0===oe||null===(t=oe.data)||void 0===t?void 0:t.input_fields),ue=se.schema,de=se.uiSchema,ce=(0,s.useState)({}),pe=(0,l.Z)(ce,2),ve=pe[0],fe=pe[1],ge=(0,s.useState)(null),me=(0,l.Z)(ge,2),he=me[0],xe=me[1],be=(0,s.useState)([]),_e=(0,l.Z)(be,2),ye=_e[0],Ze=_e[1],je=(0,s.useState)(null),we=(0,l.Z)(je,2),Se=we[0],ke=we[1],Oe=(0,s.useState)(!le),Ae=(0,l.Z)(Oe,2),Me=Ae[0],Pe=Ae[1],Ce=(0,s.useState)({backgroundColor:(null===oe||void 0===oe||null===(n=oe.data)||void 0===n||null===(c=n.config)||void 0===c?void 0:c.window_color)||"#0f477e",color:"white",position:"fixed",right:16,bottom:16}),Te=(0,l.Z)(Ce,2),Ee=Te[0],Ne=Te[1],Re=(0,S.Zl)(O.TC),Be=new b.Kj,Ie=(0,s.useRef)({}),ze=(0,s.useRef)({}),We=(0,s.useRef)([]),De=(0,s.useRef)(null),Fe=(0,h.Z)({components:{MuiInputBase:{defaultProps:{autoComplete:"off"}},MuiTextField:{defaultProps:{variant:"outlined"},styleOverrides:{root:{"& .MuiOutlinedInput-root":{"& > fieldset":{border:"1px solid ".concat((null===oe||void 0===oe||null===(w=oe.data)||void 0===w?void 0:w.config.window_color)||"#ccc")},"&.Mui-focused > fieldset":{border:"1px solid #0f477e"},"&:hover > fieldset":{border:"1px solid #0f477e"},"&.Mui-error > fieldset":{border:"1px solid #fcc"}}}}},MuiTypography:{styleOverrides:{caption:{fontSize:"0.7rem",marginLeft:2,color:"#666"}}},MuiButtonBase:{styleOverrides:{root:{"&.MuiButton-contained":{textTransform:"none"}}}}}});(0,s.useEffect)((function(){if(le)if(document.body.style="background: transparent",document.getElementsByClassName("root").style="background: transparent",Me){var e=navigator.userAgent||navigator.vendor||window.opera,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),n=t?"100%":"400px",o=t?"90vh":"700px";window.parent.postMessage({width:n,height:o,type:"promptly-embed-open"},"*")}else setTimeout((function(){var e,t;window.parent.postMessage({type:"promptly-embed-resize",width:(null===De||void 0===De||null===(e=De.current)||void 0===e?void 0:e.clientWidth)||"auto",height:(null===De||void 0===De||null===(t=De.current)||void 0===t?void 0:t.clientHeight)||"auto"},"*")}),500),window.parent.postMessage({type:"promptly-embed-close"},"*")}),[le,Me]),(0,s.useEffect)((function(){var e,t,n,o,i,r,l,s;null!==oe&&void 0!==oe&&null!==(e=oe.data)&&void 0!==e&&null!==(t=e.config)&&void 0!==t&&t.welcome_message&&0===ye.length&&Ze([{role:"bot",content:null===(l=oe.data)||void 0===l||null===(s=l.config)||void 0===s?void 0:s.welcome_message}]);if(null!==oe&&void 0!==oe&&null!==(n=oe.data)&&void 0!==n&&null!==(o=n.config)&&void 0!==o&&o.chat_bubble_text&&null!==oe&&void 0!==oe&&null!==(i=oe.data)&&void 0!==i&&null!==(r=i.config)&&void 0!==r&&r.chat_bubble_style&&0===ye.length)try{var u,d,c=JSON.parse(null===oe||void 0===oe||null===(u=oe.data)||void 0===u||null===(d=u.config)||void 0===d?void 0:d.chat_bubble_style);Ne((function(e){return(0,a.Z)((0,a.Z)({},e),c)}))}catch(p){console.error(p)}}),[oe,ye.length]),ae&&ae.setOnMessage((function(e){var t=null,n=JSON.parse(e.data);if(n.templates){var s={};Object.keys(n.templates).forEach((function(e){s[e]=Be.parse(n.templates[e].markdown)})),Ie.current=(0,a.Z)((0,a.Z)({},Ie.current),s)}if(n.output){var u={},d=[];if(n.output.agent){var c=(0,C.P)(ze.current,(0,r.Z)({},n.output.agent.id,n.output.agent.content)),p=(0,l.Z)(c,2);u=p[0],d=(d=p[1]).map((function(e){return"".concat(n.output.agent.id,".").concat(e)}))}else{var v=(0,C.P)(ze.current,n.output),f=(0,l.Z)(v,2);u=f[0],d=f[1]}ze.current=u;var g,m=(0,i.Z)(d);try{var h=function(){var e=g.value;Re((function(t){return(0,a.Z)((0,a.Z)({},t),{},(0,r.Z)({},e.replace(/_base64_chunks$/g,""),(0,k.get)(ze.current,e,null)))}))};for(m.s();!(g=m.n()).done;)h()}catch(M){m.e(M)}finally{m.f()}}if(!n.event||"done"!==n.event)if(n.session){var x;xe(null===(x=n.session)||void 0===x?void 0:x.id)}else{if(n.errors&&n.errors.length>0){var b,_,y,Z,j=We.current.length,w=We.current[j-1],S=null;return S=j>0&&("ui_placeholder"===w.type||w.id===(null===(b=n.output)||void 0===b||null===(_=b.agent)||void 0===_?void 0:_.id))?(0,o.Z)(We.current.slice(0,-1)):(0,o.Z)(We.current),We.current=[].concat((0,o.Z)(S),[{role:"bot",content:n.errors.join("\n\n"),type:"error",error:!0,id:null===(y=n.output)||void 0===y||null===(Z=y.agent)||void 0===Z?void 0:Z.id}]),void Ze(We.current)}var O,A;if(n.output.agent&&n.output.agent.id&&n.output.agent.from_id&&Ie.current[n.output.agent.from_id])Be.render(Ie.current[n.output.agent.from_id],"agent"===n.output.agent.from_id?(0,r.Z)({},n.output.agent.from_id,{content:ze.current[n.output.agent.id]}):"string"===typeof(null===(O=ze.current[n.output.agent.id])||void 0===O?void 0:O.output)?ze.current[n.output.agent.id]:null===(A=ze.current[n.output.agent.id])||void 0===A?void 0:A.output).then((function(e){""===e.trim()&&null===t&&(t="No response from AI. Please try again.");var i=We.current.length,r=We.current[i-1],l=null;l=i>0&&("ui_placeholder"===r.type||r.id===n.output.agent.id)?(0,o.Z)(We.current.slice(0,-1)):(0,o.Z)(We.current),We.current=[].concat((0,o.Z)(l),[{role:"bot",content:"step_error"===n.output.agent.type?n.output.agent.content:"step"===n.output.agent.type?(0,a.Z)((0,a.Z)({},ze.current[n.output.agent.id]),{content:e}):e,error:"step_error"===n.output.agent.type,type:n.output.agent.type||"output",id:n.output.agent.id,from_id:n.output.agent.from_id,rendered_content:e}]),Ze(We.current)})).catch((function(e){console.error(e)}))}}));var Le=function(e){ke(null),Ze([].concat((0,o.Z)(ye),[{role:"user",content:e}])),ze.current={},We.current=[].concat((0,o.Z)(ye),[{role:"user",content:e},{role:"bot",content:"",type:"ui_placeholder"}]),ae.send(JSON.stringify({event:"run",input:e,session_id:he})),u.ZP.event({category:"App",action:"Run Agent",label:null===oe||void 0===oe?void 0:oe.name,transport:"beacon"})};return(0,s.useEffect)((function(){var e=document.getElementById("messages");e.scrollTop=e.scrollHeight}),[ye]),(0,R.jsxs)(R.Fragment,{children:[le&&(0,R.jsx)(f.Z,{style:Ee,onClick:function(){return Pe(!Me)},variant:null!==oe&&void 0!==oe&&null!==(A=oe.data)&&void 0!==A&&null!==(M=A.config)&&void 0!==M&&M.chat_bubble_text?"extended":"circular",ref:De,children:Me?(0,R.jsx)(Z.Z,{}):null!==oe&&void 0!==oe&&null!==(P=oe.data)&&void 0!==P&&null!==(N=P.config)&&void 0!==N&&N.chat_bubble_text?(0,R.jsx)("span",{children:null===oe||void 0===oe||null===(z=oe.data)||void 0===z||null===(W=z.config)||void 0===W?void 0:W.chat_bubble_text}):(0,R.jsx)(j.Z,{})}),(0,R.jsxs)("div",{className:"agent-chat-container ".concat(le?"embedded":""," ").concat(Me?"agent-maximized":"minimized"),style:{width:ie?"90%":"100%"},children:[le&&(0,R.jsxs)("div",{style:{display:"flex",backgroundColor:(null===oe||void 0===oe||null===(F=oe.data)||void 0===F?void 0:F.config.window_color)||"#0f477e",borderRadius:"8px 8px 0px 0px"},children:[(null===oe||void 0===oe||null===(L=oe.data)||void 0===L||null===(H=L.config)||void 0===H?void 0:H.assistant_image)&&(0,R.jsx)(v.Z,{src:null===(U=oe.data)||void 0===U||null===(J=U.config)||void 0===J?void 0:J.assistant_image,alt:"Bot",style:{margin:"10px 8px",border:"solid 1px #ccc"}}),(0,R.jsx)("span",{style:{margin:"auto 0px",fontWeight:600,fontSize:"18px",color:"white",padding:null!==oe&&void 0!==oe&&null!==(q=oe.data)&&void 0!==q&&null!==(K=q.config)&&void 0!==K&&K.assistant_image?"inherit":"16px"},children:null===oe||void 0===oe?void 0:oe.name})]}),(0,R.jsxs)(d.Z,{sx:{padding:"10px",overflow:"auto"},children:[(0,R.jsx)(T.b,{text:null===(G=oe.data)||void 0===G||null===($=G.config)||void 0===$||null===(V=$.input_template)||void 0===V?void 0:V.replaceAll("<a href","<a target='_blank' href")}),(0,R.jsxs)("div",{style:{marginTop:10,height:"70vh",overflow:"auto",display:"flex",flexDirection:"column",gap:10},id:"messages",children:[ye.map((function(e,t){return(0,R.jsx)(D,{message:e,index:t,app:oe,onInMessageFormSubmit:function(e){}},t)})),Se&&(0,R.jsx)(E.D1,{runError:Se}),0===ye.filter((function(e){return"user"===e.role})).length&&(null===oe||void 0===oe||null===(X=oe.data)||void 0===X||null===(Y=X.config)||void 0===Y?void 0:Y.suggested_messages)&&(null===oe||void 0===oe||null===(Q=oe.data)||void 0===Q||null===(ee=Q.config)||void 0===ee?void 0:ee.suggested_messages.length)>0&&(0,R.jsx)(g.ZP,{sx:{alignSelf:"flex-end",textAlign:"right",marginTop:"auto"},children:null===oe||void 0===oe||null===(te=oe.data)||void 0===te||null===(ne=te.config)||void 0===ne?void 0:ne.suggested_messages.map((function(e,t){return(0,R.jsx)(m.Z,{label:e,sx:{margin:"5px 2px"},onClick:function(){var t,n,o;return(null===oe||void 0===oe||null===(t=oe.data)||void 0===t||null===(n=t.input_fields)||void 0===n?void 0:n.length)>0&&Le((0,r.Z)({},null===oe||void 0===oe||null===(o=oe.data)||void 0===o?void 0:o.input_fields[0].name,e))}},t)}))})]}),(0,R.jsx)(x.Z,{theme:Fe,children:(0,R.jsx)(y.ZP,{formData:ve,schema:ue,uiSchema:(0,a.Z)((0,a.Z)({},de),{},{"ui:submitButtonOptions":{norender:Object.keys(null===ue||void 0===ue?void 0:ue.properties).length<=1&&0===Object.keys(de).map((function(e){var t;return null===(t=de[e])||void 0===t?void 0:t["ui:widget"]})).filter((function(e){return"voice"===e})).length}}),validator:_.ZP,onSubmit:function(e){var t=e.formData;Object.keys(null===ue||void 0===ue?void 0:ue.properties).length>1&&fe(t),Le(t),Ze(We.current)},widgets:{FileWidget:B,voice:I}})}),le&&(0,R.jsxs)(p.Z,{sx:{textAlign:"center"},variant:"caption",children:["Powered by"," ",(0,R.jsx)("a",{href:"https://trypromptly.com",target:"_blank",rel:"noreferrer",children:"Promptly"})]})]})]})]})}},74523:function(e,t,n){n.d(t,{F:function(){return P}});var o=n(4942),i=n(37762),r=n(29439),l=n(1413),a=n(71233),s=n(89499),u=n(62326),d=n(52087),c=n(94766),p=n(45734),v=n(86897),f=n(61088),g=n(19409),m=n(72369),h=n(29391),x=n(44550),b=n(23005),_=n(18282),y=n(20076),Z=n(64350),j=n(57707),w=n(35969),S=(n(36596),n(52115)),k=n(63952),O=n(37881);function A(e){return(0,O.jsx)(g.Z,(0,l.Z)({},e))}function M(e){return(0,O.jsx)(S.Z,(0,l.Z)({},e))}function P(e){var t,n,g,S,P,C=e.app,T=e.ws,E=(0,a.useRef)(null),N=(0,f._)(null===C||void 0===C||null===(t=C.data)||void 0===t?void 0:t.input_fields),R=N.schema,B=N.uiSchema,I=(0,a.useState)(null),z=(0,r.Z)(I,2),W=z[0],D=z[1],F=(0,a.useState)(null),L=(0,r.Z)(F,2),H=L[0],U=L[1],J=(0,a.useState)(!1),q=(0,r.Z)(J,2),K=q[0],G=q[1],$=(0,a.useState)({}),V=(0,r.Z)($,2),X=V[0],Y=V[1],Q=(0,a.useState)(null),ee=(0,r.Z)(Q,2),te=ee[0],ne=ee[1],oe=new w.Kj,ie=oe.parse((null===C||void 0===C||null===(n=C.data)||void 0===n||null===(g=n.output_template)||void 0===g?void 0:g.markdown)||""),re=(0,_.Zl)(Z.TC),le=(0,a.useRef)({}),ae=(0,a.useRef)(!1);(0,a.useEffect)((function(){E.current&&window.scrollTo(0,E.current.scrollHeight)}),[H]);T&&T.setOnMessage((function(e){var t=JSON.parse(e.data);if(t.output){var n=(0,f.P)(le.current,t.output),a=(0,r.Z)(n,2),s=a[0],u=a[1];le.current=s;var d,c=(0,i.Z)(u);try{var p=function(){var e=d.value;re((function(t){return(0,l.Z)((0,l.Z)({},t),{},(0,o.Z)({},e.replace(/_base64_chunks$/g,""),(0,y.get)(le.current,e,null)))}))};for(c.s();!(d=c.n()).done;)p()}catch(v){c.e(v)}finally{c.f()}}ae.current||!t.session&&!t.errors||(ae.current=!0),t.session&&D(t.session.id),t.event&&"done"===t.event&&(ae.current=!1,G(!1)),t.errors&&t.errors.length>0&&(ne({errors:t.errors}),G(!1)),oe.render(ie,le.current).then((function(e){U(e)}))}));return(0,O.jsxs)("div",{style:{maxWidth:1200,margin:"0 auto",width:"100%",padding:"0 10px",textAlign:"left"},children:[(0,O.jsx)(x.b,{text:null===(S=C.data)||void 0===S||null===(P=S.config)||void 0===P?void 0:P.input_template}),(0,O.jsx)(b.ZP,{schema:R,uiSchema:(0,l.Z)((0,l.Z)({},B),{"ui:submitButtonOptions":{props:{disabled:K}}}),validator:j.ZP,formData:X,onSubmit:function(e){var t,n=e.formData;K?(T.send(JSON.stringify({event:"stop",session_id:W})),G(!1)):(Y(n),t=n,G(!0),ne(null),ae.current=!1,le.current={},T.send(JSON.stringify({event:"run",input:t,session_id:W})),G(!0),s.ZP.event({category:"App",action:"Run Web App",label:null===C||void 0===C?void 0:C.name,transport:"beacon"}))},templates:{ButtonTemplates:{SubmitButton:function(e){var t,n,o,i,r=(null===(t=e.uiSchema["ui:submitButtonOptions"])||void 0===t?void 0:t.submitText)||"Submit",a=(null===(n=e.uiSchema["ui:submitButtonOptions"])||void 0===n||null===(o=n.props)||void 0===o?void 0:o.style)||{};return null!==(i=e.uiSchema["ui:submitButtonOptions"])&&void 0!==i&&i.norender?null:(0,O.jsx)(u.Z,{size:"medium",variant:"contained",type:"submit",sx:(0,l.Z)((0,l.Z)({textTransform:"none"},a),{},{backgroundColor:K?"grey":"primary"}),children:K?"Cancel":r})}}},widgets:{FileWidget:A,voice:M}}),(0,O.jsxs)("div",{style:{marginTop:10},ref:E,children:[H&&(0,O.jsxs)(d.Z,{elevation:2,sx:{p:4},children:[(0,O.jsxs)(c.Z,{variant:"h6",sx:{marginBottom:2},className:"section-header",children:["Output",H&&!K&&(0,O.jsx)(u.Z,{startIcon:(0,O.jsx)(k.Z,{}),onClick:function(){return navigator.clipboard.writeText(H)},sx:{textTransform:"none",float:"right",margin:"auto"},children:"Copy"})]}),K&&!ae.current&&!te&&(0,O.jsx)(p.ZP,{sx:{margin:"auto",textAlign:"center"},children:(0,O.jsx)(v.Z,{})}),(0,O.jsx)(h.Z,{className:"webapp-output",children:H})]}),te&&(0,O.jsx)(m.D1,{runError:te})]})]})}},86067:function(e,t,n){n.d(t,{$:function(){return I}});var o=n(93433),i=n(4942),r=n(37762),l=n(29439),a=n(1413),s=n(71233),u=n(89499),d=n(62848),c=n(44258),p=n(64991),v=n(45734),f=n(98083),g=n(94766),m=n(23526),h=n(45234),x=n(35969),b=n(57707),_=n(23005),y=n(18282),Z=n(20076),j=n(64350),w=n(24464),S=n(35680),k=n(19409),O=n(52115),A=n(61088),M=n(44550),P=n(72369),C=n(29391),T=n(37881);function E(e){return(0,T.jsx)(k.Z,(0,a.Z)({},e))}function N(e){return(0,T.jsx)(O.Z,(0,a.Z)({},e))}var R=function(e){var t=e.message,n=e.app;try{return"bot"===t.role?t.content:1===Object.keys(t.content).length?Object.keys(t.content).map((function(e){return t.content[e]})).join("\n\n"):Object.keys(t.content).map((function(e){var o,i,r=null===n||void 0===n||null===(o=n.data)||void 0===o||null===(i=o.input_fields)||void 0===i?void 0:i.find((function(t){return t.name===e}));return"**".concat(e,"**: ").concat(!r||"file"!==r.type&&"voice"!==r.type&&"image"!==r.type?t.content[e]:t.content[e].split(",")[0].split(";")[1].split("=")[1])})).join("\n\n")}catch(o){return""}},B=s.memo((function(e){var t,n,o,i,r=e.message,l=e.index,a=e.app,s=e.onInMessageFormSubmit;return(0,T.jsxs)("div",{style:"bot"===r.role?{display:"flex",textAlign:"left",fontSize:16,padding:3}:{textAlign:"right"},children:["bot"===r.role&&(null===a||void 0===a||null===(t=a.data)||void 0===t||null===(n=t.config)||void 0===n?void 0:n.assistant_image)&&(0,T.jsx)(d.Z,{src:null===(o=a.data)||void 0===o||null===(i=o.config)||void 0===i?void 0:i.assistant_image,alt:"Bot",style:{margin:"16px 8px 16px 0px"}}),"bot"===r.role&&r.content.length<=1&&(0,T.jsxs)("div",{className:"chat_message_from_bot typing-indicator",children:[(0,T.jsx)("span",{}),(0,T.jsx)("span",{}),(0,T.jsx)("span",{})]}),(0,T.jsx)(C.Z,{className:"chat_message_from_".concat(r.role," ").concat(r.error?"error":""),onFormSubmit:s,children:R({message:r,app:a})})]},l)}),(function(e,t){var n,o;return(null===(n=e.message)||void 0===n?void 0:n.content)===(null===(o=t.message)||void 0===o?void 0:o.content)}));function I(e){var t,n,k,O,C,R,I,z,W,D,F,L,H,U,J,q,K,G,$,V,X,Y,Q,ee,te,ne,oe,ie,re,le,ae,se,ue=e.app,de=e.isMobile,ce=e.embed,pe=void 0!==ce&&ce,ve=e.ws,fe=(0,A._)(null===ue||void 0===ue||null===(t=ue.data)||void 0===t?void 0:t.input_fields),ge=fe.schema,me=fe.uiSchema,he=(0,s.useState)({}),xe=(0,l.Z)(he,2),be=xe[0],_e=xe[1],ye=(0,s.useState)(null),Ze=(0,l.Z)(ye,2),je=Ze[0],we=Ze[1],Se=(0,s.useState)([]),ke=(0,l.Z)(Se,2),Oe=ke[0],Ae=ke[1],Me=(0,s.useState)(null),Pe=(0,l.Z)(Me,2),Ce=Pe[0],Te=Pe[1],Ee=(0,s.useState)(!pe),Ne=(0,l.Z)(Ee,2),Re=Ne[0],Be=Ne[1],Ie=(0,s.useState)({backgroundColor:(null===ue||void 0===ue||null===(n=ue.data)||void 0===n||null===(k=n.config)||void 0===k?void 0:k.window_color)||"#0f477e",color:"white",position:"fixed",right:16,bottom:16}),ze=(0,l.Z)(Ie,2),We=ze[0],De=ze[1],Fe=(0,y.Zl)(j.TC),Le=new x.Kj,He=Le.parse((null===ue||void 0===ue||null===(O=ue.data)||void 0===O||null===(C=O.output_template)||void 0===C?void 0:C.markdown)||""),Ue=(0,s.useRef)({}),Je=(0,s.useRef)([]),qe=(0,s.useRef)(null),Ke=(0,s.useRef)(!0),Ge=(0,m.Z)({components:{MuiInputBase:{defaultProps:{autoComplete:"off"}},MuiTextField:{defaultProps:{variant:"outlined"},styleOverrides:{root:{"& .MuiOutlinedInput-root":{"& > fieldset":{border:"1px solid ".concat((null===ue||void 0===ue||null===(R=ue.data)||void 0===R?void 0:R.config.window_color)||"#ccc")},"&.Mui-focused > fieldset":{border:"1px solid #0f477e"},"&:hover > fieldset":{border:"1px solid #0f477e"},"&.Mui-error > fieldset":{border:"1px solid #fcc"}}}}},MuiTypography:{styleOverrides:{caption:{fontSize:"0.7rem",marginLeft:2,color:"#666"}}},MuiButtonBase:{styleOverrides:{root:{"&.MuiButton-contained":{textTransform:"none"}}}}}});(0,s.useEffect)((function(){if(pe)if(document.body.style="background: transparent",document.getElementsByClassName("root").style="background: transparent",Re){var e=navigator.userAgent||navigator.vendor||window.opera,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),n=t?"100%":"400px",o=t?"90vh":"700px";window.parent.postMessage({width:n,height:o,type:"promptly-embed-open"},"*")}else setTimeout((function(){var e,t;window.parent.postMessage({type:"promptly-embed-resize",width:(null===qe||void 0===qe||null===(e=qe.current)||void 0===e?void 0:e.clientWidth)||"auto",height:(null===qe||void 0===qe||null===(t=qe.current)||void 0===t?void 0:t.clientHeight)||"auto"},"*")}),500),window.parent.postMessage({type:"promptly-embed-close"},"*")}),[pe,Re]),(0,s.useEffect)((function(){var e,t,n,o,i,r,l,s;null!==ue&&void 0!==ue&&null!==(e=ue.data)&&void 0!==e&&null!==(t=e.config)&&void 0!==t&&t.welcome_message&&0===Oe.length&&Ae([{role:"bot",content:null===(l=ue.data)||void 0===l||null===(s=l.config)||void 0===s?void 0:s.welcome_message}]);if(null!==ue&&void 0!==ue&&null!==(n=ue.data)&&void 0!==n&&null!==(o=n.config)&&void 0!==o&&o.chat_bubble_text&&null!==ue&&void 0!==ue&&null!==(i=ue.data)&&void 0!==i&&null!==(r=i.config)&&void 0!==r&&r.chat_bubble_style&&0===Oe.length)try{var u,d,c=JSON.parse(null===ue||void 0===ue||null===(u=ue.data)||void 0===u||null===(d=u.config)||void 0===d?void 0:d.chat_bubble_style);De((function(e){return(0,a.Z)((0,a.Z)({},e),c)}))}catch(p){console.error(p)}}),[ue,Oe.length]),ve&&ve.setOnMessage((function(e){var t=null,n=JSON.parse(e.data);if(n.output){var s=(0,A.P)(Ue.current,n.output),u=(0,l.Z)(s,2),d=u[0],c=u[1];Ue.current=d;var p,v=(0,r.Z)(c);try{var f=function(){var e=p.value;Fe((function(t){return(0,a.Z)((0,a.Z)({},t),{},(0,i.Z)({},e.replace(/_base64_chunks$/g,""),(0,Z.get)(Ue.current,e,null)))}))};for(v.s();!(p=v.n()).done;)f()}catch(m){v.e(m)}finally{v.f()}}if(n.event&&"done"===n.event)Ke.current=!0;else{var g;if(Ke.current||!n.session&&!n.errors||(Ke.current=!0),n.session)we(null===(g=n.session)||void 0===g?void 0:g.id);n.errors&&n.errors.length>0&&(t=n.errors.join("\n\n")),Le.render(He,Ue.current).then((function(e){""===e.trim()&&null===t&&(t="No response from AI. Please try again."),Je.current=[].concat((0,o.Z)(Je.current.slice(0,-1)),[{role:"bot",content:null!==t?t||"Unknown error occured. Please try again.":e.trim(),error:null!==t}]),Ae(Je.current),t=null}))}}));var $e=function(e){Te(null),Ae([].concat((0,o.Z)(Oe),[{role:"user",content:e}])),Ke.current=!1,Ue.current={},Je.current=[].concat((0,o.Z)(Oe),[{role:"user",content:e},{role:"bot",content:""}]),ve.send(JSON.stringify({event:"run",input:e,session_id:je})),u.ZP.event({category:"App",action:"Run Chat App",label:null===ue||void 0===ue?void 0:ue.name,transport:"beacon"})};return(0,s.useEffect)((function(){var e=document.getElementById("messages");e.scrollTop=e.scrollHeight}),[Oe]),(0,T.jsxs)(T.Fragment,{children:[pe&&(0,T.jsx)(c.Z,{style:We,onClick:function(){return Be(!Re)},variant:null!==ue&&void 0!==ue&&null!==(I=ue.data)&&void 0!==I&&null!==(z=I.config)&&void 0!==z&&z.chat_bubble_text?"extended":"circular",ref:qe,children:Re?(0,T.jsx)(w.Z,{}):null!==ue&&void 0!==ue&&null!==(W=ue.data)&&void 0!==W&&null!==(D=W.config)&&void 0!==D&&D.chat_bubble_text?(0,T.jsx)("span",{children:null===ue||void 0===ue||null===(F=ue.data)||void 0===F||null===(L=F.config)||void 0===L?void 0:L.chat_bubble_text}):(0,T.jsx)(S.Z,{})}),(0,T.jsxs)("div",{className:"chat-container ".concat(pe?"embedded":""," ").concat(Re?"maximized":"minimized"),style:{width:de?"90%":"100%"},children:[pe&&(0,T.jsxs)("div",{style:{display:"flex",backgroundColor:(null===ue||void 0===ue||null===(H=ue.data)||void 0===H?void 0:H.config.window_color)||"#0f477e",borderRadius:"8px 8px 0px 0px"},children:[(null===ue||void 0===ue||null===(U=ue.data)||void 0===U||null===(J=U.config)||void 0===J?void 0:J.assistant_image)&&(0,T.jsx)(d.Z,{src:null===(q=ue.data)||void 0===q||null===(K=q.config)||void 0===K?void 0:K.assistant_image,alt:"Bot",style:{margin:"10px 8px",border:"solid 1px #ccc"}}),(0,T.jsx)("span",{style:{margin:"auto 0px",fontWeight:600,fontSize:"18px",color:"white",padding:null!==ue&&void 0!==ue&&null!==(G=ue.data)&&void 0!==G&&null!==($=G.config)&&void 0!==$&&$.assistant_image?"inherit":"16px"},children:null===ue||void 0===ue?void 0:ue.name})]}),(0,T.jsxs)(p.Z,{sx:{padding:"10px",overflow:"auto"},children:[(0,T.jsx)(M.b,{text:null===(V=ue.data)||void 0===V||null===(X=V.config)||void 0===X||null===(Y=X.input_template)||void 0===Y?void 0:Y.replaceAll("<a href","<a target='_blank' href")}),(0,T.jsxs)("div",{style:{marginTop:10,height:de||pe?"30vh":"500px",overflow:"auto",display:"flex",flexDirection:"column",gap:10},id:"messages",children:[Oe.map((function(e,t){return(0,T.jsx)(B,{message:e,index:t,app:ue,onInMessageFormSubmit:function(e){}},t)})),!Ke.current&&(0,T.jsxs)("div",{style:{display:"flex",textAlign:"left",fontSize:16,padding:3},children:[(null===ue||void 0===ue||null===(Q=ue.data)||void 0===Q||null===(ee=Q.config)||void 0===ee?void 0:ee.assistant_image)&&(0,T.jsx)(d.Z,{src:null===(te=ue.data)||void 0===te||null===(ne=te.config)||void 0===ne?void 0:ne.assistant_image,alt:"Bot",style:{margin:"16px 8px 16px 0px"}}),(0,T.jsxs)("div",{className:"chat_message_from_bot typing-indicator",children:[(0,T.jsx)("span",{}),(0,T.jsx)("span",{}),(0,T.jsx)("span",{})]})]}),Ce&&(0,T.jsx)(P.D1,{runError:Ce}),0===Oe.filter((function(e){return"user"===e.role})).length&&(null===ue||void 0===ue||null===(oe=ue.data)||void 0===oe||null===(ie=oe.config)||void 0===ie?void 0:ie.suggested_messages)&&(null===ue||void 0===ue||null===(re=ue.data)||void 0===re||null===(le=re.config)||void 0===le?void 0:le.suggested_messages.length)>0&&(0,T.jsx)(v.ZP,{sx:{alignSelf:"flex-end",textAlign:"right",marginTop:"auto"},children:null===ue||void 0===ue||null===(ae=ue.data)||void 0===ae||null===(se=ae.config)||void 0===se?void 0:se.suggested_messages.map((function(e,t){return(0,T.jsx)(f.Z,{label:e,sx:{margin:"5px 2px"},onClick:function(){var t,n,o;return(null===ue||void 0===ue||null===(t=ue.data)||void 0===t||null===(n=t.input_fields)||void 0===n?void 0:n.length)>0&&$e((0,i.Z)({},null===ue||void 0===ue||null===(o=ue.data)||void 0===o?void 0:o.input_fields[0].name,e))}},t)}))})]}),(0,T.jsx)(h.Z,{theme:Ge,children:(0,T.jsx)(_.ZP,{formData:be,schema:ge,uiSchema:(0,a.Z)((0,a.Z)({},me),{},{"ui:submitButtonOptions":{norender:Object.keys(null===ge||void 0===ge?void 0:ge.properties).length<=1&&0===Object.keys(me).map((function(e){var t;return null===(t=me[e])||void 0===t?void 0:t["ui:widget"]})).filter((function(e){return"voice"===e})).length}}),validator:b.ZP,onSubmit:function(e){var t=e.formData;Object.keys(null===ge||void 0===ge?void 0:ge.properties).length>1&&_e(t),$e(t)},widgets:{FileWidget:E,voice:N}})}),pe&&(ue.has_footer||!{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GA_MEASUREMENT_ID:"G-XZ40100Y5C"}.REACT_APP_ENABLE_SUBSCRIPTION_MANAGEMENT)&&(0,T.jsxs)(g.Z,{sx:{textAlign:"center"},variant:"caption",children:["Powered by"," ",(0,T.jsx)("a",{href:"https://trypromptly.com",target:"_blank",rel:"noreferrer",children:"Promptly"})]})]})]})]})}},44550:function(e,t,n){n.d(t,{b:function(){return r}});var o=n(88607),i=(n(95835),n(37881));function r(e){var t=e.text,n=(new DOMParser).parseFromString(t,"text/html");return String(t).startsWith("<")?(0,i.jsx)("div",{className:"LexicalRenderer__wrapper",dangerouslySetInnerHTML:{__html:n.body.innerHTML}}):(0,i.jsx)(o.D,{children:t})}},52115:function(e,t,n){var o=n(74165),i=n(15861),r=n(29439),l=n(71233),a=n(64991),s=n(2794),u=n(94766),d=n(92886),c=n(51086),p=n(9797),v=n(67296),f=n(37881);t.Z=function(e){var t=(0,l.useState)(!1),n=(0,r.Z)(t,2),g=n[0],m=n[1],h=(0,l.useState)(null),x=(0,r.Z)(h,2),b=x[0],_=x[1],y=(0,l.useState)(null),Z=(0,r.Z)(y,2),j=Z[0],w=Z[1],S=function(){var t=(0,i.Z)((0,o.Z)().mark((function t(){var n,i;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j&&w(null),t.prev=1,t.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:n=t.sent,(i=new MediaRecorder(n,{mimeType:"audio/webm"})).addEventListener("dataavailable",(function(t){var n=t.data;w(n);var o=new window.FileReader;o.onload=function(t){var n;if("string"===typeof(null===(n=t.target)||void 0===n?void 0:n.result)){var o=t.target.result.split(";"),i="".concat(o[0],";name=").concat("audio_recording.webm",";").concat(o[2]);e.onChange(i)}else e.onChange(null)},o.readAsDataURL(n)})),i.start(),m(!0),_(i),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),console.error("Error starting recording:",t.t0);case 15:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(){return t.apply(this,arguments)}}(),k=function(){b&&(b.stop(),m(!1))},O=function(){w(null),e.onChange(null)},A=function(e){return(0,f.jsxs)(a.Z,{direction:"column",children:[(0,f.jsx)(s.Z,{onClick:S,color:"primary",size:"small",variant:"outlined",children:(0,f.jsx)(p.Z,{})}),(0,f.jsx)(u.Z,{style:{fontSize:"8px",textAlign:"center"},children:"Start"}),(0,f.jsx)(u.Z,{style:{fontSize:"8px",textAlign:"center"},children:"Recording"})]})},M=function(e){return(0,f.jsxs)(a.Z,{direction:"column",children:[(0,f.jsx)(s.Z,{onClick:k,size:"small","aria-label":"Stop recording",variant:"outlined",children:(0,f.jsx)(c.Z,{})}),(0,f.jsx)(u.Z,{style:{fontSize:"8px",textAlign:"center",color:"red"},children:"Recording"})]})},P=function(e){return(0,f.jsxs)(a.Z,{direction:"column",ml:1,mr:1,children:[(0,f.jsx)(s.Z,{onClick:O,size:"small","aria-label":"Clear Recording",variant:"outlined",children:(0,f.jsx)(v.Z,{})}),(0,f.jsx)(u.Z,{style:{fontSize:"8px",textAlign:"center"},children:"Clear"}),(0,f.jsx)(u.Z,{style:{fontSize:"8px",textAlign:"center"},children:"Recording"})]})};return(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{children:e.label}),(0,f.jsx)("div",{children:j?(0,f.jsxs)(a.Z,{direction:"row",children:[(0,f.jsx)("audio",{src:URL.createObjectURL(j),controls:!0}),(0,f.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)(P,{}),(0,f.jsx)(A,{})]})]}):g?(0,f.jsx)(M,{}):(0,f.jsx)(A,{})})]})}}}]);
//# sourceMappingURL=3452.56302a53.chunk.js.map